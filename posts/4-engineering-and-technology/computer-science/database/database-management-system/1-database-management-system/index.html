<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Database Management Systems | Signal&#39;s Blog</title>
<meta name="keywords" content="Engineering &amp; Technology, Computer Science, Database">
<meta name="description" content="Introduction to DBMS A Database Management System (DBMS) is software that provides an interface for users to interact with databases. It enables the management, storage, and manipulation of data within databases. DBMS can be broadly classified into two main types: Relational DBMS and NoSQL DBMS.
In a Relational DBMS, data is stored in structured tables and is manipulated using SQL (Structured Query Language). Examples of relational DBMS inlcude MySQL, Oracle, and PostgreSQL.">
<meta name="author" content="Signal Yu">
<link rel="canonical" href="https://signalyu.github.io/posts/4-engineering-and-technology/computer-science/database/database-management-system/1-database-management-system/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5a0ace7f2dc73037e40ceea0eb0d119b5d798dba2da38d9129982a8cf9fa07a5.css" integrity="sha256-WgrOfy3HMDfkDO6g6w0Rm115jboto42RKZgqjPn6B6U=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://signalyu.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://signalyu.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://signalyu.github.io/favicon-32x32">
<link rel="apple-touch-icon" href="https://signalyu.github.io/apple-touch-icon">
<link rel="mask-icon" href="https://signalyu.github.io/favicon.io">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://signalyu.github.io/posts/4-engineering-and-technology/computer-science/database/database-management-system/1-database-management-system/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"
    integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"
    integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"
    integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk"
    crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: true }
            ],
            
            throwOnError: false,
            strict: false
        });
    });
</script>

  

<meta property="og:title" content="Database Management Systems" />
<meta property="og:description" content="Introduction to DBMS A Database Management System (DBMS) is software that provides an interface for users to interact with databases. It enables the management, storage, and manipulation of data within databases. DBMS can be broadly classified into two main types: Relational DBMS and NoSQL DBMS.
In a Relational DBMS, data is stored in structured tables and is manipulated using SQL (Structured Query Language). Examples of relational DBMS inlcude MySQL, Oracle, and PostgreSQL." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://signalyu.github.io/posts/4-engineering-and-technology/computer-science/database/database-management-system/1-database-management-system/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-12-25T10:20:09+08:00" />
<meta property="article:modified_time" content="2024-12-25T10:20:09+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Database Management Systems"/>
<meta name="twitter:description" content="Introduction to DBMS A Database Management System (DBMS) is software that provides an interface for users to interact with databases. It enables the management, storage, and manipulation of data within databases. DBMS can be broadly classified into two main types: Relational DBMS and NoSQL DBMS.
In a Relational DBMS, data is stored in structured tables and is manipulated using SQL (Structured Query Language). Examples of relational DBMS inlcude MySQL, Oracle, and PostgreSQL."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://signalyu.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Database Management Systems",
      "item": "https://signalyu.github.io/posts/4-engineering-and-technology/computer-science/database/database-management-system/1-database-management-system/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Database Management Systems",
  "name": "Database Management Systems",
  "description": "Introduction to DBMS A Database Management System (DBMS) is software that provides an interface for users to interact with databases. It enables the management, storage, and manipulation of data within databases. DBMS can be broadly classified into two main types: Relational DBMS and NoSQL DBMS.\nIn a Relational DBMS, data is stored in structured tables and is manipulated using SQL (Structured Query Language). Examples of relational DBMS inlcude MySQL, Oracle, and PostgreSQL.",
  "keywords": [
    "Engineering \u0026 Technology", "Computer Science", "Database"
  ],
  "articleBody": "Introduction to DBMS A Database Management System (DBMS) is software that provides an interface for users to interact with databases. It enables the management, storage, and manipulation of data within databases. DBMS can be broadly classified into two main types: Relational DBMS and NoSQL DBMS.\nIn a Relational DBMS, data is stored in structured tables and is manipulated using SQL (Structured Query Language). Examples of relational DBMS inlcude MySQL, Oracle, and PostgreSQL.\nIn a NoSQL DBMS, data is typically unstructured or semi-structured, offering flexibility to handle diverse data types. Examples of NoSQL DBMS include MongoDB and Redis.\nMySQL MySQL is a relational database management system (RDBMS) that uses Structured Query Language (SQL) to interact with databases. It stores data in tables made up of rows and columns, allowing for efficient organization, retrival, and manipulation of data.\nSQL Commands SQL Commands are used to interact with relational databases. These commands can be classified into five types: DDL, DQL, DML, DCL, and TCL.\nSQL Commands DDL (Data Definition Language): Used to define and manage the structure of database instances, such as creating, altering, and deleting tables, and defining constraints. DQL (Data Query Language): Used to retrive data from the database, primarily through the SELECT statement. DML (Data Manipulation Language): Used to manipulate data within tables, such as inserting, updating, and deleting records. DCL (Data Control Language): Used to control access to data, manage user priviledges, and ensure data security. It includes commands like GRANT and REVOKE. TCL (Transaction Control Language): Used to manage transactions, ensuring data consistency. It includes commands like COMMIT, ROLLBACK, and SAVEPOINT. SQL Query Execution Order MySQL Execution Order: In MySQL, the execution order of an SQL query differs from the order in which components (e.g., SELECT, FROM, WHERE) are written in the query. MySQL begins by identifying the tables or views specified in the FROM clause. If there are any JOIN operation, MySQL performs the joins first and applies the ON condition. After completing the join operations, MySQL filters the based on the conditions specified in the WHERE clause.\nIf a GROUP BY clause is present, MySQL groups the rows based on the specified column(s) and then executes any aggregation functions (e.g., SUM(), COUNT(), etc.). Following the grouping, if a HAVING clause is provided, MySQL further filters the grouped results based on the specified condition.\nAfter filtering grouped results, MySQL selects the specified columns in the SELECT clause. If the DISTINCT keyword is used, MySQL removes duplicate rows from the selected result. Once the rows are selected and duplicates are removed, MySQL sorts the result set according to the rules defined in the ORDER BY clause.\nFinally, if a LIMIT or OFFSET clause is included, MySQL limits the number of rows returned, starting from the specified OFFSET.\nSQL Query Execution Order Select Find Customer Referee SHOW PROBLEM Table: Customer\nColumn Name Type id int name varchar referee_id int The id column is the primary key. Each row represents a customer, their name, and the id of the customer who referred them. If a customer wasn’t referred by anyone, the referee_id is NULL. Problem:\nFind the names of customers who were not referred by the customer with id = 2.\nThe result can be returned in any order.\nExample:\nInput: Customer table:\nid name referee_id 1 Will NULL 2 Jane NULL 3 Alex 2 4 Bill NULL 5 Zack 1 6 Mark 2 Output:\nname Will Jane Bill Zack Go to Leetcode 🔗 SHOW CODE MySQL SELECT name FROM Customer WHERE referee_id != 2 OR referee_id IS NULL; SHOW NOTES In SQL, NULL is not equal to any value, including 2. Therefore, the condition referee_id != 2 will exclude records where referee_id is NULL, because comparisons with NULLalways result in an unknownNULLvalue, which is neitherTRUEnorFALSE`. It is crucial to consider the handling of NULL values when working with databases.\nArticle Views I SHOW PROBLEM Table: Views\nColumn Name Type article_id int author_id int viewer_id int view_date date There is no primary key in this table, and the table may contain duplicate rows. Each row indicates that a viewer viewed an article, where the article is written by an author, on a specific date. If author_id and viewer_id are the same, it indicates that the author viewed their own article. Problem:\nWrite a query to find the IDs of authors who have viewed at least one of their own articles.\nReturn the result table sorted by author_id in ascending order.\nExample:\nInput:\nViews table:\narticle_id author_id viewer_id view_date 1 3 5 2019-08-01 1 3 6 2019-08-02 2 7 7 2019-08-01 2 7 6 2019-08-02 4 7 1 2019-07-22 3 4 4 2019-07-21 3 4 4 2019-07-21 Output:\nid 4 7 Go to Leetcode 🔗 SHOW CODE MySQL SELECT DISTINCT author_id AS id FROM Views WHERE author_id = viewer_id ORDER BY id ASC; SHOW NOTES In SQL, the DISTINCT keyword is used to remove duplicate records from the result set, ensuring that only unique values are returned. It is commonly used in scenarios such as aggregating distinct values and ensuring uniqueness in join queries.\n# Aggregating unique values SELECT DISTINCT product_id FROM Order_Items; # Ensuring unique results in join queries SELECT DISTINCT c.customer_id, c.name FROM Customers c JOIN Orders o ON c.customer_id = o.customer_id; Baisc Joins LEFT JOIN: Replace Employee ID With The Unique Identifier In MySQL, LEFT JOIN is used to combine rows from two or more tables based on a related column between them. It returns all rows from the left table and the matching rows from the right table. If there is no match, the result will include NULL values for the column from the right table.\nSHOW PROBLEM Tables:\nEmployees\nColumn Name Type id int name varchar id is the primary key for this table. Each row represents an employee in the company, containing their id and name. EmployeeUNI\nColumn Name Type id int unique_id int (id, unique_id) is the primary key, meaning the combination of id and unique_id is unique across the table. Each row represents an employee’s id and their corresponding unique_id in the company. Task:\nWrite a SQL query that returns the unique_id of each employee from the Employees table. If an employee does not have a corresponding unique_id, return NULL for that employee.\nQuery Requirements:\nIf an employee has a unique_id, show it. If an employee does not have a unique_id, return NULL. The result should display the unique_id and the name of each employee. The results can be returned in any order.\nExample:\nInput:\nEmployees table:\nid name 1 Alice 7 Bob 11 Meir 90 Winston 3 Jonathan EmployeeUNI table:\nid unique_id 3 1 11 2 90 3 Output:\nunique_id name NULL Alice NULL Bob 2 Meir 3 Winston 1 Jonathan Explanation:\nAlice and Bob do not have a unique_id, so NULL is shown for both. Meir has a unique_id of 2. Winston has a unique_id of 3. Jonathan has a unique_id of 1. Go to Leetcode 🔗 SHOW CODE MySQL SELECT euni.unique_id, e.name FROM Employees e LEFT JOIN EmployeeUNI euni ON e.id = euni.id; LEFT JOIN: Confirmation Rate SHOW PROBLEM Table: Signups\nColumn Name Type user_id int time_stamp datetime user_id is a unique identifier for each user. Each row represents the signup time for the user identified by user_id. Table: Confirmations\nColumn Name Type user_id int time_stamp datetime action ENUM The primary key is a combination of user_id and time_stamp. user_id is a foreign key referencing the Signups table. action is an ENUM with two possible values: 'confirmed' or 'timeout'. Each row represents a confirmation request made by the user with user_id, indicating whether the confirmation message was confirmed ('confirmed') or timed out ('timeout'). Problem Description\nThe confirmation rate of a user is calculated as the ratio of 'confirmed' actions to the total number of confirmation requests. If a user has not made any confirmation requests, the confirmation rate is 0. The rate should be rounded to two decimal places.\nGoal\nWrite a SQL query to find the confirmation rate for each user.\nReturn the result in any order.\nInput\nSignups table:\nuser_id time_stamp 3 2020-03-21 10:16:13 7 2020-01-04 13:57:59 2 2020-07-29 23:09:44 6 2020-12-09 10:39:37 Confirmations table:\nuser_id time_stamp action 3 2021-01-06 03:30:46 timeout 3 2021-07-14 14:00:00 timeout 7 2021-06-12 11:57:29 confirmed 7 2021-06-13 12:58:28 confirmed 7 2021-06-14 13:59:27 confirmed 2 2021-01-22 00:00:00 confirmed 2 2021-02-28 23:59:59 timeout Output\nuser_id confirmation_rate 6 0.00 3 0.00 7 1.00 2 0.50 Explanation:\nUser 6 did not request any confirmation messages, so their confirmation rate is 0. User 3 made two confirmation requests, but both timed out, so their confirmation rate is 0. User 7 made three requests, and all were confirmed, so their confirmation rate is 1.00. User 2 made two requests: one confirmed and one timed out, so their confirmation rate is 1/2 = 0.50. Go to Leetcode 🔗 SHOW CODE MySQL SELECT user_id, ROUND(IFNULL(SUM(action = 'confirmed') / COUNT(1), 0), 2) AS confirmation_rate FROM SignUps LEFT JOIN Confirmations USING (user_id) GROUP BY 1; SELECT s.user_id, CASE WHEN c.user_id IS NULL THEN 0.00 ELSE ROUND(SUM(CASE WHEN action = 'confirmed' THEN 1 ELSE 0 END) / COUNT(*),2) END AS confirmation_rate FROM Signups s LEFT JOIN Confirmations c ON c.user_id = s.user_id GROUP BY s.user_id SHOW NOTES SUM(action = 'confirmed'): action = 'confirmed' returns 1 for confirmed actions and 0 for 'timeout' action. COUNT(1): Counts the total number of rows. (Use COUNT(*) for counting rows is more clear and idiomatic). LEFT JOIN Confirmations USING (user_id): Joins the Signups table with the Confirmations table on the user_id column. GROUP BY 1: A shorthand for GROUP BY user_id. It groups the results by the first column in the SELECT list, which is user_id in this case. INNER JOIN: Product Sales Analysis I In MySQL, the INNER JOIN is used to combine rows from two or more tables based on a related column between them. It only returns rows where there is a match in all the joined tables.\nSHOW PROBLEM Tables:\nSales\nColumn Name Type sale_id int product_id int year int quantity int price int (sale_id, year) is the primary key, meaning this combination of columns is unique. product_id is a foreign key referencing the Product table. Each row represents a sale of a product identified by product_id in a particular year. The price is per unit of the product. Product\nColumn Name Type product_id int product_name varchar product_id is the primary key for this table. Each row represents a product with its product_name. Task:\nWrite a SQL query to report the product_name, year, and price for each sale in the Sales table.\nQuery Requirements:\nReturn the product_name from the Product table, corresponding to the product_id in the Sales table. Include the year and price from the Sales table for each sale. The result can be returned in any order. Example:\nInput:\nSales table:\nsale_id product_id year quantity price 1 100 2008 10 5000 2 100 2009 12 5000 7 200 2011 15 9000 Product table:\nproduct_id product_name 100 Nokia 200 Apple 300 Samsung Output:\nproduct_name year price Nokia 2008 5000 Nokia 2009 5000 Apple 2011 9000 Explanation:\nFrom sale_id = 1, we can conclude that Nokia was sold for 5000 in 2008. From sale_id = 2, we can conclude that Nokia was sold for 5000 in 2009. From sale_id = 7, we can conclude that Apple was sold for 9000 in 2011. Go to Leetcode 🔗 SHOW CODE MySQL SELECT p.product_name, s.year, s.price FROM Sales s INNER JOIN Product p ON s.product_id = p.product_id; LEFT JOIN: Customer Who Visited but Did Not Make Any Transactions SHOW PROBLEM Table: Visits\nColumn Name Type visit_id int customer_id int visit_id is the unique identifier for each visit. This table contains information about the customers who visited the mall. Table: Transactions\nColumn Name Type transaction_id int visit_id int amount int transaction_id is the unique identifier for each transaction. This table contains information about the transactions made during each visit. Task:\nWrite a SQL query to find the IDs of customers who visited the mall without making any transactions, and count how many times they made these visits.\nThe result should include:\ncustomer_id — the ID of the customer. count_no_trans — the number of visits where no transaction was made. Query Requirements:\nReturn the result sorted in any order. Input:\nVisits table:\nvisit_id customer_id 1 23 2 9 4 30 5 54 6 96 7 54 8 54 Transactions table:\ntransaction_id visit_id amount 2 5 310 3 5 300 9 5 200 12 1 910 13 2 970 Output:\ncustomer_id count_no_trans 54 2 30 1 96 1 Explanation:\nCustomer with id = 23 visited once and made a transaction during the visit with id = 12. Customer with id = 9 visited once and made a transaction during the visit with id = 13. Customer with id = 30 visited once and did not make any transactions. Customer with id = 54 visited three times. During two visits, they did not make any transactions, and during one visit, they made three transactions. Customer with id = 96 visited once and did not make any transactions. In the output, customers with id = 30, id = 96, and id = 54 (for two of their visits) made visits without transactions.\nGo to Leetcode 🔗 SHOW CODE MySQL SELECT v.customer_id, COUNT(v.visit_id) as count_no_trans FROM Visits v LEFT JOIN Transactions t ON v.visit_id = t.visit_id WHERE t.transaction_id IS NULL GROUP BY v.customer_id; SHOW NOTES In the above SQL query, MySQL first identifies the Visits table and performs a LEFT JOIN with the Transactions table based on the condition v.visit_id = t.visit_id. The LEFT JOIN operation combines the two tables and fills NULL in rows where there is no match in the Transactions table. The result looks like this:\nSELECT * FROM Visits v LEFT JOIN Transactions t ON v.visit_id = t.visit_id; visit_id customer_id transaction_id visit_id amount 1 23 12 1 910 2 9 13 2 970 4 30 null null null 5 54 9 5 200 5 54 3 5 300 5 54 2 5 310 6 96 null null null 7 54 null null null 8 54 null null null After joining the tables, MySQL applies the WHERE clause to filter rows where t.transaction_id IS NULL, which means visits without any transactions.\nSELECT * FROM Visits v LEFT JOIN Transactions t ON v.visit_id = t.visit_id WHERE t.transaction_id IS NULL; visit_id customer_id transaction_id visit_id amount 4 30 null null null 6 96 null null null 7 54 null null null 8 54 null null null Next, MySQL groups the filtered rows by customer_id and calculates the number of visits per customer using the COUNT(v.visit_id) function.\nSELECT *, COUNT(v.visit_id) FROM Visits v LEFT JOIN Transactions t ON v.visit_id = t.visit_id WHERE t.transaction_id IS NULL GROUP BY v.customer_id; visit_id customer_id transaction_id visit_id amount COUNT(v.visit_id) 4 30 null null null 1 6 96 null null null 1 7 54 null null null 2 Finally, MySQL selects the desired columns and renames the COUNT(v.visit_id) column using the AS clause.\nSELECT v.customer_id, COUNT(v.visit_id) AS count_no_trans FROM Visits v LEFT JOIN Transactions t ON v.visit_id = t.visit_id WHERE t.transaction_id IS NULL GROUP BY v.customer_id; customer_id count_no_trans 30 1 96 1 54 2 SELF JOIN: Rising Temperature In MySQL, a self join is an operation where a table joins itself. It is commonly used when comparing rows within the same table based on a specific condition or when working with hierarchical data, such as relating employees to their managers.\nSHOW PROBLEM Table: Weather\nColumn Name Type id int recordDate date temperature int id is a column with unique values. There are no duplicate rows for the same recordDate. This table contains information about the temperature on specific dates. Problem Statement\nWrite a solution to find the id of all dates where the temperature is higher compared to the previous day (yesterday).\nReturn\nReturn the result table in any order. Input:\nWeather Table:\nid recordDate temperature 1 2015-01-01 10 2 2015-01-02 25 3 2015-01-03 20 4 2015-01-04 30 Output:\nid 2 4 Explanation:\nOn 2015-01-02, the temperature was higher than the previous day (10 -\u003e 25). On 2015-01-04, the temperature was higher than the previous day (20 -\u003e 30). Go to Leetcode 🔗 SHOW CODE MySQL SELECT w1.id FROM Weather w1 JOIN Weather w2 ON DATE_ADD(w2.recordDate, INTERVAL 1 DAY) = w1.recordDate WHERE w1.temperature \u003e w2.temperature; SHOW NOTES In the above query, the DATE_ADD(w2.recordDate, INTERVAL 1 DAY) = w1.recordDate condition ensures that the recordDate of w1 matches the day following w2’s recordDate.\nSELECT * FROM Weather w1 JOIN Weather w2 ON DATE_ADD(w2.recordDate, INTERVAL 1 DAY) = w1.recordDate id recordDate temperature id recordDate temperature 1 2015-01-01 10 2 2015-01-02 25 1 2015-01-01 10 3 2015-01-03 20 2 2015-01-02 25 4 2015-01-04 30 3 2015-01-03 20 4 2015-01-04 30 Result of the Join:\nid recordDate temperature id recordDate temperature 2 2015-01-02 25 1 2015-01-01 10 3 2015-01-03 20 2 2015-01-02 25 4 2015-01-04 30 3 2015-01-03 20 when id equals to 2, 25 \u003e 10, so it is selcted. when id equals to 3, 20 \u003c 25, so it is not selcted. when id equals to 4, 25 \u003e 10, so it is selcted. Therefore, the result will be:\nid 2 4 Example: Relating Employees to Their Managers\nEmployees Table:\nid name manager_id 1 Alice NULL 2 Bob 1 3 Charlie 1 4 David 2 SELECT e1.name AS Employee, e2.name AS Manager FROM Employees e1 JOIN Employees e2 ON e1.manager_id = e2.id; Result of the Join:\nid name manager_id id name manager_id 2 Bob 1 1 Alice NULL 3 Charlie 1 1 Alice NULL 4 David 2 2 Bob 1 Final Result:\nEmployee Manager Bob Alice Charlie Alice David Bob SELF JOIN: Managers with at Least 5 Direct Reports SHOW PROBLEM Problem Description\nTable: Employee\nColumn Name Data Type Description id int Unique identifier for each employee. name varchar Name of the employee. department varchar Department to which the employee belongs. managerId int ID of the employee’s manager. If managerId is null, the employee does not have a manager. id is the primary key, ensuring each value is unique. Each row represents an employee, including their name, department, and their manager’s ID. If managerId is null, the employee does not report to any manager. An employee cannot be their own manager. Task\nWrite a query to find the managers who have at least five direct reports.\nReturn the result in any order.\nInput:\nEmployee Table:\nid name department managerId 101 John A null 102 Dan A 101 103 James A 101 104 Amy A 101 105 Anne A 101 106 Ron B 101 Output:\nname John Go to Leetcode 🔗 SHOW CODE MySQL SELECT b.name FROM Employee a JOIN Employee b ON a.managerId = b.id GROUP BY b.id HAVING COUNT(*) \u003e= 5 SHOW NOTES Table: Employee:\nid name department managerId 101 John A null 102 Dan A 101 103 James A 101 104 Amy A 101 105 Anne A 101 106 Ron B 101 Perform a self join, the table becomes:\nSELECT * FROM Employee a JOIN Employee b ON a.managerId = b.id Table: Slef Joined Result:\nid name department managerId id name department managerId 106 Ron B 101 101 John A null 105 Anne A 101 101 John A null 104 Amy A 101 101 John A null 103 James A 101 101 John A null 102 Dan A 101 101 John A null Group the self joined result:\nSELECT * FROM Employee a JOIN Employee b ON a.managerId = b.id GROUP BY b.id Table: Grouped Result:\nid name department managerId id name department managerId 106 Ron B 101 101 John A null Filter grouped result:\nSELECT * FROM Employee a JOIN Employee b ON a.managerId = b.id GROUP BY b.id HAVING COUNT(*) \u003e= 5 Table: Filtered Grouped Result:\nid name department managerId id name department managerId 106 Ron B 101 101 John A null Select the specified column(s):\nSELECT b.name FROM Employee a JOIN Employee b ON a.managerId = b.id GROUP BY b.id HAVING COUNT(*) \u003e= 5 Final Result:\nname John SELF JOIN: Average Time of Process per Machine SHOW PROBLEM Table: Activity\nColumn Name Type machine_id int process_id int activity_type enum timestamp float The table records user activities for machines on a factory website. The combination of (machine_id, process_id, activity_type) is the primary key, ensuring uniqueness in the table. machine_id is the ID of the machine. process_id is the ID of the process running on the machine with ID machine_id. activity_type is an ENUM type with values 'start' and 'end', representing the start and end of a process. timestamp is a float value representing the time (in seconds) the event occurred. The 'start' timestamp is always earlier than the 'end' timestamp for each (machine_id, process_id) pair. It is guaranteed that each (machine_id, process_id) pair has a corresponding 'start' and 'end' timestamp. Problem:\nThere are several machines on a factory website, and each machine runs the same number of processes. Your task is to write a SQL query that calculates the average time each machine takes to complete a process.\nThe time to complete a process is the difference between the 'end' timestamp and the 'start' timestamp. The average time for each machine is calculated by dividing the total time for all processes on that machine by the number of processes. The result should contain the following columns:\nmachine_id — the ID of the machine. processing_time — the average processing time, rounded to 3 decimal places. Input:\nActivity table: |------------|------------|---------------|-----------| | machine_id | process_id | activity_type | timestamp | |------------|------------|---------------|-----------| | 0 | 0 | start | 0.712 | | 0 | 0 | end | 1.520 | | 0 | 1 | start | 3.140 | | 0 | 1 | end | 4.120 | | 1 | 0 | start | 0.550 | | 1 | 0 | end | 1.550 | | 1 | 1 | start | 0.430 | | 1 | 1 | end | 1.420 | | 2 | 0 | start | 4.100 | | 2 | 0 | end | 4.512 | | 2 | 1 | start | 2.500 | | 2 | 1 | end | 5.000 | |------------|------------|---------------|-----------| Output:\n|------------|-----------------| | machine_id | processing_time | |------------|-----------------| | 0 | 0.894 | | 1 | 0.995 | | 2 | 1.456 | |------------|-----------------| Explanation:\nMachine 0:\nProcess 0: End time 1.520, Start time 0.712 → Time taken = 1.520 - 0.712 = 0.808 Process 1: End time 4.120, Start time 3.140 → Time taken = 4.120 - 3.140 = 0.980 Average time = (0.808 + 0.980) / 2 = 0.894 Machine 1:\nProcess 0: End time 1.550, Start time 0.550 → Time taken = 1.550 - 0.550 = 1.000 Process 1: End time 1.420, Start time 0.430 → Time taken = 1.420 - 0.430 = 0.990 Average time = (1.000 + 0.990) / 2 = 0.995 Machine 2:\nProcess 0: End time 4.512, Start time 4.100 → Time taken = 4.512 - 4.100 = 0.412 Process 1: End time 5.000, Start time 2.500 → Time taken = 5.000 - 2.500 = 2.500 Average time = (0.412 + 2.500) / 2 = 1.456 Go to Leetcode 🔗 SHOW CODE MySQL SELECT machine_id, ROUND(AVG(end_time - start_time), 3) AS processing_time FROM ( SELECT a.machine_id, a.process_id, a.timestamp AS start_time, b.timestamp AS end_time FROM Activity a JOIN Activity b ON a.machine_id = b.machine_id AND a.process_id = b.process_id AND a.activity_type = 'start' AND b.activity_type = 'end' ) AS process_times GROUP BY machine_id; SHOW NOTES In the following SQL query, the condition a.activity_type = 'start' and b.activity_type = 'end' ensures that the start and end timestamp are correctly matched for the same process on the same machine.\nSELECT * FROM Activity a JOIN Activity b ON a.machine_id = b.machine_id AND a.process_id = b.process_id AND a.activity_type = 'start' AND b.activity_type = 'end' Result of the Join:\nmachine_id process_id activity_type timestamp machine_id process_id activity_type timestamp 0 0 start 0.712 0 0 end 1.52 0 1 start 3.14 0 1 end 4.12 1 0 start 0.55 1 0 end 1.55 1 1 start 0.43 1 1 end 1.42 2 0 start 4.1 2 0 end 4.512 2 1 start 2.5 2 1 end 5 The result is selected from of the joined result:\nSELECT machine_id, ROUND(AVG(end_time - start_time), 3) AS processing_time FROM ( SELECT a.machine_id, a.process_id, a.timestamp AS start_time, b.timestamp AS end_time FROM Activity a JOIN Activity b ON a.machine_id = b.machine_id AND a.process_id = b.process_id AND a.activity_type = 'start' AND b.activity_type = 'end' ) AS process_times GROUP BY machine_id; Final Result:\nmachine_id processing_time 0 0.894 1 0.995 2 1.456 CROSS JOIN: Students and Examinations In MySQL, a CROSS JOIN is a type of join that returns the Cartesian product of two tables. It combines each row from the first table with every row from the second table, without the need for a join condition. For example, consider two tables, Students and Subjects:\nTable 1: Students\nstudent_id student_name 1 Alice 2 Bob Table 2: Subjects\nsubject_name Math Physics When a Cross Join is performed between these two tables, the result will be:\nTable: Result of Cross Join\nstudent_id student_name subject_name 1 Alice Math 1 Alice Physics 2 Bob Math 2 Bob Physics SHOW PROBLEM Table: Students\nColumn Name Type student_id int student_name varchar student_id is the primary key (unique values) for this table. Each row represents a student with their unique ID and name. Table: Subjects\nColumn Name Type subject_name varchar subject_name is the primary key (unique values) for this table. Each row represents the name of a subject offered in the school. Table: Examinations\nColumn Name Type student_id int subject_name varchar There is no primary key for this table, and it may contain duplicates. Each row indicates that a student with student_id attended the exam for the subject subject_name. Every student takes every course from the Subjects table. Task:\nWrite a query to find the number of times each student attended each exam, ordered by student_id and subject_name.\nInput:\nStudents Table:\nstudent_id student_name 1 Alice 2 Bob 13 John 6 Alex Subjects Table:\nsubject_name Math Physics Programming Examinations Table:\nstudent_id subject_name 1 Math 1 Physics 1 Programming 2 Programming 1 Physics 1 Math 13 Math 13 Programming 13 Physics 2 Math 1 Math Output:\nstudent_id student_name subject_name attended_exams 1 Alice Math 3 1 Alice Physics 2 1 Alice Programming 1 2 Bob Math 1 2 Bob Physics 0 2 Bob Programming 1 6 Alex Math 0 6 Alex Physics 0 6 Alex Programming 0 13 John Math 1 13 John Physics 1 13 John Programming 1 Explanation:\nThe result table contains all students and all subjects.\nAlice attended the Math exam 3 times, the Physics exam 2 times, and the Programming exam 1 time. Bob attended the Math exam 1 time, the Programming exam 1 time, and did not attend the Physics exam. Alex did not attend any exams. John attended the Math exam 1 time, the Physics exam 1 time, and the Programming exam 1 time. Go to Leetcode 🔗 SHOW CODE MySQL SELECT s.student_id, s.student_name, sub.subject_name, COUNT(e.student_id) AS attended_exams FROM Students s CROSS JOIN Subjects sub LEFT JOIN Examinations e ON s.student_id = e.student_id AND sub.subject_name = e.subject_name GROUP BY s.student_id, s.student_name, sub.subject_name ORDER BY s.student_id, sub.subject_name; SHOW NOTES Table: Students\nstudent_id student_name 1 Alice 2 Bob 13 John 6 Alex Table: Subjects:\nsubject_name Math Physics Programming When a CROSS JOIN is performed between the Students and Subjects tables, the result will be:\nSELECT * FROM Students s CROSS JOIN Subjects sub Table: Result of Cross Join:\nstudent_id student_name subject_name 1 Alice Programming 1 Alice Physics 1 Alice Math 2 Bob Programming 2 Bob Physics 2 Bob Math 13 John Programming 13 John Physics 13 John Math 6 Alex Programming 6 Alex Physics 6 Alex Math Table: Examniations:\nstudent_id subject_name 1 Math 1 Physics 1 Programming 2 Programming 1 Physics 1 Math 13 Math 13 Programming 13 Physics 2 Math 1 Math Perform a LEFT JOIN on the cross-joined tables with the Examinations table:\nSELECT * FROM Students s CROSS JOIN Subjects sub LEFT JOIN Examinations e ON s.student_id = e.student_id AND sub.subject_name = e.subject_name Table: Left Join Result:\nstudent_id student_name subject_name student_id subject_name 1 Alice Programming 1 Programming 1 Alice Physics 1 Physics 1 Alice Physics 1 Physics 1 Alice Math 1 Math 1 Alice Math 1 Math 1 Alice Math 1 Math 2 Bob Programming 2 Programming 2 Bob Physics null null 2 Bob Math 2 Math 13 John Programming 13 Programming 13 John Physics 13 Physics 13 John Math 13 Math 6 Alex Programming null null 6 Alex Physics null null 6 Alex Math null null After grouping the left joined result and count the e.studentId, the table will look like:\nSELECT *, COUNT(e.student_id) AS attended_exams FROM Students s CROSS JOIN Subjects sub LEFT JOIN Examinations e ON s.student_id = e.student_id AND sub.subject_name = e.subject_name GROUP BY s.student_id, s.student_name, sub.subject_name Table: Grouped Result with Count:\nstudent_id student_name subject_name student_id subject_name attended_exams 1 Alice Programming 1 Programming 1 1 Alice Physics 1 Physics 2 1 Alice Math 1 Math 3 2 Bob Programming 2 Programming 1 2 Bob Physics null null 0 2 Bob Math 2 Math 1 13 John Programming 13 Programming 1 13 John Physics 13 Physics 1 13 John Math 13 Math 1 6 Alex Programming null null 0 6 Alex Physics null null 0 6 Alex Math null null 0 After selecting the specified columns, the result table becomes:\nSELECT s.student_id, s.student_name, sub.subject_name, COUNT(e.student_id) AS attended_exams FROM Students s CROSS JOIN Subjects sub LEFT JOIN Examinations e ON s.student_id = e.student_id AND sub.subject_name = e.subject_name GROUP BY s.student_id, s.student_name, sub.subject_name student_id student_name subject_name attended_exams 1 Alice Programming 1 1 Alice Physics 2 1 Alice Math 3 2 Bob Programming 1 2 Bob Physics 0 2 Bob Math 1 13 John Programming 1 13 John Physics 1 13 John Math 1 6 Alex Programming 0 6 Alex Physics 0 6 Alex Math 0 Sort the selcted table based on the condition s.student_id and sub.subject_name, return the final result:\nTable: Final Result:\nstudent_id student_name subject_name attended_exams 1 Alice Math 3 1 Alice Physics 2 1 Alice Programming 1 2 Bob Math 1 2 Bob Physics 0 2 Bob Programming 1 6 Alex Math 0 6 Alex Physics 0 6 Alex Programming 0 13 John Math 1 13 John Physics 1 13 John Programming 1 Basic Aggregate Functions Average Selling Price SHOW PROBLEM Table: Prices\nColumn Name Type product_id int start_date date end_date date price int The primary key for this table is the combination of (product_id, start_date, end_date), ensuring unique periods for each product. Each row represents the price of a product for a specific period, from start_date to end_date. For each product, no two periods will overlap. Table: UnitsSold\nColumn Name Type product_id int purchase_date date units int This table may contain duplicate rows. Each row represents the date, number of units, and product_id for a product sold on that date. Problem:\nWrite a SQL query to find the average selling price for each product. The average_price should be rounded to two decimal places. If a product does not have any sold units, its average selling price should be considered 0.\nReturn the result table in any order.\nInput:\nPrices table:\nproduct_id start_date end_date price 1 2019-02-17 2019-02-28 5 1 2019-03-01 2019-03-22 20 2 2019-02-01 2019-02-20 15 2 2019-02-21 2019-03-31 30 UnitsSold table:\nproduct_id purchase_date units 1 2019-02-25 100 1 2019-03-01 15 2 2019-02-10 200 2 2019-03-22 30 Output:\nproduct_id average_price 1 6.96 2 16.96 Explanation:\nFor product 1:\nFrom 2019-02-17 to 2019-02-28, 100 units were sold at a price of 5. From 2019-03-01 to 2019-03-22, 15 units were sold at a price of 20. Average price is calculated based on the total price and total units sold. For product 2:\nFrom 2019-02-01 to 2019-02-20, 200 units were sold at a price of 15. From 2019-02-21 to 2019-03-31, 30 units were sold at a price of 30. Average price is calculated based on the total price and total units sold. Go to Leetcode 🔗 SHOW CODE MySQL SELECT p.product_id, ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id AND purchase_date BETWEEN start_date AND end_date GROUP BY 1; SHOW NOTES: Right Answer MySQL Query Walkthrough:\nTable: Prices\nproduct_id start_date end_date price 1 2019-02-17 2019-02-28 5 1 2019-03-01 2019-03-22 20 2 2019-02-01 2019-02-20 15 2 2019-02-21 2019-03-31 30 3 2019-02-21 2019-03-31 30 Table: UnitsSold\nproduct_id purchase_date units 1 2019-02-25 100 1 2019-03-01 15 2 2019-02-10 200 2 2019-03-22 30 Join the two tables based on the product_id and the purchase_date, where the purchase_date falls between the start_date and the end_date:\nSELECT * FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id AND purchase_date BETWEEN start_date AND end_date; product_id start_date end_date price product_id purchase_date units 1 2019-02-17 2019-02-28 5 1 2019-02-25 100 1 2019-03-01 2019-03-22 20 1 2019-03-01 15 2 2019-02-01 2019-02-20 15 2 2019-02-10 200 2 2019-02-21 2019-03-31 30 2 2019-03-22 30 3 2019-02-21 2019-03-31 30 null null null Group the joined result and then use aggregation functions to calculate the average price:\nSELECT *, ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id AND purchase_date BETWEEN start_date AND end_date GROUP BY 1; product_id start_date end_date price product_id purchase_date units average_price 1 2019-02-17 2019-02-28 5 1 2019-02-25 100 6.96 2 2019-02-01 2019-02-20 15 2 2019-02-10 200 16.96 3 2019-02-21 2019-03-31 30 null null null 0 Select the desired columns:\nSELECT p.product_id, ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id AND purchase_date BETWEEN start_date AND end_date GROUP BY 1; product_id average_price 1 6.96 2 16.96 3 0 SHOW NOTES: Wrong Answer # Wrong Answer SELECT p.product_id, ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id WHERE purchase_date BETWEEN start_date AND end_date GROUP BY 1; Join the two tables based on the condition p.product_id = u.product_id:\nSELECT * FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id; product_id start_date end_date price product_id purchase_date units 1 2019-02-17 2019-02-28 5 1 2019-03-01 15 1 2019-02-17 2019-02-28 5 1 2019-02-25 100 1 2019-03-01 2019-03-22 20 1 2019-03-01 15 1 2019-03-01 2019-03-22 20 1 2019-02-25 100 2 2019-02-01 2019-02-20 15 2 2019-03-22 30 2 2019-02-01 2019-02-20 15 2 2019-02-10 200 2 2019-02-21 2019-03-31 30 2 2019-03-22 30 2 2019-02-21 2019-03-31 30 2 2019-02-10 200 3 2019-02-21 2019-03-31 30 null null null Filter out the rows that do not fall between start_date and end_date:\nSELECT * FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id WHERE purchase_date BETWEEN start_date AND end_date; product_id start_date end_date price product_id purchase_date units 1 2019-02-17 2019-02-28 5 1 2019-02-25 100 1 2019-03-01 2019-03-22 20 1 2019-03-01 15 2 2019-02-01 2019-02-20 15 2 2019-02-10 200 2 2019-02-21 2019-03-31 30 2 2019-03-22 30 Group the filtered result and then use aggregation functions to calculate average price:\nSELECT *, ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id WHERE purchase_date BETWEEN start_date AND end_date GROUP BY 1; product_id start_date end_date price product_id purchase_date units average_price 1 2019-02-17 2019-02-28 5 1 2019-02-25 100 6.96 2 2019-02-01 2019-02-20 15 2 2019-02-10 200 16.96 Select the desired columns:\nSELECT p.product_id, ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price FROM Prices AS p LEFT JOIN UnitsSold AS u ON p.product_id = u.product_id WHERE purchase_date BETWEEN start_date AND end_date GROUP BY 1; product_id average_price 1 6.96 2 16.96 The correct answer is:\nproduct_id average_price 1 6.96 2 16.96 3 0 Summary: The LEFT JOIN operation will return NULL results for rows without without matching records in the UnitsSold table. In the condition p.product_id = u.product_id AND purchase_date BETWEEN start_date AND end_date, the date range check is applied during the join operation, while WHERE purchase_date BETWEEN start_date AND end_date is applied after the join operation. The WHERE clause exlcudes rows with NULL values, which means products with no matching sales records (i.e., where purchase_date doesn’t match) will be excluded from the result. When grouping the result, no rows containing NULL values remain, leading to an incorrect result (missing product_id = 3 with average_price = 0).\nPercentage of Users Attended a Contest SHOW PROBLEM Table: Users\nColumn Name Type user_id int user_name varchar user_id is the primary key (a unique identifier) for this table. Each row in this table represents a user, with their unique ID and name. Table: Register\nColumn Name Type contest_id int user_id int (contest_id, user_id) is the primary key (a unique combination of columns) for this table. Each row in this table represents the registration of a user in a specific contest. Task\nWrite a solution to calculate the percentage of users registered for each contest, rounded to two decimal places.\nReturn the result table sorted by percentage in descending order. If there is a tie in percentage, order by contest_id in ascending order.\nInput:\nUsers table:\nuser_id user_name 6 Alice 2 Bob 7 Alex Register table:\ncontest_id user_id 215 6 209 2 208 2 210 6 208 6 209 7 209 6 215 7 208 7 210 2 207 2 210 7 Output:\ncontest_id percentage 208 100.0 209 100.0 210 100.0 215 66.67 207 33.33 Explanation:\nContests 208, 209, and 210 had 100% user registration. The results are sorted by contest_id in ascending order. Contest 215 had a registration rate of 66.67%, as Alice and Alex registered, out of a total of three users. Contest 207 had a registration rate of 33.33%, as only Bob registered, out of a total of three users. Go to Leetcode 🔗 SHOW CODE MySQL SELECT contest_id, ROUND(COUNT(user_id) * 100 / (SELECT COUNT(user_id) FROM Users),2) percentage FROM Register a GROUP BY contest_id ORDER BY percentage DESC,contest_id ASC; SHOW NOTES $$ \\text{percentage} = \\frac{\\text{number of users attended in the contest}}{\\text{total number of users}} \\times 100 \\% $$\nCompute the total number of users: SELECT COUNT(user_id) FROM Users Compute the number of users attended in the contest: Group the table based on the column contest_id, then count the number of users in each group. Queries Quality and Percentage SHOW PROBLEM Table: Queries\nColumn Name Type query_name varchar result varchar position int rating int This table may contain duplicate rows. It contains information collected from various queries executed on a database. The position column has a value ranging from 1 to 500. The rating column has a value between 1 and 5. Queries with a rating less than 3 are considered poor queries. Definitions:\nQuery quality: The average of the ratio between the query’s rating and its position. Poor query percentage: The percentage of queries with a rating less than 3. Objective: Write a solution to find:\nThe query_name, The quality of each query (rounded to 2 decimal places), The poor_query_percentage for each query (rounded to 2 decimal places). Input: Queries table:\nquery_name result position rating Dog Golden Retriever 1 5 Dog German Shepherd 2 5 Dog Mule 200 1 Cat Shirazi 5 2 Cat Siamese 3 3 Cat Sphynx 7 4 Output:\nquery_name quality poor_query_percentage Dog 2.50 33.33 Cat 0.66 33.33 Explanation:\nDog queries:\nQuality:\n$$ \\left( \\frac{5}{1} + \\frac{5}{2} + \\frac{1}{200} \\right) / 3 = 2.50 $$ Poor query percentage:\n$$ \\frac{1}{3} \\times 100 = 33.33 $$ Cat queries:\nQuality:\n$$ \\left( \\frac{2}{5} + \\frac{3}{3} + \\frac{4}{7} \\right) / 3 = 0.66 $$ Poor query percentage:\n$$ \\frac{1}{3} \\times 100 = 33.33 $$ Go to Leetcode 🔗 SHOW CODE MySQL SELECT query_name, ROUND(AVG(rating / position), 2) AS quality, ROUND(SUM(CASE WHEN rating \u003c 3 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2) AS poor_query_percentage FROM Queries GROUP BY query_name; Monthly Transactions I SHOW PROBLEM Table: Transactions\nColumn Name Type id int country varchar state enum amount int trans_date date id is the primary key of this table. The table stores information about incoming transactions. The state column is an enum with values [“approved”, “declined”]. Task:\nFor each month and country, find the following information:\nThe total number of transactions (trans_count). The total amount of all transactions (trans_total_amount). The number of approved transactions (approved_count). The total amount of approved transactions (approved_total_amount). The results should be returned in any order.\nExample Input:\nid country state amount trans_date 121 US approved 1000 2018-12-18 122 US declined 2000 2018-12-19 123 US approved 2000 2019-01-01 124 DE approved 2000 2019-01-07 Example Output:\nmonth country trans_count approved_count trans_total_amount approved_total_amount 2018-12 US 2 1 3000 1000 2019-01 US 1 1 2000 2000 2019-01 DE 1 1 2000 2000 Go to Leetcode 🔗 SHOW CODE MySQL SELECT DATE_FORMAT(trans_date, '%Y-%m') AS month, country, COUNT(*) AS trans_count, SUM(CASE WHEN state = 'approved' THEN 1 ELSE 0 END) AS approved_count, SUM(amount) AS trans_total_amount, SUM(CASE WHEN state = 'approved' THEN amount ELSE 0 END) AS approved_total_amount FROM Transactions GROUP BY month, country; SELECT DATE_FORMAT(trans_date, '%Y-%m') AS month, country, COUNT(*) AS trans_count, COUNT(IF(state = 'approved', 1, NULL)) AS approved_count, SUM(amount) AS trans_total_amount, SUM(IF(state = 'approved', amount, 0)) AS approved_total_amount FROM Transactions GROUP BY month, country; SHOW NOTES The DATE_FORMAT function in SQL is used to format a date into a specific string format. For example, DATE_FORMAT('2024-12-19', '%Y-%m') will output '2024-12', extracting the year and month from the date. The IF function in SQL returns one value if the condition is true and another value if the condition is false. For example, IF(amount \u003e 1000, 1, 0) will return 1 if the amount is greater than 1000, otherwise, it will return 0. The CASE...WHEN...THEN...ELSE...END statement is similar to the switch statement in other programming languages like Java. It works like the IF function, but with the ability to handle multiple conditions. It checks each condition in sequence and returns the corresponding result for the first true condition. Immediate Food Delivery II SHOW PROBLEM Table: Delivery\nColumn Name Type delivery_id int customer_id int order_date date customer_pref_delivery_date date delivery_id is the unique identifier for each delivery. The table contains information about food deliveries, where customers place orders on a specific date and specify a preferred delivery date (either on the same day or later). If the customer_pref_delivery_date is the same as the order_date, the order is considered immediate; otherwise, it is scheduled. The first order of a customer is defined as the one with the earliest order_date. Each customer has exactly one first order. Task:\nFind the percentage of immediate orders among the first orders of all customers, rounded to two decimal places.\nThe result should follow the format shown below:\nExample Input:\ndelivery_id customer_id order_date customer_pref_delivery_date 1 1 2019-08-01 2019-08-02 2 2 2019-08-02 2019-08-02 3 1 2019-08-11 2019-08-12 4 3 2019-08-24 2019-08-24 5 3 2019-08-21 2019-08-22 6 2 2019-08-11 2019-08-13 7 4 2019-08-09 2019-08-09 Example Output:\nimmediate_percentage 50.00 Explanation:\nCustomer 1 has their first order with delivery_id 1, which is scheduled. Customer 2 has their first order with delivery_id 2, which is immediate. Customer 3 has their first order with delivery_id 5, which is scheduled. Customer 4 has their first order with delivery_id 7, which is immediate. Hence, 50% of the first orders are immediate.\nGo to Leetcode 🔗 SHOW CODE MySQL SELECT ROUND((SUM(IF(order_date = customer_pref_delivery_date, 1, 0)) / COUNT(*)) * 100, 2) AS immediate_percentage FROM (SELECT customer_id, MIN(order_date) AS first_order_date FROM Delivery GROUP BY customer_id) AS first_orders INNER JOIN Delivery AS d ON first_orders.customer_id = d.customer_id AND first_orders.first_order_date = d.order_date; Game Play Analysis IV SHOW PROBLEM Table: Activity\nColumn Name Type player_id int device_id int event_date date games_played int The combination of (player_id, event_date) is the primary key of this table, ensuring each player can only log in once per day. This table tracks the activity of players in games, where each record represents a player’s login and the number of games played (which could be zero) before logging out on a specific day using a particular device. Task:\nCalculate the fraction of players who logged in again on the day after their first login date. The result should be rounded to two decimal places.\nIn other words, identify the players who logged in on consecutive days starting from their first login date, then divide that count by the total number of players.\nExample Input:\nplayer_id device_id event_date games_played 1 2 2016-03-01 5 1 2 2016-03-02 6 2 3 2017-06-25 1 3 1 2016-03-02 0 3 4 2018-07-03 5 Example Output:\nfraction 0.33 Explanation:\nPlayer 1 logged in on 2016-03-01 and 2016-03-02, meaning they logged in for at least two consecutive days, starting from their first login. Player 2 did not log in again on the day after their first login. Player 3 did not log in on consecutive days, as there was a gap between their logins. Thus, only player 1 satisfies the condition, and the fraction is calculated as 1/3 = 0.33.\nGo to Leetcode 🔗 SHOW CODE MySQL SELECT ROUND( SUM(IF(DATEDIFF(event_date, min_event_date) = 1, 1, 0)) / COUNT(DISTINCT player_id), 2) AS fraction FROM ( SELECT player_id, event_date, MIN(event_date) OVER (PARTITION BY player_id) AS min_event_date FROM activity ) AS activity_with_min_date; SHOW NOTES The DATEDIFF function in MySQL calculates the difference in days between two dates. For example, DATEDIFF('2024-12-30', '2024-12-25') will output 5, indicating there are 5 days between the two dates. The PARTITION BY clause is used in window functions to divide the result ser into partitions (groups) based on a specified column. It applies window functions, such as RANK(), SUM(), ROW_NUMBER(), and others, to each partition. This works similarly to GROUP BY, but unlike GROUP BY, the PARTITION BY clause allows retaining the row-level data while applying the window functions. Input Table: employees\ndepartment_id employee_id salary 101 1 5000 101 2 4000 101 3 6000 102 4 4500 102 5 5500 102 6 4800 SELECT department_id, employee_id, salary, RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) AS salary_rank FROM employees; Output (Result of Query):\ndepartment_id employee_id salary salary_rank 101 3 6000 1 101 1 5000 2 101 2 4000 3 102 5 5500 1 102 6 4800 2 102 4 4500 3 Sorting and Grouping User Activity for the Past 30 Days I SHOW PROBLEM Table: Activity\nColumn Name Type user_id int session_id int activity_date date activity_type enum The activity_type column is an ENUM with values: ‘open_session’, ’end_session’, ‘scroll_down’, ‘send_message’. This table logs user activities for a social media website, where each session is linked to exactly one user. The table may contain duplicate rows. Task:\nYou need to find the count of unique active users per day for the 30-day period ending on 2019-07-27, inclusive. A user is considered active on a particular day if they perform at least one activity on that day.\nExample:\nInput: Activity table\nuser_id session_id activity_date activity_type 1 1 2019-07-20 open_session 1 1 2019-07-20 scroll_down 1 1 2019-07-20 end_session 2 4 2019-07-20 open_session 2 4 2019-07-21 send_message 2 4 2019-07-21 end_session 3 2 2019-07-21 open_session 3 2 2019-07-21 send_message 3 2 2019-07-21 end_session 4 3 2019-06-25 open_session 4 3 2019-06-25 end_session Output:\nday active_users 2019-07-20 2 2019-07-21 2 Explanation:\nOnly the days with active users (those who performed at least one activity) are included in the output. For 2019-07-20, users 1 and 2 were active, and for 2019-07-21, users 2 and 3 were active. Go to Leetcode 🔗 SHOW CODE MySQL SELECT activity_date AS day, COUNT(DISTINCT user_id) AS active_users FROM Activity WHERE activity_date \u003c= '2019-07-27' AND DATEDIFF('2019-07-27', activity_date) \u003c 30 GROUP BY activity_date SELECT activity_date AS day, COUNT(DISTINCT user_id) AS active_users FROM Activity WHERE activity_date \u003c= '2019-07-27' AND activity_date\u003e DATE_SUB('2019-07-27',INTERVAL 30 day) GROUP BY activity_date SHOW NOTES In MySQL, both DATEDIFF and DATE_SUB are used for date calculations. DATEDIFF calculates the difference between two dates, returning the result in days. On the other hand, DATE_SUB is used to subtract a specified time interval (such as days, months, or years) from a given date.\nSELECT DATEDIFF('2023-12-31', '2023-01-01'); -- Result: 364 SELECT DATE_SUB('2023-12-31', INTERVAL 30 DAY); -- Result: '2023-12-01' SELECT DATE_SUB('2023-12-31', INTERVAL 2 MONTH); -- Result: '2023-10-31' Product Sales Analysis III SHOW PROBLEM Table: Sales\nColumn Name Type sale_id int product_id int year int quantity int price int The combination of sale_id and year is the primary key of this table, ensuring each record is unique for a given sale. product_id is a foreign key referencing the Product table. Each row in this table represents a sale of a specific product (product_id) in a given year. The price refers to the price per unit of the product. Table: Product\nColumn Name Type product_id int product_name varchar product_id is the primary key of this table, ensuring unique product identifiers. Each row represents the name of a product associated with the corresponding product_id. Task: Write a query to select the product_id, year, quantity, and price for the first year in which each product was sold.\nReturn the result in any order.\nExample:\nInput: Sales table\nsale_id product_id year quantity price 1 100 2008 10 5000 2 100 2009 12 5000 7 200 2011 15 9000 Product table:\nproduct_id product_name 100 Nokia 200 Apple 300 Samsung Output:\nproduct_id first_year quantity price 100 2008 10 5000 200 2011 15 9000 Explanation:\nFor product_id = 100, the first sale occurred in 2008 with a quantity of 10 and a price of 5000. For product_id = 200, the first sale occurred in 2011 with a quantity of 15 and a price of 9000. The query should return the first sale year for each product, along with the corresponding quantity and price.\nGo to Leetcode 🔗 SHOW CODE MySQL SELECT product_id, year AS first_year, quantity, price FROM Sales WHERE (product_id, year) IN ( SELECT product_id, MIN(year) AS year FROM Sales GROUP BY product_id ); SELECT product_id, first_year, quantity, price FROM ( SELECT product_id, year AS first_year, quantity, price, RANK() OVER (PARTITION BY product_id ORDER BY year) AS row_num FROM Sales ) subquery WHERE row_num = 1; SELECT s.product_id, s.year AS first_year, s.quantity, s.price FROM Sales s JOIN ( SELECT product_id, MIN(year) AS first_year FROM Sales GROUP BY product_id ) first_sale ON s.product_id = first_sale.product_id AND s.year = first_sale.first_year; SHOW NOTES Biggest Single Number SHOW PROBLEM Table: MyNumbers\nColumn Name Type num int This table may contain duplicates (i.e., there is no primary key in the SQL table). Each row contains an integer.\nProblem Description\nA single number is a number that appears only once in the MyNumbers table.\nThe task is to find the largest single number. If there is no single number, return null.\nExample 1:\nInput: MyNumbers table:\nnum 8 8 3 3 1 4 5 6 Output:\nnum 6 Explanation:\nThe single numbers are 1, 4, 5, and 6. Since 6 is the largest single number, we return it.\nExample 2:\nInput: MyNumbers table:\nnum 8 8 7 7 3 3 3 Output:\nnum null Explanation:\nThere are no single numbers in the input table, so we return null.\nGo to Leetcode 🔗 SHOW CODE MySQL SELECT MAX(num) AS num FROM ( SELECT num FROM MyNumbers GROUP BY 1 HAVING COUNT(1) = 1 ) AS t; SELECT IF(COUNT(num) = 1, num, null) AS num FROM MyNumbers GROUP BY num ORDER BY 1 DESC LIMIT 1; Advanced Select \u0026 Joins The Number of Employees Which Report to Each Employee SHOW PROBLEM Table: Employees\nColumn Name Type employee_id int name varchar reports_to int age int employee_id is the unique identifier for each employee in the table. This table stores information about employees and the ID of the manager they report to. Some employees may not report to anyone (reports_to is null). A manager is defined as an employee who has at least one other employee reporting to them. Problem Description\nYou are required to write a solution that reports the following information for each manager:\nThe manager’s employee_id and name. The number of employees directly reporting to the manager. The average age of these employees, rounded to the nearest integer. The results should be ordered by employee_id.\nExample 1:\nInput:\nEmployees table:\nemployee_id name reports_to age 9 Hercy null 43 6 Alice 9 41 4 Bob 9 36 2 Winston null 37 Output:\nemployee_id name reports_count average_age 9 Hercy 2 39 Explanation:\nHercy manages 2 employees (Alice and Bob). The average age of Alice and Bob is (41 + 36) / 2 = 38.5, which rounds to 39. Example 2:\nInput:\nEmployees table:\nemployee_id name reports_to age 1 Michael null 45 2 Alice 1 38 3 Bob 1 42 4 Charlie 2 34 5 David 2 40 6 Eve 3 37 7 Frank null 50 8 Grace null 48 Output:\nemployee_id name reports_count average_age 1 Michael 2 40 2 Alice 2 37 3 Bob 1 37 Explanation:\nMichael manages Alice and Bob. The average age of Alice and Bob is (38 + 42) / 2 = 40. Alice manages Charlie and David, with an average age of (34 + 40) / 2 = 37. Bob manages Eve, with an average age of 37. Go to Leetcode 🔗 SHOW CODE MySQL SELECT e1.employee_id, e1.name, COUNT(e1.employee_id) AS reports_count, ROUND(AVG(e2.age)) AS average_age FROM Employees e1 INNER JOIN Employees e2 ON e1.employee_id = e2.reports_to GROUP BY e1.employee_id ORDER BY e1.employee_id; Primary Department for Each Employee SHOW PROBLEM Table: Employee\nColumn Name Type employee_id int department_id int primary_flag varchar The combination of (employee_id, department_id) is the primary key for this table, meaning each employee can belong to multiple departments, but each (employee_id, department_id) pair is unique. employee_id: The ID of the employee. department_id: The ID of the department to which the employee belongs. primary_flag: A flag indicating whether the department is the primary department for the employee. It can be one of the following: 'Y': The department is the primary department. 'N': The department is not the primary department. Problem Description\nEmployees may belong to multiple departments, and when they do, they must designate one department as their primary. If an employee belongs to only one department, the primary_flag for that department will be 'N'.\nYou are tasked with reporting the primary department for each employee. If an employee has only one department, report that department as their primary.\nInput:\nEmployee table:\nemployee_id department_id primary_flag 1 1 N 2 1 Y 2 2 N 3 3 N 4 2 N 4 3 Y 4 4 N Output:\nemployee_id department_id 1 1 2 1 3 3 4 3 Explanation:\nFor employee 1, their only department is department 1, so it is reported as their primary department. Employee 2 belongs to two departments (1 and 2). The primary_flag for department 1 is 'Y', so department 1 is their primary department. Employee 3 only belongs to department 3, so it is reported as their primary department. Employee 4 belongs to three departments (2, 3, and 4). The primary_flag for department 3 is 'Y', so department 3 is reported as their primary department. Go to Leetcode 🔗 SHOW CODE sql SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(1) = 1; SHOW NOTES The UNION operator is used to combine the results of two or more SELECT queries into a single result set. By default, UNION removes duplicate rows, ensuring that the final result contains only distinct records. In contrast, UNION ALL includes all rows, even if they are duplicates. It’s important to note that each SELECT statement involved in a UNION operation must contain the same number of columns, and the corresponding columns must have compatable data types.\nTriangle Judgement SHOW PROBLEM Table: Triangle\nColumn Name Type x int y int z int Primary Key: (x, y, z)\nEach row in this table represents the lengths of three line segments. Task:\nDetermine whether the three line segments (x, y, z) from each row can form a triangle.\nReturn the result table in any order, including a column that specifies if the segments form a triangle.\nTriangle Formation Rule:\nThree segments can form a triangle if and only if the following conditions are met:\n$x + y \u003e z$ $x + z \u003e y$ $y + z \u003e x$ Example:\nInput:\n**Triangle table: **\nx y z 13 15 30 10 20 15 Output:\nx y z triangle 13 15 30 No 10 20 15 Yes Go to Leetcode 🔗 SHOW CODE MySQL SELECT *, IF(x + y \u003e z AND x + z \u003e y AND y + z \u003e x, 'Yes', 'No') AS triangle FROM Triangle; SELECT *, CASE WHEN (x + y \u003e z) AND (x + z \u003e y) AND (y + z \u003e x) THEN 'Yes' ELSE 'No' END AS triangle FROM Triangle; Consecutive Numbers SHOW PROBLEM Table: Logs\nColumn Name Type id int num varchar id is the primary key for this table. The id column is an auto-increment column that starts from 1. Problem Statement:\nFind all numbers (num) that appear at least three times consecutively in the table.\nReturn the result table in any order.\nExample:\nInput:\nLogs table:\nid num 1 1 2 1 3 1 4 2 5 1 6 2 7 2 Output:\nConsecutiveNums 1 Explanation:\nThe number 1 is the only value that appears at least three times consecutively in the table.\nGo to Leetcode 🔗 SHOW CODE MySQL SELECT DISTINCT l1.num AS ConsecutiveNums FROM Logs l1 JOIN Logs l2 ON l1.id = l2.id - 1 JOIN Logs l3 ON l2.id = l3.id - 1 WHERE l1.num = l2.num AND l2.num = l3.num; SELECT DISTINCT l2.num AS ConsecutiveNums FROM Logs AS l1 JOIN Logs AS l2 ON l1.id = l2.id - 1 AND l1.num = l2.num JOIN Logs AS l3 ON l2.id = l3.id - 1 AND l2.num = l3.num; Product Price at a Given Date SHOW PROBLEM Table: Products\nColumn Name Type product_id int new_price int change_date date (product_id, change_date) is the primary key (a combination of columns with unique values) of this table. Each row indicates that the price of a product was changed to a new price on a specific date. Problem Statement\nWrite a query to find the prices of all products on 2019-08-16. Assume the price of all products before any change is 10.\nReturn the result in any order.\nExample:\nInput:\nProducts table:\nproduct_id new_price change_date 1 20 2019-08-14 2 50 2019-08-14 1 30 2019-08-15 1 35 2019-08-16 2 65 2019-08-17 3 20 2019-08-18 Output:\nproduct_id price 2 50 1 35 3 10 Go to Leetcode 🔗 SHOW CODE MySQL WITH T AS (SELECT DISTINCT product_id FROM Products), P AS ( SELECT product_id, new_price AS price FROM Products WHERE (product_id, change_date) IN ( SELECT product_id, MAX(change_date) AS change_date FROM Products WHERE change_date \u003c= '2019-08-16' GROUP BY 1 ) ) SELECT product_id, IFNULL(price, 10) AS price FROM T LEFT JOIN P USING (product_id); WITH P AS ( SELECT p1.product_id, new_price, change_date FROM ( SELECT DISTINCT product_id FROM Products ) AS p1 LEFT JOIN Products AS p2 ON p1.product_id = p2.product_id AND p2.change_date \u003c= '2019-08-16' ), T AS ( SELECT *, RANK() OVER ( PARTITION BY product_id ORDER BY change_date DESC ) AS rk FROM P ) SELECT product_id, IFNULL(new_price, 10) AS price FROM T WHERE rk = 1; SHOW NOTES Last Person to Fit in the Bus SHOW PROBLEM Table: Queue\nColumn Name Type person_id int person_name varchar weight int turn int The person_id column contains unique values. This table holds information about people waiting to board a bus. The person_id and turn columns contain values from 1 to n, where n is the number of rows in the table. The turn column determines the order in which people will board the bus. A turn value of 1 indicates the first person to board, and turn = n indicates the last person to board. The weight column represents the person’s weight in kilograms. The bus has a weight limit of 1000 kilograms, so some people may not be able to board if the total weight exceeds this limit. The goal is to identify the name of the last person who can board the bus without exceeding the weight limit.\nOnly one person can board the bus at any given time, based on their turn. Input:\nQueue table:\nperson_id person_name weight turn 5 Alice 250 1 4 Bob 175 5 3 Alex 350 2 6 John Cena 400 3 1 Winston 500 6 2 Marie 200 4 Output:\nperson_name John Cena Explanation:\nThe following table shows the order in which people board the bus, ordered by the turn column for simplicity:\nTurn person_id person_name weight Total Weight 1 5 Alice 250 250 2 3 Alex 350 600 3 6 John Cena 400 1000 4 2 Marie 200 1200 5 4 Bob 175 ___ 6 1 Winston 500 ___ John Cena is the last person who can board the bus without exceeding the weight limit of 1000 kilograms.\nGo to Leetcode 🔗 SHOW CODE MySQL WITH T AS ( SELECT person_name, SUM(weight) OVER (ORDER BY turn) AS acumulated_weight FROM Queue ) SELECT person_name FROM T WHERE acumulated_weight \u003c= 1000 ORDER BY acumulated_weight DESC LIMIT 1; Count Salary Categories SHOW PROBLEM Table: Accounts\nColumn Name Type account_id int income int The account_id column is the primary key, meaning it contains unique values for each row. Each row represents the monthly income of a specific bank account. Task:\nWrite a solution to calculate the number of bank accounts in each salary category. The salary categories are defined as:\n“Low Salary”: Salaries strictly less than $20,000. “Average Salary”: Salaries in the inclusive range [$20,000, $50,000]. “High Salary”: Salaries strictly greater than $50,000. The result table should contain all three categories. If no accounts fall into a category, return 0 for that category.\nThe result can be returned in any order.\nInput:\nAccounts table:\naccount_id income 3 108939 2 12747 8 87709 6 91796 Output:\ncategory accounts_count Low Salary 1 Average Salary 0 High Salary 3 Explanation:\nLow Salary: Account 2 has an income of $12,747, which is below $20,000. Average Salary: There are no accounts with an income between $20,000 and $50,000. High Salary: Accounts 3, 6, and 8 have incomes above $50,000. Go to Leetcode 🔗 SHOW CODE MySQL WITH S AS ( SELECT 'Low Salary' AS category UNION SELECT 'Average Salary' UNION SELECT 'High Salary' ), T AS ( SELECT CASE WHEN income \u003c 20000 THEN 'Low Salary' WHEN income \u003e 50000 THEN 'High Salary' ELSE 'Average Salary' END AS category, COUNT(1) AS accounts_count FROM Accounts GROUP BY category ) SELECT category, IFNULL(accounts_count, 0) AS accounts_count FROM S LEFT JOIN T USING (category); Subqueries Exchange Seats SHOW PROBLEM Table: Seat\nColumn Name Type id int student varchar id is the primary key for this table. Each row represents a student’s name and their seat ID. The id starts from 1 and increases consecutively. Problem Description:\nWrite a query to swap the seat IDs of every two consecutive students in the Seat table. If the number of students is odd, the last student’s seat ID should remain unchanged.\nThe result should be ordered by the id column in ascending order.\nInput:\nSeat table:\nid student 1 Abbot 2 Doris 3 Emerson 4 Green 5 Jeames Output:\nid student 1 Doris 2 Abbot 3 Green 4 Emerson 5 Jeames Explanation:\nThe students Abbot and Doris swap places, as well as Emerson and Green. Since there are an odd number of students, Jeames’s seat remains unchanged. Go to Leetcode 🔗 SHOW CODE MySQL SELECT CASE WHEN id % 2 = 1 AND id \u003c (SELECT MAX(id) FROM Seat) THEN id + 1 WHEN id % 2 = 0 THEN id - 1 ELSE id END AS id, student FROM Seat ORDER BY id; Movie Rating SHOW PROBLEM Table: Movies\nColumn Name Type movie_id int title varchar movie_id is the primary key (column with unique values) for this table. title is the name of the movie.\nTable: Users\nColumn Name Type user_id int name varchar user_id is the primary key (column with unique values) for this table. The column ’name’ has unique values.\nTable: MovieRating\nColumn Name Type movie_id int user_id int rating int created_at date (movie_id, user_id) is the primary key (column with unique values) for this table. This table contains the rating of a movie by a user in their review. created_at is the user’s review date.\nProblem:\nFind the name of the user who has rated the greatest number of movies. In case of a tie, return the lexicographically smaller user name. Find the movie name with the highest average rating in February 2020. In case of a tie, return the lexicographically smaller movie name. Result format:\nThe result should contain two columns:\nresults – containing the user name with the greatest number of movie ratings. results – containing the movie name with the highest average rating in February 2020. Input:\nMovies table:\nmovie_id title 1 Avengers 2 Frozen 2 3 Joker Users table:\nuser_id name 1 Daniel 2 Monica 3 Maria 4 James MovieRating table:\nmovie_id user_id rating created_at 1 1 3 2020-01-12 1 2 4 2020-02-11 1 3 2 2020-02-12 1 4 1 2020-01-01 2 1 5 2020-02-17 2 2 2 2020-02-01 2 3 2 2020-03-01 3 1 3 2020-02-22 3 2 4 2020-02-25 Output:\nresults Daniel Frozen 2 Explanation:\nDaniel and Monica have rated 3 movies (“Avengers”, “Frozen 2” and “Joker”), but Daniel is lexicographically smaller. “Frozen 2” and “Joker” both have an average rating of 3.5 in February, but “Frozen 2” is lexicographically smaller. Go to Leetcode 🔗 SHOW CODE MySQL ( SELECT name AS results FROM Users JOIN MovieRating USING (user_id) GROUP BY user_id ORDER BY COUNT(1) DESC, name LIMIT 1 ) UNION ALL ( SELECT title FROM MovieRating JOIN Movies USING (movie_id) WHERE DATE_FORMAT(created_at, '%Y-%m') = '2020-02' GROUP BY movie_id ORDER BY AVG(rating) DESC, title LIMIT 1 ); ",
  "wordCount" : "10938",
  "inLanguage": "en",
  "datePublished": "2024-12-25T10:20:09+08:00",
  "dateModified": "2024-12-25T10:20:09+08:00",
  "author":{
    "@type": "Person",
    "name": "Signal Yu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://signalyu.github.io/posts/4-engineering-and-technology/computer-science/database/database-management-system/1-database-management-system/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Signal's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://signalyu.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://signalyu.github.io/" accesskey="h" title="Signal&#39;s Blog (Alt + H)">
                <img src="https://signalyu.github.io/apple-touch-icon.png" alt="" aria-label="logo"
                    height="40">Signal&#39;s Blog</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://signalyu.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://signalyu.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://signalyu.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://signalyu.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://signalyu.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Database Management Systems
    </h1>
    <div class="post-meta"><span title='2024-12-25 10:20:09 +0800 HKT'>Dec 25 2024</span>&nbsp;·&nbsp;Signal Yu

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction-to-dbms" aria-label="Introduction to DBMS">Introduction to DBMS</a></li>
                <li>
                    <a href="#mysql" aria-label="MySQL">MySQL</a><ul>
                        
                <li>
                    <a href="#sql-commands" aria-label="SQL Commands">SQL Commands</a></li>
                <li>
                    <a href="#sql-query-execution-order" aria-label="SQL Query Execution Order">SQL Query Execution Order</a></li>
                <li>
                    <a href="#select" aria-label="Select">Select</a><ul>
                        
                <li>
                    <a href="#find-customer-referee" aria-label="Find Customer Referee">Find Customer Referee</a></li>
                <li>
                    <a href="#article-views-i" aria-label="Article Views I">Article Views I</a></li></ul>
                </li>
                <li>
                    <a href="#baisc-joins" aria-label="Baisc Joins">Baisc Joins</a><ul>
                        
                <li>
                    <a href="#left-join-replace-employee-id-with-the-unique-identifier" aria-label="LEFT JOIN: Replace Employee ID With The Unique Identifier">LEFT JOIN: Replace Employee ID With The Unique Identifier</a></li>
                <li>
                    <a href="#left-join-confirmation-rate" aria-label="LEFT JOIN: Confirmation Rate">LEFT JOIN: Confirmation Rate</a></li>
                <li>
                    <a href="#inner-join-product-sales-analysis-i" aria-label="INNER JOIN: Product Sales Analysis I">INNER JOIN: Product Sales Analysis I</a></li>
                <li>
                    <a href="#left-join-customer-who-visited-but-did-not-make-any-transactions" aria-label="LEFT JOIN: Customer Who Visited but Did Not Make Any Transactions">LEFT JOIN: Customer Who Visited but Did Not Make Any Transactions</a></li>
                <li>
                    <a href="#self-join-rising-temperature" aria-label="SELF JOIN: Rising Temperature">SELF JOIN: Rising Temperature</a></li>
                <li>
                    <a href="#self-join-managers-with-at-least-5-direct-reports" aria-label="SELF JOIN: Managers with at Least 5 Direct Reports">SELF JOIN: Managers with at Least 5 Direct Reports</a></li>
                <li>
                    <a href="#self-join-average-time-of-process-per-machine" aria-label="SELF JOIN: Average Time of Process per Machine">SELF JOIN: Average Time of Process per Machine</a></li>
                <li>
                    <a href="#cross-join-students-and-examinations" aria-label="CROSS JOIN: Students and Examinations">CROSS JOIN: Students and Examinations</a></li></ul>
                </li>
                <li>
                    <a href="#basic-aggregate-functions" aria-label="Basic Aggregate Functions">Basic Aggregate Functions</a><ul>
                        
                <li>
                    <a href="#average-selling-price" aria-label="Average Selling Price">Average Selling Price</a></li>
                <li>
                    <a href="#percentage-of-users-attended-a-contest" aria-label="Percentage of Users Attended a Contest">Percentage of Users Attended a Contest</a></li>
                <li>
                    <a href="#queries-quality-and-percentage" aria-label="Queries Quality and Percentage">Queries Quality and Percentage</a></li>
                <li>
                    <a href="#monthly-transactions-i" aria-label="Monthly Transactions I">Monthly Transactions I</a></li>
                <li>
                    <a href="#immediate-food-delivery-ii" aria-label="Immediate Food Delivery II">Immediate Food Delivery II</a></li>
                <li>
                    <a href="#game-play-analysis-iv" aria-label="Game Play Analysis IV">Game Play Analysis IV</a></li></ul>
                </li>
                <li>
                    <a href="#sorting-and-grouping" aria-label="Sorting and Grouping">Sorting and Grouping</a><ul>
                        
                <li>
                    <a href="#user-activity-for-the-past-30-days-i" aria-label="User Activity for the Past 30 Days I">User Activity for the Past 30 Days I</a></li>
                <li>
                    <a href="#product-sales-analysis-iii" aria-label="Product Sales Analysis III">Product Sales Analysis III</a></li>
                <li>
                    <a href="#biggest-single-number" aria-label="Biggest Single Number">Biggest Single Number</a></li></ul>
                </li>
                <li>
                    <a href="#advanced-select--joins" aria-label="Advanced Select &amp; Joins">Advanced Select &amp; Joins</a><ul>
                        
                <li>
                    <a href="#the-number-of-employees-which-report-to-each-employee" aria-label="The Number of Employees Which Report to Each Employee">The Number of Employees Which Report to Each Employee</a></li>
                <li>
                    <a href="#primary-department-for-each-employee" aria-label="Primary Department for Each Employee">Primary Department for Each Employee</a></li>
                <li>
                    <a href="#triangle-judgement" aria-label="Triangle Judgement">Triangle Judgement</a></li>
                <li>
                    <a href="#consecutive-numbers" aria-label="Consecutive Numbers">Consecutive Numbers</a></li>
                <li>
                    <a href="#product-price-at-a-given-date" aria-label="Product Price at a Given Date">Product Price at a Given Date</a></li>
                <li>
                    <a href="#last-person-to-fit-in-the-bus" aria-label="Last Person to Fit in the Bus">Last Person to Fit in the Bus</a></li>
                <li>
                    <a href="#count-salary-categories" aria-label="Count Salary Categories">Count Salary Categories</a></li></ul>
                </li>
                <li>
                    <a href="#subqueries" aria-label="Subqueries">Subqueries</a><ul>
                        
                <li>
                    <a href="#exchange-seats" aria-label="Exchange Seats">Exchange Seats</a></li>
                <li>
                    <a href="#movie-rating" aria-label="Movie Rating">Movie Rating</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="introduction-to-dbms">Introduction to DBMS<a hidden class="anchor" aria-hidden="true" href="#introduction-to-dbms">#</a></h1>
<blockquote>
<p>A <strong>Database Management System (DBMS)</strong> is software that provides an interface for users to interact with databases. It enables the management, storage, and manipulation of data within databases. DBMS can be broadly classified into two main types: <strong>Relational DBMS</strong> and <strong>NoSQL DBMS</strong>.</p>
</blockquote>
<blockquote>
<p>In a <strong>Relational DBMS</strong>, data is stored in structured tables and is manipulated using SQL (Structured Query Language). Examples of relational DBMS inlcude <strong>MySQL</strong>, <strong>Oracle</strong>, and <strong>PostgreSQL</strong>.</p>
</blockquote>
<blockquote>
<p>In a <strong>NoSQL DBMS</strong>, data is typically unstructured or semi-structured, offering flexibility to handle diverse data types. Examples of NoSQL DBMS include <strong>MongoDB</strong> and <strong>Redis</strong>.</p>
</blockquote>
<hr>
<h1 id="mysql">MySQL<a hidden class="anchor" aria-hidden="true" href="#mysql">#</a></h1>
<blockquote>
<p><strong>MySQL</strong> is a relational database management system (RDBMS) that uses <strong>Structured Query Language (SQL)</strong> to interact with databases. It stores data in tables made up of rows and columns, allowing for efficient organization, retrival, and manipulation of data.</p>
</blockquote>
<hr>
<h2 id="sql-commands">SQL Commands<a hidden class="anchor" aria-hidden="true" href="#sql-commands">#</a></h2>
<blockquote>
<p><strong>SQL Commands</strong> are used to interact with relational databases. These commands can be classified into five types: <strong>DDL</strong>, <strong>DQL</strong>, <strong>DML</strong>, <strong>DCL</strong>, and <strong>TCL</strong>.</p>
</blockquote>
<figure class="align-center ">
    <img loading="lazy" src="/img/database-management-system/1-sql-commands.svg#center" width="100%" height="100%"/> <figcaption>
            SQL Commands
        </figcaption>
</figure>

<ul>
<li><strong>DDL (Data Definition Language)</strong>: Used to define and manage the structure of database instances, such as creating, altering, and deleting tables, and defining constraints.</li>
<li><strong>DQL (Data Query Language)</strong>: Used to retrive data from the database, primarily through the <code>SELECT</code> statement.</li>
<li><strong>DML (Data Manipulation Language)</strong>: Used to manipulate data within tables, such as inserting, updating, and deleting records.</li>
<li><strong>DCL (Data Control Language)</strong>: Used to control access to data, manage user priviledges, and ensure data security. It includes commands like <code>GRANT</code> and <code>REVOKE</code>.</li>
<li><strong>TCL (Transaction Control Language)</strong>: Used to manage transactions, ensuring data consistency. It includes commands like <code>COMMIT</code>, <code>ROLLBACK</code>, and <code>SAVEPOINT</code>.</li>
</ul>
<hr>
<h2 id="sql-query-execution-order">SQL Query Execution Order<a hidden class="anchor" aria-hidden="true" href="#sql-query-execution-order">#</a></h2>
<blockquote>
<p><strong>MySQL Execution Order</strong>: In MySQL, the execution order of an SQL query differs from the order in which components (e.g., <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>) are written in the query. MySQL begins by identifying the tables or views specified in the <code>FROM</code> clause. If there are any <code>JOIN</code> operation, MySQL performs the joins first and applies the <code>ON</code> condition. After completing the join operations, MySQL filters the based on the conditions specified in the <code>WHERE</code> clause.</p>
</blockquote>
<blockquote>
<p>If a <code>GROUP BY</code> clause is present, MySQL groups the rows based on the specified column(s) and then executes any aggregation functions (e.g., <code>SUM()</code>, <code>COUNT()</code>, etc.). Following the grouping, if a <code>HAVING</code> clause is provided, MySQL further filters the grouped results based on the specified condition.</p>
</blockquote>
<blockquote>
<p>After filtering grouped results, MySQL selects the specified columns in the <code>SELECT</code> clause. If the <code>DISTINCT</code> keyword is used, MySQL removes duplicate rows from the selected result. Once the rows are selected and duplicates are removed, MySQL sorts the result set according to the rules defined in the <code>ORDER BY</code> clause.</p>
</blockquote>
<blockquote>
<p>Finally, if a <code>LIMIT</code> or <code>OFFSET</code> clause is included, MySQL limits the number of rows returned, starting from the specified <code>OFFSET</code>.</p>
</blockquote>
<figure class="align-center ">
    <img loading="lazy" src="/img/database-management-system/2-sql-query-execution-order.png#center" width="100%" height="100%"/> <figcaption>
            SQL Query Execution Order
        </figcaption>
</figure>

<hr>
<h2 id="select">Select<a hidden class="anchor" aria-hidden="true" href="#select">#</a></h2>
<h3 id="find-customer-referee">Find Customer Referee<a hidden class="anchor" aria-hidden="true" href="#find-customer-referee">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Customer</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
</tr>
<tr>
<td>referee_id</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>The <strong>id</strong> column is the primary key.</li>
<li>Each row represents a customer, their name, and the <strong>id</strong> of the customer who referred them. If a customer wasn&rsquo;t referred by anyone, the <strong>referee_id</strong> is <code>NULL</code>.</li>
</ul>
<p><strong>Problem:</strong></p>
<p>Find the names of customers who were <strong>not referred</strong> by the customer with <code>id = 2</code>.</p>
<p>The result can be returned in any order.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong>
Customer table:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>referee_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Will</td>
<td>NULL</td>
</tr>
<tr>
<td>2</td>
<td>Jane</td>
<td>NULL</td>
</tr>
<tr>
<td>3</td>
<td>Alex</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>Bill</td>
<td>NULL</td>
</tr>
<tr>
<td>5</td>
<td>Zack</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>Mark</td>
<td>2</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Will</td>
</tr>
<tr>
<td>Jane</td>
</tr>
<tr>
<td>Bill</td>
</tr>
<tr>
<td>Zack</td>
</tr>
</tbody>
</table>
<hr>

</details></p>


<a href="https://leetcode.com/problems/find-customer-referee?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT name FROM Customer
WHERE referee_id != 2 OR referee_id IS NULL;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>In SQL, <code>NULL</code> is not equal to any value, including <code>2</code>. Therefore, the condition <code>referee_id != 2</code> will exclude records where <code>referee_id is NULL, because comparisons with </code>NULL<code>always result in an unknown</code>NULL<code>value, which is neither</code>TRUE<code>nor</code>FALSE`. <strong>It is crucial to consider the handling of NULL values when working with databases.</strong></p>
</blockquote>
</details></p>

<hr>
<h3 id="article-views-i">Article Views I<a hidden class="anchor" aria-hidden="true" href="#article-views-i">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Views</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>article_id</td>
<td>int</td>
</tr>
<tr>
<td>author_id</td>
<td>int</td>
</tr>
<tr>
<td>viewer_id</td>
<td>int</td>
</tr>
<tr>
<td>view_date</td>
<td>date</td>
</tr>
</tbody>
</table>
<ul>
<li>There is <strong>no primary key</strong> in this table, and the table may contain <strong>duplicate rows</strong>.</li>
<li>Each row indicates that a viewer viewed an article, where the article is written by an author, on a specific date.</li>
<li>If <strong>author_id</strong> and <strong>viewer_id</strong> are the same, it indicates that the author viewed their own article.</li>
</ul>
<p><strong>Problem:</strong></p>
<p>Write a query to find the IDs of authors who have viewed at least one of their own articles.</p>
<p>Return the result table sorted by <strong>author_id</strong> in ascending order.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong></p>
<p>Views table:</p>
<table>
<thead>
<tr>
<th>article_id</th>
<th>author_id</th>
<th>viewer_id</th>
<th>view_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>3</td>
<td>5</td>
<td>2019-08-01</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>6</td>
<td>2019-08-02</td>
</tr>
<tr>
<td>2</td>
<td>7</td>
<td>7</td>
<td>2019-08-01</td>
</tr>
<tr>
<td>2</td>
<td>7</td>
<td>6</td>
<td>2019-08-02</td>
</tr>
<tr>
<td>4</td>
<td>7</td>
<td>1</td>
<td>2019-07-22</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>4</td>
<td>2019-07-21</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>4</td>
<td>2019-07-21</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
</tr>
<tr>
<td>7</td>
</tr>
</tbody>
</table>
<hr>

</details></p>


<a href="https://leetcode.com/problems/article-views-i?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT DISTINCT author_id AS id FROM Views
WHERE author_id = viewer_id
ORDER BY id ASC;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>In SQL, the <code>DISTINCT</code> keyword is used to remove duplicate records from the result set, ensuring that only unique values are returned. It is commonly used in scenarios such as aggregating distinct values and ensuring uniqueness in join queries.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">#</span> Aggregating <span style="color:#66d9ef">unique</span> <span style="color:#66d9ef">values</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Order_Items;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span> Ensuring <span style="color:#66d9ef">unique</span> results <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">join</span> queries
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> <span style="color:#66d9ef">c</span>.customer_id, <span style="color:#66d9ef">c</span>.name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers <span style="color:#66d9ef">c</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Orders o <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">c</span>.customer_id <span style="color:#f92672">=</span> o.customer_id;
</span></span></code></pre></div>
</details></p>

<hr>
<h2 id="baisc-joins">Baisc Joins<a hidden class="anchor" aria-hidden="true" href="#baisc-joins">#</a></h2>
<h3 id="left-join-replace-employee-id-with-the-unique-identifier">LEFT JOIN: Replace Employee ID With The Unique Identifier<a hidden class="anchor" aria-hidden="true" href="#left-join-replace-employee-id-with-the-unique-identifier">#</a></h3>
<blockquote>
<p>In MySQL, <code>LEFT JOIN</code> is used to combine rows from two or more tables based on a related column between them. It returns all rows from the left table and the matching rows from the right table. If there is no match, the result will include <code>NULL</code> values for the column from the right table.</p>
</blockquote>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Tables:</strong></p>
<p><strong>Employees</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>id</code> is the primary key for this table.</li>
<li>Each row represents an employee in the company, containing their <code>id</code> and <code>name</code>.</li>
</ul>
<p><strong>EmployeeUNI</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>unique_id</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>(id, unique_id)</code> is the primary key, meaning the combination of <code>id</code> and <code>unique_id</code> is unique across the table.</li>
<li>Each row represents an employee&rsquo;s <code>id</code> and their corresponding <code>unique_id</code> in the company.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Write a SQL query that returns the <code>unique_id</code> of each employee from the <code>Employees</code> table. If an employee does not have a corresponding <code>unique_id</code>, return <code>NULL</code> for that employee.</p>
<p><strong>Query Requirements:</strong></p>
<ol>
<li>If an employee has a <code>unique_id</code>, show it.</li>
<li>If an employee does not have a <code>unique_id</code>, return <code>NULL</code>.</li>
<li>The result should display the <code>unique_id</code> and the <code>name</code> of each employee.</li>
</ol>
<p>The results can be returned in any order.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong></p>
<p><code>Employees</code> table:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
</tr>
<tr>
<td>7</td>
<td>Bob</td>
</tr>
<tr>
<td>11</td>
<td>Meir</td>
</tr>
<tr>
<td>90</td>
<td>Winston</td>
</tr>
<tr>
<td>3</td>
<td>Jonathan</td>
</tr>
</tbody>
</table>
<p><code>EmployeeUNI</code> table:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>unique_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>11</td>
<td>2</td>
</tr>
<tr>
<td>90</td>
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>unique_id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>NULL</td>
<td>Alice</td>
</tr>
<tr>
<td>NULL</td>
<td>Bob</td>
</tr>
<tr>
<td>2</td>
<td>Meir</td>
</tr>
<tr>
<td>3</td>
<td>Winston</td>
</tr>
<tr>
<td>1</td>
<td>Jonathan</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>Alice and Bob do not have a <code>unique_id</code>, so <code>NULL</code> is shown for both.</li>
<li>Meir has a <code>unique_id</code> of <code>2</code>.</li>
<li>Winston has a <code>unique_id</code> of <code>3</code>.</li>
<li>Jonathan has a <code>unique_id</code> of <code>1</code>.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/replace-employee-id-with-the-unique-identifier?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT euni.unique_id, e.name
FROM Employees e
LEFT JOIN EmployeeUNI euni
ON e.id = euni.id;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="left-join-confirmation-rate">LEFT JOIN: Confirmation Rate<a hidden class="anchor" aria-hidden="true" href="#left-join-confirmation-rate">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Signups</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
<tr>
<td>time_stamp</td>
<td>datetime</td>
</tr>
</tbody>
</table>
<ul>
<li><code>user_id</code> is a unique identifier for each user.</li>
<li>Each row represents the signup time for the user identified by <code>user_id</code>.</li>
</ul>
<p><strong>Table: Confirmations</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
<tr>
<td>time_stamp</td>
<td>datetime</td>
</tr>
<tr>
<td>action</td>
<td>ENUM</td>
</tr>
</tbody>
</table>
<ul>
<li>The primary key is a combination of <code>user_id</code> and <code>time_stamp</code>.</li>
<li><code>user_id</code> is a foreign key referencing the <code>Signups</code> table.</li>
<li><code>action</code> is an ENUM with two possible values: <code>'confirmed'</code> or <code>'timeout'</code>.</li>
<li>Each row represents a confirmation request made by the user with <code>user_id</code>, indicating whether the confirmation message was confirmed (<code>'confirmed'</code>) or timed out (<code>'timeout'</code>).</li>
</ul>
<p><strong>Problem Description</strong></p>
<p>The <strong>confirmation rate</strong> of a user is calculated as the ratio of <code>'confirmed'</code> actions to the total number of confirmation requests. If a user has not made any confirmation requests, the confirmation rate is <code>0</code>. The rate should be rounded to two decimal places.</p>
<p><strong>Goal</strong></p>
<p>Write a SQL query to find the confirmation rate for each user.</p>
<p>Return the result in any order.</p>
<hr>
<p><strong>Input</strong></p>
<p><strong>Signups table:</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>time_stamp</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>2020-03-21 10:16:13</td>
</tr>
<tr>
<td>7</td>
<td>2020-01-04 13:57:59</td>
</tr>
<tr>
<td>2</td>
<td>2020-07-29 23:09:44</td>
</tr>
<tr>
<td>6</td>
<td>2020-12-09 10:39:37</td>
</tr>
</tbody>
</table>
<p><strong>Confirmations table:</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>time_stamp</th>
<th>action</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>2021-01-06 03:30:46</td>
<td>timeout</td>
</tr>
<tr>
<td>3</td>
<td>2021-07-14 14:00:00</td>
<td>timeout</td>
</tr>
<tr>
<td>7</td>
<td>2021-06-12 11:57:29</td>
<td>confirmed</td>
</tr>
<tr>
<td>7</td>
<td>2021-06-13 12:58:28</td>
<td>confirmed</td>
</tr>
<tr>
<td>7</td>
<td>2021-06-14 13:59:27</td>
<td>confirmed</td>
</tr>
<tr>
<td>2</td>
<td>2021-01-22 00:00:00</td>
<td>confirmed</td>
</tr>
<tr>
<td>2</td>
<td>2021-02-28 23:59:59</td>
<td>timeout</td>
</tr>
</tbody>
</table>
<p><strong>Output</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>confirmation_rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>0.00</td>
</tr>
<tr>
<td>3</td>
<td>0.00</td>
</tr>
<tr>
<td>7</td>
<td>1.00</td>
</tr>
<tr>
<td>2</td>
<td>0.50</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>User <code>6</code> did not request any confirmation messages, so their confirmation rate is <code>0</code>.</li>
<li>User <code>3</code> made two confirmation requests, but both timed out, so their confirmation rate is <code>0</code>.</li>
<li>User <code>7</code> made three requests, and all were confirmed, so their confirmation rate is <code>1.00</code>.</li>
<li>User <code>2</code> made two requests: one confirmed and one timed out, so their confirmation rate is <code>1/2 = 0.50</code>.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/confirmation-rate?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT
    user_id,
    ROUND(IFNULL(SUM(action = 'confirmed') / COUNT(1), 0), 2) AS confirmation_rate
FROM
    SignUps
    LEFT JOIN Confirmations USING (user_id)
GROUP BY 1;

SELECT s.user_id, 
    CASE WHEN c.user_id IS NULL THEN 0.00 
        ELSE ROUND(SUM(CASE WHEN action = 'confirmed' THEN 1 ELSE 0 END) / COUNT(*),2) 
    END 
    AS confirmation_rate
FROM Signups s
LEFT JOIN Confirmations c ON c.user_id = s.user_id
GROUP BY s.user_id
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <ul>
<li><code>SUM(action = 'confirmed')</code>: <code>action = 'confirmed'</code> returns <code>1</code> for confirmed actions and <code>0</code> for <code>'timeout'</code> action.</li>
<li><code>COUNT(1)</code>: Counts the total number of rows. (<strong>Use <code>COUNT(*)</code> for counting rows is more clear and idiomatic</strong>).</li>
<li><code>LEFT JOIN Confirmations USING (user_id)</code>: Joins the <code>Signups</code> table with the <code>Confirmations</code> table on the <code>user_id</code> column.</li>
<li><code>GROUP BY 1</code>: A shorthand for <code>GROUP BY user_id</code>. It groups the results by the first column in the <code>SELECT</code> list, which is <code>user_id</code> in this case.</li>
</ul>

</details></p>

<hr>
<h3 id="inner-join-product-sales-analysis-i">INNER JOIN: Product Sales Analysis I<a hidden class="anchor" aria-hidden="true" href="#inner-join-product-sales-analysis-i">#</a></h3>
<blockquote>
<p>In MySQL, the <code>INNER JOIN</code> is used to combine rows from two or more tables based on a related column between them. It only returns rows where there is a match in all the joined tables.</p>
</blockquote>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Tables:</strong></p>
<p><strong>Sales</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>sale_id</td>
<td>int</td>
</tr>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>year</td>
<td>int</td>
</tr>
<tr>
<td>quantity</td>
<td>int</td>
</tr>
<tr>
<td>price</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>(sale_id, year)</code> is the primary key, meaning this combination of columns is unique.</li>
<li><code>product_id</code> is a foreign key referencing the <code>Product</code> table.</li>
<li>Each row represents a sale of a product identified by <code>product_id</code> in a particular year.</li>
<li>The <code>price</code> is per unit of the product.</li>
</ul>
<p><strong>Product</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>product_name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>product_id</code> is the primary key for this table.</li>
<li>Each row represents a product with its <code>product_name</code>.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Write a SQL query to report the <code>product_name</code>, <code>year</code>, and <code>price</code> for each sale in the <code>Sales</code> table.</p>
<p><strong>Query Requirements:</strong></p>
<ol>
<li>Return the <code>product_name</code> from the <code>Product</code> table, corresponding to the <code>product_id</code> in the <code>Sales</code> table.</li>
<li>Include the <code>year</code> and <code>price</code> from the <code>Sales</code> table for each sale.</li>
<li>The result can be returned in any order.</li>
</ol>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong></p>
<p><code>Sales</code> table:</p>
<table>
<thead>
<tr>
<th>sale_id</th>
<th>product_id</th>
<th>year</th>
<th>quantity</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>100</td>
<td>2008</td>
<td>10</td>
<td>5000</td>
</tr>
<tr>
<td>2</td>
<td>100</td>
<td>2009</td>
<td>12</td>
<td>5000</td>
</tr>
<tr>
<td>7</td>
<td>200</td>
<td>2011</td>
<td>15</td>
<td>9000</td>
</tr>
</tbody>
</table>
<p><code>Product</code> table:</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>product_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>Nokia</td>
</tr>
<tr>
<td>200</td>
<td>Apple</td>
</tr>
<tr>
<td>300</td>
<td>Samsung</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>product_name</th>
<th>year</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nokia</td>
<td>2008</td>
<td>5000</td>
</tr>
<tr>
<td>Nokia</td>
<td>2009</td>
<td>5000</td>
</tr>
<tr>
<td>Apple</td>
<td>2011</td>
<td>9000</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>From <code>sale_id = 1</code>, we can conclude that Nokia was sold for 5000 in 2008.</li>
<li>From <code>sale_id = 2</code>, we can conclude that Nokia was sold for 5000 in 2009.</li>
<li>From <code>sale_id = 7</code>, we can conclude that Apple was sold for 9000 in 2011.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/product-sales-analysis-i?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT p.product_name, s.year, s.price
FROM Sales s
INNER JOIN Product p
ON s.product_id = p.product_id;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="left-join-customer-who-visited-but-did-not-make-any-transactions">LEFT JOIN: Customer Who Visited but Did Not Make Any Transactions<a hidden class="anchor" aria-hidden="true" href="#left-join-customer-who-visited-but-did-not-make-any-transactions">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Visits</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>visit_id</td>
<td>int</td>
</tr>
<tr>
<td>customer_id</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>visit_id</code> is the unique identifier for each visit.</li>
<li>This table contains information about the customers who visited the mall.</li>
</ul>
<p><strong>Table: Transactions</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>transaction_id</td>
<td>int</td>
</tr>
<tr>
<td>visit_id</td>
<td>int</td>
</tr>
<tr>
<td>amount</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>transaction_id</code> is the unique identifier for each transaction.</li>
<li>This table contains information about the transactions made during each visit.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Write a SQL query to find the IDs of customers who visited the mall without making any transactions, and count how many times they made these visits.</p>
<p>The result should include:</p>
<ul>
<li><code>customer_id</code> — the ID of the customer.</li>
<li><code>count_no_trans</code> — the number of visits where no transaction was made.</li>
</ul>
<p><strong>Query Requirements:</strong></p>
<ol>
<li>Return the result sorted in any order.</li>
</ol>
<hr>
<p><strong>Input:</strong></p>
<p><code>Visits</code> table:</p>
<table>
<thead>
<tr>
<th>visit_id</th>
<th>customer_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>23</td>
</tr>
<tr>
<td>2</td>
<td>9</td>
</tr>
<tr>
<td>4</td>
<td>30</td>
</tr>
<tr>
<td>5</td>
<td>54</td>
</tr>
<tr>
<td>6</td>
<td>96</td>
</tr>
<tr>
<td>7</td>
<td>54</td>
</tr>
<tr>
<td>8</td>
<td>54</td>
</tr>
</tbody>
</table>
<p><code>Transactions</code> table:</p>
<table>
<thead>
<tr>
<th>transaction_id</th>
<th>visit_id</th>
<th>amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>5</td>
<td>310</td>
</tr>
<tr>
<td>3</td>
<td>5</td>
<td>300</td>
</tr>
<tr>
<td>9</td>
<td>5</td>
<td>200</td>
</tr>
<tr>
<td>12</td>
<td>1</td>
<td>910</td>
</tr>
<tr>
<td>13</td>
<td>2</td>
<td>970</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>customer_id</th>
<th>count_no_trans</th>
</tr>
</thead>
<tbody>
<tr>
<td>54</td>
<td>2</td>
</tr>
<tr>
<td>30</td>
<td>1</td>
</tr>
<tr>
<td>96</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>Customer with <code>id = 23</code> visited once and made a transaction during the visit with <code>id = 12</code>.</li>
<li>Customer with <code>id = 9</code> visited once and made a transaction during the visit with <code>id = 13</code>.</li>
<li>Customer with <code>id = 30</code> visited once and did not make any transactions.</li>
<li>Customer with <code>id = 54</code> visited three times. During two visits, they did not make any transactions, and during one visit, they made three transactions.</li>
<li>Customer with <code>id = 96</code> visited once and did not make any transactions.</li>
</ul>
<p>In the output, customers with <code>id = 30</code>, <code>id = 96</code>, and <code>id = 54</code> (for two of their visits) made visits without transactions.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/customer-who-visited-but-did-not-make-any-transactions?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT v.customer_id, COUNT(v.visit_id) as count_no_trans
FROM Visits v
LEFT JOIN Transactions t
ON v.visit_id = t.visit_id
WHERE t.transaction_id IS NULL
GROUP BY v.customer_id;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>In the above SQL query, MySQL first identifies the <code>Visits</code> table and performs a <code>LEFT JOIN</code> with the <code>Transactions</code> table based on the condition <code>v.visit_id = t.visit_id</code>. The <code>LEFT JOIN</code> operation combines the two tables and fills <code>NULL</code> in rows where there is no match in the <code>Transactions</code> table. The result looks like this:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Visits v
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> Transactions t
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> v.visit_id <span style="color:#f92672">=</span> t.visit_id;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>visit_id</th>
<th>customer_id</th>
<th>transaction_id</th>
<th>visit_id</th>
<th>amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>23</td>
<td>12</td>
<td>1</td>
<td>910</td>
</tr>
<tr>
<td>2</td>
<td>9</td>
<td>13</td>
<td>2</td>
<td>970</td>
</tr>
<tr>
<td>4</td>
<td>30</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>5</td>
<td>54</td>
<td>9</td>
<td>5</td>
<td>200</td>
</tr>
<tr>
<td>5</td>
<td>54</td>
<td>3</td>
<td>5</td>
<td>300</td>
</tr>
<tr>
<td>5</td>
<td>54</td>
<td>2</td>
<td>5</td>
<td>310</td>
</tr>
<tr>
<td>6</td>
<td>96</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>7</td>
<td>54</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>8</td>
<td>54</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>After joining the tables, MySQL applies the <code>WHERE</code> clause to filter rows where <code>t.transaction_id IS NULL</code>, which means visits without any transactions.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Visits v
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> Transactions t
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> v.visit_id <span style="color:#f92672">=</span> t.visit_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> t.transaction_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>visit_id</th>
<th>customer_id</th>
<th>transaction_id</th>
<th>visit_id</th>
<th>amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>30</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>6</td>
<td>96</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>7</td>
<td>54</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>8</td>
<td>54</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Next, MySQL groups the filtered rows by <code>customer_id</code> and calculates the number of visits per customer using the <code>COUNT(v.visit_id)</code> function.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>, <span style="color:#66d9ef">COUNT</span>(v.visit_id)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Visits v
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> Transactions t
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> v.visit_id <span style="color:#f92672">=</span> t.visit_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> t.transaction_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> v.customer_id;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>visit_id</th>
<th>customer_id</th>
<th>transaction_id</th>
<th>visit_id</th>
<th>amount</th>
<th>COUNT(v.visit_id)</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>30</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>96</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1</td>
</tr>
<tr>
<td>7</td>
<td>54</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Finally, MySQL selects the desired columns and renames the <code>COUNT(v.visit_id)</code> column using the <code>AS</code> clause.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> v.customer_id, <span style="color:#66d9ef">COUNT</span>(v.visit_id) <span style="color:#66d9ef">AS</span> count_no_trans
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Visits v
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> Transactions t
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> v.visit_id <span style="color:#f92672">=</span> t.visit_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> t.transaction_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> v.customer_id;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>customer_id</th>
<th>count_no_trans</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>1</td>
</tr>
<tr>
<td>96</td>
<td>1</td>
</tr>
<tr>
<td>54</td>
<td>2</td>
</tr>
</tbody>
</table>

</details></p>

<hr>
<h3 id="self-join-rising-temperature">SELF JOIN: Rising Temperature<a hidden class="anchor" aria-hidden="true" href="#self-join-rising-temperature">#</a></h3>
<blockquote>
<p>In MySQL, a <strong>self join</strong> is an operation where a table joins itself. It is commonly used when comparing rows within the same table based on a specific condition or when working with hierarchical data, such as relating employees to their managers.</p>
</blockquote>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Weather</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>recordDate</td>
<td>date</td>
</tr>
<tr>
<td>temperature</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>id</code> is a column with unique values.</li>
<li>There are no duplicate rows for the same <code>recordDate</code>.</li>
<li>This table contains information about the temperature on specific dates.</li>
</ul>
<p><strong>Problem Statement</strong></p>
<p>Write a solution to find the <code>id</code> of all dates where the temperature is higher compared to the previous day (yesterday).</p>
<p><strong>Return</strong></p>
<ul>
<li>Return the result table in any order.</li>
</ul>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Weather Table:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>recordDate</th>
<th>temperature</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2015-01-01</td>
<td>10</td>
</tr>
<tr>
<td>2</td>
<td>2015-01-02</td>
<td>25</td>
</tr>
<tr>
<td>3</td>
<td>2015-01-03</td>
<td>20</td>
</tr>
<tr>
<td>4</td>
<td>2015-01-04</td>
<td>30</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
</tr>
<tr>
<td>4</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>On <code>2015-01-02</code>, the temperature was higher than the previous day (<code>10 -&gt; 25</code>).</li>
<li>On <code>2015-01-04</code>, the temperature was higher than the previous day (<code>20 -&gt; 30</code>).</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/rising-temperature?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT w1.id
FROM Weather w1
JOIN Weather w2
  ON DATE_ADD(w2.recordDate, INTERVAL 1 DAY) = w1.recordDate
WHERE w1.temperature > w2.temperature;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>In the above query, the <code>DATE_ADD(w2.recordDate, INTERVAL 1 DAY) = w1.recordDate</code> condition ensures that the <code>recordDate</code> of <code>w1</code> matches the day following <code>w2</code>&rsquo;s <code>recordDate</code>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Weather w1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Weather w2
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ON</span> DATE_ADD(w2.recordDate, INTERVAL <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">DAY</span>) <span style="color:#f92672">=</span> w1.recordDate
</span></span></code></pre></div><table>
<thead>
<tr>
<th>id</th>
<th>recordDate</th>
<th>temperature</th>
<th>id</th>
<th>recordDate</th>
<th>temperature</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2015-01-01</td>
<td>10</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>2015-01-02</td>
<td>25</td>
<td>1</td>
<td>2015-01-01</td>
<td>10</td>
</tr>
<tr>
<td>3</td>
<td>2015-01-03</td>
<td>20</td>
<td>2</td>
<td>2015-01-02</td>
<td>25</td>
</tr>
<tr>
<td>4</td>
<td>2015-01-04</td>
<td>30</td>
<td>3</td>
<td>2015-01-03</td>
<td>20</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>4</td>
<td>2015-01-04</td>
<td>30</td>
</tr>
</tbody>
</table>
<p><strong>Result of the Join:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>recordDate</th>
<th>temperature</th>
<th>id</th>
<th>recordDate</th>
<th>temperature</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>2015-01-02</td>
<td>25</td>
<td>1</td>
<td>2015-01-01</td>
<td>10</td>
</tr>
<tr>
<td>3</td>
<td>2015-01-03</td>
<td>20</td>
<td>2</td>
<td>2015-01-02</td>
<td>25</td>
</tr>
<tr>
<td>4</td>
<td>2015-01-04</td>
<td>30</td>
<td>3</td>
<td>2015-01-03</td>
<td>20</td>
</tr>
</tbody>
</table>
<ul>
<li>when <code>id</code> equals to 2, <code>25 &gt; 10</code>, so it is selcted.</li>
<li>when <code>id</code> equals to 3, <code>20 &lt; 25</code>, so it is not selcted.</li>
<li>when <code>id</code> equals to 4, <code>25 &gt; 10</code>, so it is selcted.</li>
</ul>
<blockquote>
<p>Therefore, the result will be:</p>
</blockquote>
<table>
<thead>
<tr>
<th>id</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
</tr>
<tr>
<td>4</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Example: Relating Employees to Their Managers</strong></p>
<p><strong>Employees Table:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>manager_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>NULL</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>Charlie</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>David</td>
<td>2</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> e1.name <span style="color:#66d9ef">AS</span> Employee, e2.name <span style="color:#66d9ef">AS</span> Manager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Employees e1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Employees e2
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ON</span> e1.manager_id <span style="color:#f92672">=</span> e2.id;
</span></span></code></pre></div><p><strong>Result of the Join:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>manager_id</th>
<th>id</th>
<th>name</th>
<th>manager_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>Bob</td>
<td>1</td>
<td>1</td>
<td>Alice</td>
<td>NULL</td>
</tr>
<tr>
<td>3</td>
<td>Charlie</td>
<td>1</td>
<td>1</td>
<td>Alice</td>
<td>NULL</td>
</tr>
<tr>
<td>4</td>
<td>David</td>
<td>2</td>
<td>2</td>
<td>Bob</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>Final Result:</strong></p>
<table>
<thead>
<tr>
<th>Employee</th>
<th>Manager</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bob</td>
<td>Alice</td>
</tr>
<tr>
<td>Charlie</td>
<td>Alice</td>
</tr>
<tr>
<td>David</td>
<td>Bob</td>
</tr>
</tbody>
</table>

</details></p>

<hr>
<h3 id="self-join-managers-with-at-least-5-direct-reports">SELF JOIN: Managers with at Least 5 Direct Reports<a hidden class="anchor" aria-hidden="true" href="#self-join-managers-with-at-least-5-direct-reports">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Problem Description</strong></p>
<p><strong>Table: Employee</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>Unique identifier for each employee.</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
<td>Name of the employee.</td>
</tr>
<tr>
<td>department</td>
<td>varchar</td>
<td>Department to which the employee belongs.</td>
</tr>
<tr>
<td>managerId</td>
<td>int</td>
<td>ID of the employee&rsquo;s manager. If <code>managerId</code> is null, the employee does not have a manager.</td>
</tr>
</tbody>
</table>
<ul>
<li><code>id</code> is the primary key, ensuring each value is unique.</li>
<li>Each row represents an employee, including their name, department, and their manager’s ID.</li>
<li>If <code>managerId</code> is null, the employee does not report to any manager.</li>
<li>An employee cannot be their own manager.</li>
</ul>
<hr>
<p><strong>Task</strong></p>
<p>Write a query to find the <strong>managers</strong> who have at least five direct reports.</p>
<p>Return the result in any order.</p>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Employee Table:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
</tr>
</thead>
<tbody>
<tr>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
<tr>
<td>102</td>
<td>Dan</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>103</td>
<td>James</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>104</td>
<td>Amy</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>105</td>
<td>Anne</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>106</td>
<td>Ron</td>
<td>B</td>
<td>101</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>John</td>
</tr>
</tbody>
</table>
<hr>

</details></p>


<a href="https://leetcode.com/problems/managers-with-at-least-5-direct-reports?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT b.name
FROM Employee a
JOIN Employee b ON a.managerId = b.id
GROUP BY b.id
HAVING COUNT(*) >= 5
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <p><strong>Table: Employee</strong>:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
</tr>
</thead>
<tbody>
<tr>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
<tr>
<td>102</td>
<td>Dan</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>103</td>
<td>James</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>104</td>
<td>Amy</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>105</td>
<td>Anne</td>
<td>A</td>
<td>101</td>
</tr>
<tr>
<td>106</td>
<td>Ron</td>
<td>B</td>
<td>101</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Perform a self join, the table becomes:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Employee a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Employee b 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> a.managerId <span style="color:#f92672">=</span> b.id
</span></span></code></pre></div><p><strong>Table: Slef Joined Result</strong>:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
</tr>
</thead>
<tbody>
<tr>
<td>106</td>
<td>Ron</td>
<td>B</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
<tr>
<td>105</td>
<td>Anne</td>
<td>A</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
<tr>
<td>104</td>
<td>Amy</td>
<td>A</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
<tr>
<td>103</td>
<td>James</td>
<td>A</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
<tr>
<td>102</td>
<td>Dan</td>
<td>A</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Group the self joined result:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Employee a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Employee b 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> a.managerId <span style="color:#f92672">=</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> b.id
</span></span></code></pre></div><p><strong>Table: Grouped Result</strong>:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
</tr>
</thead>
<tbody>
<tr>
<td>106</td>
<td>Ron</td>
<td>B</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Filter grouped result:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Employee a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Employee b 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> a.managerId <span style="color:#f92672">=</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span>
</span></span></code></pre></div><p><strong>Table: Filtered Grouped Result</strong>:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
<th>id</th>
<th>name</th>
<th>department</th>
<th>managerId</th>
</tr>
</thead>
<tbody>
<tr>
<td>106</td>
<td>Ron</td>
<td>B</td>
<td>101</td>
<td>101</td>
<td>John</td>
<td>A</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Select the specified column(s):</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> b.name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Employee a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Employee b 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> a.managerId <span style="color:#f92672">=</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span>
</span></span></code></pre></div><p><strong>Final Result</strong>:</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>John</td>
</tr>
</tbody>
</table>

</details></p>

<hr>
<h3 id="self-join-average-time-of-process-per-machine">SELF JOIN: Average Time of Process per Machine<a hidden class="anchor" aria-hidden="true" href="#self-join-average-time-of-process-per-machine">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Activity</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>machine_id</td>
<td>int</td>
</tr>
<tr>
<td>process_id</td>
<td>int</td>
</tr>
<tr>
<td>activity_type</td>
<td>enum</td>
</tr>
<tr>
<td>timestamp</td>
<td>float</td>
</tr>
</tbody>
</table>
<ul>
<li>The table records user activities for machines on a factory website.</li>
<li>The combination of <code>(machine_id, process_id, activity_type)</code> is the primary key, ensuring uniqueness in the table.</li>
<li><code>machine_id</code> is the ID of the machine.</li>
<li><code>process_id</code> is the ID of the process running on the machine with ID <code>machine_id</code>.</li>
<li><code>activity_type</code> is an <code>ENUM</code> type with values <code>'start'</code> and <code>'end'</code>, representing the start and end of a process.</li>
<li><code>timestamp</code> is a float value representing the time (in seconds) the event occurred.</li>
<li>The <code>'start'</code> timestamp is always earlier than the <code>'end'</code> timestamp for each <code>(machine_id, process_id)</code> pair.</li>
<li>It is guaranteed that each <code>(machine_id, process_id)</code> pair has a corresponding <code>'start'</code> and <code>'end'</code> timestamp.</li>
</ul>
<hr>
<p><strong>Problem:</strong></p>
<p>There are several machines on a factory website, and each machine runs the same number of processes. Your task is to write a SQL query that calculates the <strong>average time</strong> each machine takes to complete a process.</p>
<ul>
<li>The time to complete a process is the difference between the <code>'end'</code> timestamp and the <code>'start'</code> timestamp.</li>
<li>The average time for each machine is calculated by dividing the total time for all processes on that machine by the number of processes.</li>
</ul>
<p>The result should contain the following columns:</p>
<ul>
<li><code>machine_id</code> — the ID of the machine.</li>
<li><code>processing_time</code> — the average processing time, rounded to 3 decimal places.</li>
</ul>
<hr>
<p><strong>Input:</strong></p>
<pre tabindex="0"><code>Activity table:
|------------|------------|---------------|-----------|
| machine_id | process_id | activity_type | timestamp |
|------------|------------|---------------|-----------|
| 0          | 0          | start         | 0.712     |
| 0          | 0          | end           | 1.520     |
| 0          | 1          | start         | 3.140     |
| 0          | 1          | end           | 4.120     |
| 1          | 0          | start         | 0.550     |
| 1          | 0          | end           | 1.550     |
| 1          | 1          | start         | 0.430     |
| 1          | 1          | end           | 1.420     |
| 2          | 0          | start         | 4.100     |
| 2          | 0          | end           | 4.512     |
| 2          | 1          | start         | 2.500     |
| 2          | 1          | end           | 5.000     |
|------------|------------|---------------|-----------|
</code></pre><p><strong>Output:</strong></p>
<pre tabindex="0"><code>|------------|-----------------|
| machine_id | processing_time |
|------------|-----------------|
| 0          | 0.894           |
| 1          | 0.995           |
| 2          | 1.456           |
|------------|-----------------|
</code></pre><hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>
<p><strong>Machine 0</strong>:</p>
<ul>
<li>Process 0: End time 1.520, Start time 0.712 → Time taken = 1.520 - 0.712 = 0.808</li>
<li>Process 1: End time 4.120, Start time 3.140 → Time taken = 4.120 - 3.140 = 0.980</li>
<li>Average time = (0.808 + 0.980) / 2 = <strong>0.894</strong></li>
</ul>
</li>
<li>
<p><strong>Machine 1</strong>:</p>
<ul>
<li>Process 0: End time 1.550, Start time 0.550 → Time taken = 1.550 - 0.550 = 1.000</li>
<li>Process 1: End time 1.420, Start time 0.430 → Time taken = 1.420 - 0.430 = 0.990</li>
<li>Average time = (1.000 + 0.990) / 2 = <strong>0.995</strong></li>
</ul>
</li>
<li>
<p><strong>Machine 2</strong>:</p>
<ul>
<li>Process 0: End time 4.512, Start time 4.100 → Time taken = 4.512 - 4.100 = 0.412</li>
<li>Process 1: End time 5.000, Start time 2.500 → Time taken = 5.000 - 2.500 = 2.500</li>
<li>Average time = (0.412 + 2.500) / 2 = <strong>1.456</strong></li>
</ul>
</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/average-time-of-process-per-machine?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT machine_id,
       ROUND(AVG(end_time - start_time), 3) AS processing_time
FROM (
    SELECT a.machine_id,
           a.process_id,
           a.timestamp AS start_time,
           b.timestamp AS end_time
    FROM Activity a
    JOIN Activity b ON a.machine_id = b.machine_id
                    AND a.process_id = b.process_id
                    AND a.activity_type = 'start'
                    AND b.activity_type = 'end'
) AS process_times
GROUP BY machine_id;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>In the following SQL query, the condition <code>a.activity_type = 'start'</code> and <code>b.activity_type = 'end'</code> ensures that the <code>start</code> and <code>end</code> timestamp are correctly matched for the same process on the same machine.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Activity a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> Activity b <span style="color:#66d9ef">ON</span> a.machine_id <span style="color:#f92672">=</span> b.machine_id
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">AND</span> a.process_id <span style="color:#f92672">=</span> b.process_id
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">AND</span> a.activity_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;start&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">AND</span> b.activity_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;end&#39;</span>  
</span></span></code></pre></div><p><strong>Result of the Join:</strong></p>
<table>
<thead>
<tr>
<th>machine_id</th>
<th>process_id</th>
<th>activity_type</th>
<th>timestamp</th>
<th>machine_id</th>
<th>process_id</th>
<th>activity_type</th>
<th>timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>start</td>
<td>0.712</td>
<td>0</td>
<td>0</td>
<td>end</td>
<td>1.52</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>start</td>
<td>3.14</td>
<td>0</td>
<td>1</td>
<td>end</td>
<td>4.12</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>start</td>
<td>0.55</td>
<td>1</td>
<td>0</td>
<td>end</td>
<td>1.55</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>start</td>
<td>0.43</td>
<td>1</td>
<td>1</td>
<td>end</td>
<td>1.42</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>start</td>
<td>4.1</td>
<td>2</td>
<td>0</td>
<td>end</td>
<td>4.512</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>start</td>
<td>2.5</td>
<td>2</td>
<td>1</td>
<td>end</td>
<td>5</td>
</tr>
</tbody>
</table>
<blockquote>
<p>The result is selected from of the joined result:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> machine_id,
</span></span><span style="display:flex;"><span>       ROUND(<span style="color:#66d9ef">AVG</span>(end_time <span style="color:#f92672">-</span> start_time), <span style="color:#ae81ff">3</span>) <span style="color:#66d9ef">AS</span> processing_time
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> a.machine_id,
</span></span><span style="display:flex;"><span>           a.process_id,
</span></span><span style="display:flex;"><span>           a.<span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">AS</span> start_time,
</span></span><span style="display:flex;"><span>           b.<span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">AS</span> end_time
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> Activity a
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">JOIN</span> Activity b <span style="color:#66d9ef">ON</span> a.machine_id <span style="color:#f92672">=</span> b.machine_id
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">AND</span> a.process_id <span style="color:#f92672">=</span> b.process_id
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">AND</span> a.activity_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;start&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">AND</span> b.activity_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;end&#39;</span>
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">AS</span> process_times
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> machine_id;
</span></span></code></pre></div><p><strong>Final Result:</strong></p>
<table>
<thead>
<tr>
<th>machine_id</th>
<th>processing_time</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.894</td>
</tr>
<tr>
<td>1</td>
<td>0.995</td>
</tr>
<tr>
<td>2</td>
<td>1.456</td>
</tr>
</tbody>
</table>

</details></p>

<hr>
<h3 id="cross-join-students-and-examinations">CROSS JOIN: Students and Examinations<a hidden class="anchor" aria-hidden="true" href="#cross-join-students-and-examinations">#</a></h3>
<blockquote>
<p>In MySQL, a <strong>CROSS JOIN</strong> is a type of join that returns the <strong>Cartesian product</strong> of two tables. It combines each row from the first table with every row from the second table, without the need for a join condition. For example, consider two tables, <code>Students</code> and <code>Subjects</code>:</p>
</blockquote>
<p><strong>Table 1: Students</strong></p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
</tr>
</tbody>
</table>
<p><strong>Table 2: Subjects</strong></p>
<table>
<thead>
<tr>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math</td>
</tr>
<tr>
<td>Physics</td>
</tr>
</tbody>
</table>
<blockquote>
<p>When a <strong>Cross Join</strong> is performed between these two tables, the result will be:</p>
</blockquote>
<p><strong>Table: Result of Cross Join</strong></p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
</tr>
</tbody>
</table>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Students</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>student_id</td>
<td>int</td>
</tr>
<tr>
<td>student_name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>student_id</code> is the primary key (unique values) for this table.</li>
<li>Each row represents a student with their unique ID and name.</li>
</ul>
<p><strong>Table: Subjects</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>subject_name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>subject_name</code> is the primary key (unique values) for this table.</li>
<li>Each row represents the name of a subject offered in the school.</li>
</ul>
<p><strong>Table: Examinations</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>student_id</td>
<td>int</td>
</tr>
<tr>
<td>subject_name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li>There is no primary key for this table, and it may contain duplicates.</li>
<li>Each row indicates that a student with <code>student_id</code> attended the exam for the subject <code>subject_name</code>.</li>
<li>Every student takes every course from the <strong>Subjects</strong> table.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Write a query to find the number of times each student attended each exam, ordered by <code>student_id</code> and <code>subject_name</code>.</p>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Students Table:</strong></p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
</tr>
</tbody>
</table>
<p><strong>Subjects Table:</strong></p>
<table>
<thead>
<tr>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math</td>
</tr>
<tr>
<td>Physics</td>
</tr>
<tr>
<td>Programming</td>
</tr>
</tbody>
</table>
<p><strong>Examinations Table:</strong></p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Programming</td>
</tr>
<tr>
<td>2</td>
<td>Programming</td>
</tr>
<tr>
<td>1</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>13</td>
<td>Math</td>
</tr>
<tr>
<td>13</td>
<td>Programming</td>
</tr>
<tr>
<td>13</td>
<td>Physics</td>
</tr>
<tr>
<td>2</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Math</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
<th>attended_exams</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Math</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Programming</td>
<td>0</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Physics</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Programming</td>
<td>1</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<p>The result table contains all students and all subjects.</p>
<ul>
<li><strong>Alice</strong> attended the <strong>Math</strong> exam 3 times, the <strong>Physics</strong> exam 2 times, and the <strong>Programming</strong> exam 1 time.</li>
<li><strong>Bob</strong> attended the <strong>Math</strong> exam 1 time, the <strong>Programming</strong> exam 1 time, and did not attend the <strong>Physics</strong> exam.</li>
<li><strong>Alex</strong> did not attend any exams.</li>
<li><strong>John</strong> attended the <strong>Math</strong> exam 1 time, the <strong>Physics</strong> exam 1 time, and the <strong>Programming</strong> exam 1 time.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/students-and-examinations?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT 
    s.student_id,
    s.student_name,
    sub.subject_name,
    COUNT(e.student_id) AS attended_exams
FROM 
    Students s
CROSS JOIN 
    Subjects sub
LEFT JOIN 
    Examinations e 
ON s.student_id = e.student_id AND sub.subject_name = e.subject_name
GROUP BY 
    s.student_id, 
    s.student_name, 
    sub.subject_name
ORDER BY 
    s.student_id, 
    sub.subject_name;    
</code></pre>
    </div>
</div>


</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <p><strong>Table: Students</strong></p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
</tr>
</tbody>
</table>
<p><strong>Table: Subjects</strong>:</p>
<table>
<thead>
<tr>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math</td>
</tr>
<tr>
<td>Physics</td>
</tr>
<tr>
<td>Programming</td>
</tr>
</tbody>
</table>
<blockquote>
<p>When a <strong>CROSS JOIN</strong> is performed between the <code>Students</code> and <code>Subjects</code> tables, the result will be:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> 
</span></span><span style="display:flex;"><span>    Students s
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CROSS</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Subjects sub
</span></span></code></pre></div><p><strong>Table: Result of Cross Join</strong>:</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Programming</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Programming</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Programming</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Physics</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Math</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Programming</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Physics</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Math</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Table: Examniations</strong>:</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Programming</td>
</tr>
<tr>
<td>2</td>
<td>Programming</td>
</tr>
<tr>
<td>1</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>13</td>
<td>Math</td>
</tr>
<tr>
<td>13</td>
<td>Programming</td>
</tr>
<tr>
<td>13</td>
<td>Physics</td>
</tr>
<tr>
<td>2</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Math</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Perform a LEFT JOIN on the cross-joined tables with the Examinations table:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> 
</span></span><span style="display:flex;"><span>    Students s
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CROSS</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Subjects sub
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Examinations e 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> s.student_id <span style="color:#f92672">=</span> e.student_id <span style="color:#66d9ef">AND</span> sub.subject_name <span style="color:#f92672">=</span> e.subject_name
</span></span></code></pre></div><p><strong>Table: Left Join Result</strong>:</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
<th>student_id</th>
<th>subject_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Programming</td>
<td>1</td>
<td>Programming</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
<td>1</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
<td>1</td>
<td>Physics</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>1</td>
<td>Math</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Programming</td>
<td>2</td>
<td>Programming</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
<td>2</td>
<td>Math</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Programming</td>
<td>13</td>
<td>Programming</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Physics</td>
<td>13</td>
<td>Physics</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Math</td>
<td>13</td>
<td>Math</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Programming</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Physics</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Math</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>After grouping the left joined result and count the <code>e.studentId</code>, the table will look like:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>, <span style="color:#66d9ef">COUNT</span>(e.student_id) <span style="color:#66d9ef">AS</span> attended_exams
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> 
</span></span><span style="display:flex;"><span>    Students s
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CROSS</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Subjects sub
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Examinations e 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> s.student_id <span style="color:#f92672">=</span> e.student_id <span style="color:#66d9ef">AND</span> sub.subject_name <span style="color:#f92672">=</span> e.subject_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> 
</span></span><span style="display:flex;"><span>    s.student_id, 
</span></span><span style="display:flex;"><span>    s.student_name, 
</span></span><span style="display:flex;"><span>    sub.subject_name
</span></span></code></pre></div><p><strong>Table: Grouped Result with Count</strong>:</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
<th>student_id</th>
<th>subject_name</th>
<th>attended_exams</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Programming</td>
<td>1</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
<td>1</td>
<td>Physics</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>1</td>
<td>Math</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Programming</td>
<td>2</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
<td>null</td>
<td>null</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
<td>2</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Programming</td>
<td>13</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Physics</td>
<td>13</td>
<td>Physics</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Math</td>
<td>13</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Programming</td>
<td>null</td>
<td>null</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Physics</td>
<td>null</td>
<td>null</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Math</td>
<td>null</td>
<td>null</td>
<td>0</td>
</tr>
</tbody>
</table>
<blockquote>
<p>After selecting the specified columns, the result table becomes:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    s.student_id,
</span></span><span style="display:flex;"><span>    s.student_name,
</span></span><span style="display:flex;"><span>    sub.subject_name,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">COUNT</span>(e.student_id) <span style="color:#66d9ef">AS</span> attended_exams
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> 
</span></span><span style="display:flex;"><span>    Students s
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CROSS</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Subjects sub
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    Examinations e 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> s.student_id <span style="color:#f92672">=</span> e.student_id <span style="color:#66d9ef">AND</span> sub.subject_name <span style="color:#f92672">=</span> e.subject_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> 
</span></span><span style="display:flex;"><span>    s.student_id, 
</span></span><span style="display:flex;"><span>    s.student_name, 
</span></span><span style="display:flex;"><span>    sub.subject_name
</span></span></code></pre></div><table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
<th>attended_exams</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Physics</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Programming</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Math</td>
<td>0</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Sort the selcted table based on the condition <code>s.student_id</code> and <code>sub.subject_name</code>, return the final result:</p>
</blockquote>
<p><strong>Table: Final Result</strong>:</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>subject_name</th>
<th>attended_exams</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>Math</td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Physics</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>Alice</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>Programming</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Math</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Alex</td>
<td>Programming</td>
<td>0</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Physics</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>John</td>
<td>Programming</td>
<td>1</td>
</tr>
</tbody>
</table>

</details></p>

<hr>
<h2 id="basic-aggregate-functions">Basic Aggregate Functions<a hidden class="anchor" aria-hidden="true" href="#basic-aggregate-functions">#</a></h2>
<h3 id="average-selling-price">Average Selling Price<a hidden class="anchor" aria-hidden="true" href="#average-selling-price">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Prices</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>start_date</td>
<td>date</td>
</tr>
<tr>
<td>end_date</td>
<td>date</td>
</tr>
<tr>
<td>price</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>The primary key for this table is the combination of <code>(product_id, start_date, end_date)</code>, ensuring unique periods for each product.</li>
<li>Each row represents the price of a product for a specific period, from <code>start_date</code> to <code>end_date</code>.</li>
<li>For each product, no two periods will overlap.</li>
</ul>
<hr>
<p><strong>Table: UnitsSold</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>purchase_date</td>
<td>date</td>
</tr>
<tr>
<td>units</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>This table may contain duplicate rows.</li>
<li>Each row represents the date, number of units, and <code>product_id</code> for a product sold on that date.</li>
</ul>
<hr>
<p><strong>Problem:</strong></p>
<p>Write a SQL query to find the average selling price for each product. The <code>average_price</code> should be rounded to two decimal places. If a product does not have any sold units, its average selling price should be considered 0.</p>
<p>Return the result table in any order.</p>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Prices table:</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>2019-03-22</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
</tr>
</tbody>
</table>
<p><strong>UnitsSold table:</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
</tr>
<tr>
<td>2</td>
<td>2019-03-22</td>
<td>30</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>average_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>16.96</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>
<p>For product 1:</p>
<ul>
<li>From 2019-02-17 to 2019-02-28, 100 units were sold at a price of 5.</li>
<li>From 2019-03-01 to 2019-03-22, 15 units were sold at a price of 20.</li>
<li>Average price is calculated based on the total price and total units sold.</li>
</ul>
</li>
<li>
<p>For product 2:</p>
<ul>
<li>From 2019-02-01 to 2019-02-20, 200 units were sold at a price of 15.</li>
<li>From 2019-02-21 to 2019-03-31, 30 units were sold at a price of 30.</li>
<li>Average price is calculated based on the total price and total units sold.</li>
</ul>
</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/average-selling-price?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT
    p.product_id,
    ROUND(IFNULL(SUM(price * units) / SUM(units), 0), 2) AS average_price
FROM
    Prices AS p
LEFT JOIN UnitsSold AS u
ON p.product_id = u.product_id 
    AND purchase_date BETWEEN start_date AND end_date
GROUP BY 1;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES: Right Answer</summary>
  <p><strong>MySQL Query Walkthrough</strong>:</p>
<p><strong>Table: Prices</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>2019-03-22</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
</tr>
<tr>
<td>3</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
</tr>
</tbody>
</table>
<p><strong>Table: UnitsSold</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
</tr>
<tr>
<td>2</td>
<td>2019-03-22</td>
<td>30</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Join the two tables based on the <code>product_id</code> and the <code>purchase_date</code>, where the <code>purchase_date</code> falls between the <code>start_date</code> and the <code>end_date</code>:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id <span style="color:#66d9ef">AND</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>2019-03-22</td>
<td>20</td>
<td>1</td>
<td>2019-03-01</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>2</td>
<td>2019-03-22</td>
<td>30</td>
</tr>
<tr>
<td>3</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Group the joined result and then use aggregation functions to calculate the average price:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>,
</span></span><span style="display:flex;"><span>    ROUND(IFNULL(<span style="color:#66d9ef">SUM</span>(price <span style="color:#f92672">*</span> units) <span style="color:#f92672">/</span> <span style="color:#66d9ef">SUM</span>(units), <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">AS</span> average_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id <span style="color:#66d9ef">AND</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
<th>average_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
<td>16.96</td>
</tr>
<tr>
<td>3</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>0</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Select the desired columns:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    p.product_id,
</span></span><span style="display:flex;"><span>    ROUND(IFNULL(<span style="color:#66d9ef">SUM</span>(price <span style="color:#f92672">*</span> units) <span style="color:#f92672">/</span> <span style="color:#66d9ef">SUM</span>(units), <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">AS</span> average_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id <span style="color:#66d9ef">AND</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>average_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>16.96</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
</tr>
</tbody>
</table>

</details></p>



<p><details >
  <summary markdown="span">SHOW NOTES: Wrong Answer</summary>
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">#</span> Wrong Answer
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>    p.product_id,
</span></span><span style="display:flex;"><span>    ROUND(IFNULL(<span style="color:#66d9ef">SUM</span>(price <span style="color:#f92672">*</span> units) <span style="color:#f92672">/</span> <span style="color:#66d9ef">SUM</span>(units), <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">AS</span> average_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>    Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u <span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><blockquote>
<p>Join the two tables based on the condition <code>p.product_id = u.product_id</code>:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u <span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
<td>1</td>
<td>2019-03-01</td>
<td>15</td>
</tr>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>2019-03-22</td>
<td>20</td>
<td>1</td>
<td>2019-03-01</td>
<td>15</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>2019-03-22</td>
<td>20</td>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
<td>2</td>
<td>2019-03-22</td>
<td>30</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>2</td>
<td>2019-03-22</td>
<td>30</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
</tr>
<tr>
<td>3</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Filter out the rows that do not fall between <code>start_date</code> and <code>end_date</code>:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u <span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>2019-03-01</td>
<td>2019-03-22</td>
<td>20</td>
<td>1</td>
<td>2019-03-01</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-21</td>
<td>2019-03-31</td>
<td>30</td>
<td>2</td>
<td>2019-03-22</td>
<td>30</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Group the filtered result and then use aggregation functions to calculate average price:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>,
</span></span><span style="display:flex;"><span>    ROUND(IFNULL(<span style="color:#66d9ef">SUM</span>(price <span style="color:#f92672">*</span> units) <span style="color:#f92672">/</span> <span style="color:#66d9ef">SUM</span>(units), <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">AS</span> average_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u <span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>start_date</th>
<th>end_date</th>
<th>price</th>
<th>product_id</th>
<th>purchase_date</th>
<th>units</th>
<th>average_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-02-17</td>
<td>2019-02-28</td>
<td>5</td>
<td>1</td>
<td>2019-02-25</td>
<td>100</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>2019-02-01</td>
<td>2019-02-20</td>
<td>15</td>
<td>2</td>
<td>2019-02-10</td>
<td>200</td>
<td>16.96</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Select the desired columns:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    p.product_id,
</span></span><span style="display:flex;"><span>    ROUND(IFNULL(<span style="color:#66d9ef">SUM</span>(price <span style="color:#f92672">*</span> units) <span style="color:#f92672">/</span> <span style="color:#66d9ef">SUM</span>(units), <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">AS</span> average_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Prices <span style="color:#66d9ef">AS</span> p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> UnitsSold <span style="color:#66d9ef">AS</span> u <span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> u.product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> purchase_date <span style="color:#66d9ef">BETWEEN</span> start_date <span style="color:#66d9ef">AND</span> end_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>product_id</th>
<th>average_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>16.96</td>
</tr>
</tbody>
</table>
<blockquote>
<p>The correct answer is:</p>
</blockquote>
<table>
<thead>
<tr>
<th>product_id</th>
<th>average_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>16.96</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Summary</strong>: The <code>LEFT JOIN</code> operation will return <code>NULL</code> results for rows without without matching records in the <code>UnitsSold</code> table. In the condition <code>p.product_id = u.product_id AND purchase_date BETWEEN start_date AND end_date</code>, the date range check is applied <strong>during the join operation</strong>, while <code>WHERE purchase_date BETWEEN start_date AND end_date</code> is applied <strong>after the join operation</strong>. The <code>WHERE</code> clause exlcudes rows with <code>NULL</code> values, which means products with no matching sales records (i.e., where <code>purchase_date</code> doesn&rsquo;t match) will be excluded from the result. When grouping the result, no rows containing <code>NULL</code> values remain, leading to an incorrect result (missing <code>product_id = 3</code> with <code>average_price = 0</code>).</p>
</blockquote>

</details></p>

<hr>
<h3 id="percentage-of-users-attended-a-contest">Percentage of Users Attended a Contest<a hidden class="anchor" aria-hidden="true" href="#percentage-of-users-attended-a-contest">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Users</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
<tr>
<td>user_name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>user_id</code> is the primary key (a unique identifier) for this table.</li>
<li>Each row in this table represents a user, with their unique ID and name.</li>
</ul>
<p><strong>Table: Register</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>contest_id</td>
<td>int</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>(contest_id, user_id)</code> is the primary key (a unique combination of columns) for this table.</li>
<li>Each row in this table represents the registration of a user in a specific contest.</li>
</ul>
<hr>
<p><strong>Task</strong></p>
<p>Write a solution to calculate the percentage of users registered for each contest, rounded to two decimal places.</p>
<p>Return the result table sorted by <code>percentage</code> in descending order. If there is a tie in percentage, order by <code>contest_id</code> in ascending order.</p>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Users table:</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>user_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>Alice</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
</tr>
<tr>
<td>7</td>
<td>Alex</td>
</tr>
</tbody>
</table>
<p><strong>Register table:</strong></p>
<table>
<thead>
<tr>
<th>contest_id</th>
<th>user_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>215</td>
<td>6</td>
</tr>
<tr>
<td>209</td>
<td>2</td>
</tr>
<tr>
<td>208</td>
<td>2</td>
</tr>
<tr>
<td>210</td>
<td>6</td>
</tr>
<tr>
<td>208</td>
<td>6</td>
</tr>
<tr>
<td>209</td>
<td>7</td>
</tr>
<tr>
<td>209</td>
<td>6</td>
</tr>
<tr>
<td>215</td>
<td>7</td>
</tr>
<tr>
<td>208</td>
<td>7</td>
</tr>
<tr>
<td>210</td>
<td>2</td>
</tr>
<tr>
<td>207</td>
<td>2</td>
</tr>
<tr>
<td>210</td>
<td>7</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>contest_id</th>
<th>percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td>208</td>
<td>100.0</td>
</tr>
<tr>
<td>209</td>
<td>100.0</td>
</tr>
<tr>
<td>210</td>
<td>100.0</td>
</tr>
<tr>
<td>215</td>
<td>66.67</td>
</tr>
<tr>
<td>207</td>
<td>33.33</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>Contests <strong>208</strong>, <strong>209</strong>, and <strong>210</strong> had 100% user registration. The results are sorted by <code>contest_id</code> in ascending order.</li>
<li>Contest <strong>215</strong> had a registration rate of <strong>66.67%</strong>, as Alice and Alex registered, out of a total of three users.</li>
<li>Contest <strong>207</strong> had a registration rate of <strong>33.33%</strong>, as only Bob registered, out of a total of three users.</li>
</ul>
<hr>

</details></p>


<a href="" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT 
    contest_id,
    ROUND(COUNT(user_id) * 100 / (SELECT COUNT(user_id) FROM Users),2) percentage
FROM Register a 
GROUP BY contest_id
ORDER BY percentage DESC,contest_id ASC;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <p>$$
\text{percentage} = \frac{\text{number of users attended in the contest}}{\text{total number of users}} \times 100 \%
$$</p>
<ul>
<li>Compute the total number of users: <code>SELECT COUNT(user_id) FROM Users</code></li>
<li>Compute the number of users attended in the contest: Group the table based on the column <code>contest_id</code>, then count the number of users in each group.</li>
</ul>
</details></p>

<hr>
<h3 id="queries-quality-and-percentage">Queries Quality and Percentage<a hidden class="anchor" aria-hidden="true" href="#queries-quality-and-percentage">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Queries</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query_name</td>
<td>varchar</td>
</tr>
<tr>
<td>result</td>
<td>varchar</td>
</tr>
<tr>
<td>position</td>
<td>int</td>
</tr>
<tr>
<td>rating</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>This table may contain duplicate rows.</li>
<li>It contains information collected from various queries executed on a database.</li>
<li>The <code>position</code> column has a value ranging from 1 to 500.</li>
<li>The <code>rating</code> column has a value between 1 and 5. Queries with a rating less than 3 are considered poor queries.</li>
</ul>
<p><strong>Definitions:</strong></p>
<ul>
<li><strong>Query quality</strong>: The average of the ratio between the query&rsquo;s rating and its position.</li>
<li><strong>Poor query percentage</strong>: The percentage of queries with a rating less than 3.</li>
</ul>
<p><strong>Objective:</strong>
Write a solution to find:</p>
<ul>
<li>The <strong>query_name</strong>,</li>
<li>The <strong>quality</strong> of each query (rounded to 2 decimal places),</li>
<li>The <strong>poor_query_percentage</strong> for each query (rounded to 2 decimal places).</li>
</ul>
<hr>
<p><strong>Input:</strong>
Queries table:</p>
<table>
<thead>
<tr>
<th>query_name</th>
<th>result</th>
<th>position</th>
<th>rating</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dog</td>
<td>Golden Retriever</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>Dog</td>
<td>German Shepherd</td>
<td>2</td>
<td>5</td>
</tr>
<tr>
<td>Dog</td>
<td>Mule</td>
<td>200</td>
<td>1</td>
</tr>
<tr>
<td>Cat</td>
<td>Shirazi</td>
<td>5</td>
<td>2</td>
</tr>
<tr>
<td>Cat</td>
<td>Siamese</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>Cat</td>
<td>Sphynx</td>
<td>7</td>
<td>4</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>query_name</th>
<th>quality</th>
<th>poor_query_percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dog</td>
<td>2.50</td>
<td>33.33</td>
</tr>
<tr>
<td>Cat</td>
<td>0.66</td>
<td>33.33</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>
<p><strong>Dog queries</strong>:</p>
<ul>
<li>Quality:<br>
$$
\left( \frac{5}{1} + \frac{5}{2} + \frac{1}{200} \right) / 3 = 2.50
$$</li>
<li>Poor query percentage:<br>
$$
\frac{1}{3} \times 100 = 33.33
$$</li>
</ul>
</li>
<li>
<p><strong>Cat queries</strong>:</p>
<ul>
<li>Quality:<br>
$$
\left( \frac{2}{5} + \frac{3}{3} + \frac{4}{7} \right) / 3 = 0.66
$$</li>
<li>Poor query percentage:<br>
$$
\frac{1}{3} \times 100 = 33.33
$$</li>
</ul>
</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/queries-quality-and-percentage?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT query_name,
       ROUND(AVG(rating / position), 2) AS quality,
       ROUND(SUM(CASE WHEN rating < 3 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2) AS poor_query_percentage
FROM Queries
GROUP BY query_name;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="monthly-transactions-i">Monthly Transactions I<a hidden class="anchor" aria-hidden="true" href="#monthly-transactions-i">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Transactions</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>country</td>
<td>varchar</td>
</tr>
<tr>
<td>state</td>
<td>enum</td>
</tr>
<tr>
<td>amount</td>
<td>int</td>
</tr>
<tr>
<td>trans_date</td>
<td>date</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>id</strong> is the primary key of this table.</li>
<li>The table stores information about incoming transactions.</li>
<li>The <strong>state</strong> column is an enum with values [&ldquo;approved&rdquo;, &ldquo;declined&rdquo;].</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>For each month and country, find the following information:</p>
<ul>
<li>The total number of transactions (<code>trans_count</code>).</li>
<li>The total amount of all transactions (<code>trans_total_amount</code>).</li>
<li>The number of approved transactions (<code>approved_count</code>).</li>
<li>The total amount of approved transactions (<code>approved_total_amount</code>).</li>
</ul>
<p>The results should be returned in any order.</p>
<hr>
<p><strong>Example Input:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>country</th>
<th>state</th>
<th>amount</th>
<th>trans_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>121</td>
<td>US</td>
<td>approved</td>
<td>1000</td>
<td>2018-12-18</td>
</tr>
<tr>
<td>122</td>
<td>US</td>
<td>declined</td>
<td>2000</td>
<td>2018-12-19</td>
</tr>
<tr>
<td>123</td>
<td>US</td>
<td>approved</td>
<td>2000</td>
<td>2019-01-01</td>
</tr>
<tr>
<td>124</td>
<td>DE</td>
<td>approved</td>
<td>2000</td>
<td>2019-01-07</td>
</tr>
</tbody>
</table>
<p><strong>Example Output:</strong></p>
<table>
<thead>
<tr>
<th>month</th>
<th>country</th>
<th>trans_count</th>
<th>approved_count</th>
<th>trans_total_amount</th>
<th>approved_total_amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>2018-12</td>
<td>US</td>
<td>2</td>
<td>1</td>
<td>3000</td>
<td>1000</td>
</tr>
<tr>
<td>2019-01</td>
<td>US</td>
<td>1</td>
<td>1</td>
<td>2000</td>
<td>2000</td>
</tr>
<tr>
<td>2019-01</td>
<td>DE</td>
<td>1</td>
<td>1</td>
<td>2000</td>
<td>2000</td>
</tr>
</tbody>
</table>
<hr>

</details></p>


<a href="https://leetcode.com/problems/monthly-transactions-i?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT
    DATE_FORMAT(trans_date, '%Y-%m') AS month,
    country,
    COUNT(*) AS trans_count,
    SUM(CASE WHEN state = 'approved' THEN 1 ELSE 0 END) AS approved_count,
    SUM(amount) AS trans_total_amount,
    SUM(CASE WHEN state = 'approved' THEN amount ELSE 0 END) AS approved_total_amount
FROM Transactions
GROUP BY month, country;

SELECT
    DATE_FORMAT(trans_date, '%Y-%m') AS month,
    country,
    COUNT(*) AS trans_count,
    COUNT(IF(state = 'approved', 1, NULL)) AS approved_count,
    SUM(amount) AS trans_total_amount,
    SUM(IF(state = 'approved', amount, 0)) AS approved_total_amount
FROM Transactions
GROUP BY month, country;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <ul>
<li>The <code>DATE_FORMAT</code> function in SQL is used to format a date into a specific string format. For example, <code>DATE_FORMAT('2024-12-19', '%Y-%m')</code> will output <code>'2024-12'</code>, extracting the year and month from the date.</li>
<li>The <code>IF</code> function in SQL returns one value if the condition is true and another value if the condition is false. For example, <code>IF(amount &gt; 1000, 1, 0)</code> will return <code>1</code> if the <code>amount</code> is greater than <code>1000</code>, otherwise, it will return <code>0</code>.</li>
<li>The <code>CASE...WHEN...THEN...ELSE...END</code> statement is similar to the <code>switch</code> statement in other programming languages like Java. It works like the <code>IF</code> function, but with the ability to handle multiple conditions. It checks each condition in sequence and returns the corresponding result for the first true condition.</li>
</ul>

</details></p>

<hr>
<h3 id="immediate-food-delivery-ii">Immediate Food Delivery II<a hidden class="anchor" aria-hidden="true" href="#immediate-food-delivery-ii">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Delivery</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>delivery_id</td>
<td>int</td>
</tr>
<tr>
<td>customer_id</td>
<td>int</td>
</tr>
<tr>
<td>order_date</td>
<td>date</td>
</tr>
<tr>
<td>customer_pref_delivery_date</td>
<td>date</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>delivery_id</strong> is the unique identifier for each delivery.</li>
<li>The table contains information about food deliveries, where customers place orders on a specific date and specify a preferred delivery date (either on the same day or later).</li>
<li>If the <strong>customer_pref_delivery_date</strong> is the same as the <strong>order_date</strong>, the order is considered <strong>immediate</strong>; otherwise, it is <strong>scheduled</strong>.</li>
<li>The <strong>first order</strong> of a customer is defined as the one with the earliest <strong>order_date</strong>. Each customer has exactly one first order.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Find the percentage of <strong>immediate orders</strong> among the <strong>first orders</strong> of all customers, rounded to two decimal places.</p>
<p>The result should follow the format shown below:</p>
<hr>
<p><strong>Example Input:</strong></p>
<table>
<thead>
<tr>
<th>delivery_id</th>
<th>customer_id</th>
<th>order_date</th>
<th>customer_pref_delivery_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>2019-08-01</td>
<td>2019-08-02</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2019-08-02</td>
<td>2019-08-02</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>2019-08-11</td>
<td>2019-08-12</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>2019-08-24</td>
<td>2019-08-24</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>2019-08-21</td>
<td>2019-08-22</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>2019-08-11</td>
<td>2019-08-13</td>
</tr>
<tr>
<td>7</td>
<td>4</td>
<td>2019-08-09</td>
<td>2019-08-09</td>
</tr>
</tbody>
</table>
<p><strong>Example Output:</strong></p>
<table>
<thead>
<tr>
<th>immediate_percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td>50.00</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>Customer <strong>1</strong> has their first order with <strong>delivery_id 1</strong>, which is <strong>scheduled</strong>.</li>
<li>Customer <strong>2</strong> has their first order with <strong>delivery_id 2</strong>, which is <strong>immediate</strong>.</li>
<li>Customer <strong>3</strong> has their first order with <strong>delivery_id 5</strong>, which is <strong>scheduled</strong>.</li>
<li>Customer <strong>4</strong> has their first order with <strong>delivery_id 7</strong>, which is <strong>immediate</strong>.</li>
</ul>
<p>Hence, <strong>50%</strong> of the first orders are immediate.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/immediate-food-delivery-ii?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT 
    ROUND((SUM(IF(order_date = customer_pref_delivery_date, 1, 0)) / COUNT(*)) * 100, 2) AS immediate_percentage
FROM 
    (SELECT 
        customer_id, 
        MIN(order_date) AS first_order_date
    FROM Delivery
    GROUP BY customer_id) AS first_orders
INNER JOIN Delivery AS d 
    ON first_orders.customer_id = d.customer_id 
    AND first_orders.first_order_date = d.order_date;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="game-play-analysis-iv">Game Play Analysis IV<a hidden class="anchor" aria-hidden="true" href="#game-play-analysis-iv">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Activity</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>player_id</td>
<td>int</td>
</tr>
<tr>
<td>device_id</td>
<td>int</td>
</tr>
<tr>
<td>event_date</td>
<td>date</td>
</tr>
<tr>
<td>games_played</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>The combination of <strong>(player_id, event_date)</strong> is the primary key of this table, ensuring each player can only log in once per day.</li>
<li>This table tracks the activity of players in games, where each record represents a player&rsquo;s login and the number of games played (which could be zero) before logging out on a specific day using a particular device.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Calculate the fraction of players who logged in again on the day after their first login date. The result should be rounded to two decimal places.</p>
<p>In other words, identify the players who logged in on consecutive days starting from their first login date, then divide that count by the total number of players.</p>
<hr>
<p><strong>Example Input:</strong></p>
<table>
<thead>
<tr>
<th>player_id</th>
<th>device_id</th>
<th>event_date</th>
<th>games_played</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2</td>
<td>2016-03-01</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2016-03-02</td>
<td>6</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2017-06-25</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>2016-03-02</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2018-07-03</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>Example Output:</strong></p>
<table>
<thead>
<tr>
<th>fraction</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.33</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>Player <strong>1</strong> logged in on <strong>2016-03-01</strong> and <strong>2016-03-02</strong>, meaning they logged in for at least two consecutive days, starting from their first login.</li>
<li>Player <strong>2</strong> did not log in again on the day after their first login.</li>
<li>Player <strong>3</strong> did not log in on consecutive days, as there was a gap between their logins.</li>
</ul>
<p>Thus, only player <strong>1</strong> satisfies the condition, and the fraction is calculated as <code>1/3 = 0.33</code>.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/game-play-analysis-iv?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT 
    ROUND(
        SUM(IF(DATEDIFF(event_date, min_event_date) = 1, 1, 0)) / COUNT(DISTINCT player_id), 2) AS fraction
FROM (
    SELECT 
        player_id,
        event_date,
        MIN(event_date) OVER (PARTITION BY player_id) AS min_event_date
    FROM activity
) AS activity_with_min_date;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <ul>
<li>The <code>DATEDIFF</code> function in MySQL calculates the difference in days between two dates. For example, <code>DATEDIFF('2024-12-30', '2024-12-25')</code> will output <code>5</code>, indicating there are 5 days between the two dates.</li>
<li>The <code>PARTITION BY</code> clause is used in window functions to divide the result ser into partitions (groups) based on a specified column. It applies window functions, such as <code>RANK()</code>, <code>SUM()</code>, <code>ROW_NUMBER()</code>, and others, to each partition. This works similarly to <code>GROUP BY</code>, but unlike <code>GROUP BY</code>, the <code>PARTITION BY</code> clause allows <strong>retaining the row-level data</strong> while applying the window functions.</li>
</ul>
<p><strong>Input Table: <code>employees</code></strong></p>
<table>
<thead>
<tr>
<th>department_id</th>
<th>employee_id</th>
<th>salary</th>
</tr>
</thead>
<tbody>
<tr>
<td>101</td>
<td>1</td>
<td>5000</td>
</tr>
<tr>
<td>101</td>
<td>2</td>
<td>4000</td>
</tr>
<tr>
<td>101</td>
<td>3</td>
<td>6000</td>
</tr>
<tr>
<td>102</td>
<td>4</td>
<td>4500</td>
</tr>
<tr>
<td>102</td>
<td>5</td>
<td>5500</td>
</tr>
<tr>
<td>102</td>
<td>6</td>
<td>4800</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    department_id, 
</span></span><span style="display:flex;"><span>    employee_id, 
</span></span><span style="display:flex;"><span>    salary, 
</span></span><span style="display:flex;"><span>    RANK() OVER (PARTITION <span style="color:#66d9ef">BY</span> department_id <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> salary <span style="color:#66d9ef">DESC</span>) <span style="color:#66d9ef">AS</span> salary_rank
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> employees;
</span></span></code></pre></div><p><strong>Output (Result of Query):</strong></p>
<table>
<thead>
<tr>
<th>department_id</th>
<th>employee_id</th>
<th>salary</th>
<th>salary_rank</th>
</tr>
</thead>
<tbody>
<tr>
<td>101</td>
<td>3</td>
<td>6000</td>
<td>1</td>
</tr>
<tr>
<td>101</td>
<td>1</td>
<td>5000</td>
<td>2</td>
</tr>
<tr>
<td>101</td>
<td>2</td>
<td>4000</td>
<td>3</td>
</tr>
<tr>
<td>102</td>
<td>5</td>
<td>5500</td>
<td>1</td>
</tr>
<tr>
<td>102</td>
<td>6</td>
<td>4800</td>
<td>2</td>
</tr>
<tr>
<td>102</td>
<td>4</td>
<td>4500</td>
<td>3</td>
</tr>
</tbody>
</table>

</details></p>

<hr>
<h2 id="sorting-and-grouping">Sorting and Grouping<a hidden class="anchor" aria-hidden="true" href="#sorting-and-grouping">#</a></h2>
<h3 id="user-activity-for-the-past-30-days-i">User Activity for the Past 30 Days I<a hidden class="anchor" aria-hidden="true" href="#user-activity-for-the-past-30-days-i">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Activity</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
<tr>
<td>session_id</td>
<td>int</td>
</tr>
<tr>
<td>activity_date</td>
<td>date</td>
</tr>
<tr>
<td>activity_type</td>
<td>enum</td>
</tr>
</tbody>
</table>
<ul>
<li>The <code>activity_type</code> column is an ENUM with values: &lsquo;open_session&rsquo;, &rsquo;end_session&rsquo;, &lsquo;scroll_down&rsquo;, &lsquo;send_message&rsquo;.</li>
<li>This table logs user activities for a social media website, where each session is linked to exactly one user.</li>
<li>The table may contain duplicate rows.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>You need to find the count of unique active users per day for the 30-day period ending on 2019-07-27, inclusive. A user is considered active on a particular day if they perform at least one activity on that day.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input: Activity table</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>session_id</th>
<th>activity_date</th>
<th>activity_type</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>2019-07-20</td>
<td>open_session</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>2019-07-20</td>
<td>scroll_down</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>2019-07-20</td>
<td>end_session</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
<td>2019-07-20</td>
<td>open_session</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
<td>2019-07-21</td>
<td>send_message</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
<td>2019-07-21</td>
<td>end_session</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>2019-07-21</td>
<td>open_session</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>2019-07-21</td>
<td>send_message</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>2019-07-21</td>
<td>end_session</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>2019-06-25</td>
<td>open_session</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>2019-06-25</td>
<td>end_session</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>day</th>
<th>active_users</th>
</tr>
</thead>
<tbody>
<tr>
<td>2019-07-20</td>
<td>2</td>
</tr>
<tr>
<td>2019-07-21</td>
<td>2</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>Only the days with active users (those who performed at least one activity) are included in the output.</li>
<li>For 2019-07-20, users 1 and 2 were active, and for 2019-07-21, users 2 and 3 were active.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/user-activity-for-the-past-30-days-i?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT activity_date AS day,
       COUNT(DISTINCT user_id) AS active_users
FROM Activity
WHERE activity_date <= '2019-07-27' AND DATEDIFF('2019-07-27', activity_date) < 30
GROUP BY activity_date

SELECT activity_date AS day,
       COUNT(DISTINCT user_id) AS active_users
FROM Activity
WHERE activity_date <= '2019-07-27' AND activity_date> DATE_SUB('2019-07-27',INTERVAL 30 day)
GROUP BY activity_date
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>In MySQL, both <code>DATEDIFF</code> and <code>DATE_SUB</code> are used for date calculations. <code>DATEDIFF</code> calculates the difference between two dates, returning the result in days. On the other hand, <code>DATE_SUB</code> is used to subtract a specified time interval (such as days, months, or years) from a given date.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> DATEDIFF(<span style="color:#e6db74">&#39;2023-12-31&#39;</span>, <span style="color:#e6db74">&#39;2023-01-01&#39;</span>); 
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Result: 364
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> DATE_SUB(<span style="color:#e6db74">&#39;2023-12-31&#39;</span>, INTERVAL <span style="color:#ae81ff">30</span> <span style="color:#66d9ef">DAY</span>); 
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Result: &#39;2023-12-01&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> DATE_SUB(<span style="color:#e6db74">&#39;2023-12-31&#39;</span>, INTERVAL <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">MONTH</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Result: &#39;2023-10-31&#39;
</span></span></span></code></pre></div>
</details></p>

<hr>
<h3 id="product-sales-analysis-iii">Product Sales Analysis III<a hidden class="anchor" aria-hidden="true" href="#product-sales-analysis-iii">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Sales</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>sale_id</td>
<td>int</td>
</tr>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>year</td>
<td>int</td>
</tr>
<tr>
<td>quantity</td>
<td>int</td>
</tr>
<tr>
<td>price</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>The combination of <code>sale_id</code> and <code>year</code> is the primary key of this table, ensuring each record is unique for a given sale.</li>
<li><code>product_id</code> is a foreign key referencing the <code>Product</code> table.</li>
<li>Each row in this table represents a sale of a specific product (<code>product_id</code>) in a given year.</li>
<li>The <code>price</code> refers to the price per unit of the product.</li>
</ul>
<hr>
<p><strong>Table: Product</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>product_name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>product_id</code> is the primary key of this table, ensuring unique product identifiers.</li>
<li>Each row represents the name of a product associated with the corresponding <code>product_id</code>.</li>
</ul>
<hr>
<p><strong>Task:</strong>
Write a query to select the <code>product_id</code>, <code>year</code>, <code>quantity</code>, and <code>price</code> for the <strong>first year</strong> in which each product was sold.</p>
<p>Return the result in any order.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input: Sales table</strong></p>
<table>
<thead>
<tr>
<th>sale_id</th>
<th>product_id</th>
<th>year</th>
<th>quantity</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>100</td>
<td>2008</td>
<td>10</td>
<td>5000</td>
</tr>
<tr>
<td>2</td>
<td>100</td>
<td>2009</td>
<td>12</td>
<td>5000</td>
</tr>
<tr>
<td>7</td>
<td>200</td>
<td>2011</td>
<td>15</td>
<td>9000</td>
</tr>
</tbody>
</table>
<p>Product table:</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>product_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>Nokia</td>
</tr>
<tr>
<td>200</td>
<td>Apple</td>
</tr>
<tr>
<td>300</td>
<td>Samsung</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>first_year</th>
<th>quantity</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>2008</td>
<td>10</td>
<td>5000</td>
</tr>
<tr>
<td>200</td>
<td>2011</td>
<td>15</td>
<td>9000</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>For <code>product_id = 100</code>, the first sale occurred in 2008 with a quantity of 10 and a price of 5000.</li>
<li>For <code>product_id = 200</code>, the first sale occurred in 2011 with a quantity of 15 and a price of 9000.</li>
</ul>
<p>The query should return the first sale year for each product, along with the corresponding quantity and price.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/product-sales-analysis-iii?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT
    product_id,
    year AS first_year,
    quantity,
    price
FROM Sales
WHERE
    (product_id, year) IN (
        SELECT
            product_id,
            MIN(year) AS year
        FROM Sales
        GROUP BY product_id
    );

SELECT product_id, first_year, quantity, price
FROM (
    SELECT 
        product_id,
        year AS first_year,
        quantity,
        price,
        RANK() OVER (PARTITION BY product_id ORDER BY year) AS row_num
    FROM Sales
) subquery
WHERE row_num = 1;

SELECT s.product_id,
       s.year AS first_year,
       s.quantity,
       s.price
FROM Sales s
JOIN (
    SELECT product_id, MIN(year) AS first_year
    FROM Sales
    GROUP BY product_id
) first_sale ON s.product_id = first_sale.product_id
             AND s.year = first_sale.first_year;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  
</details></p>

<hr>
<h3 id="biggest-single-number">Biggest Single Number<a hidden class="anchor" aria-hidden="true" href="#biggest-single-number">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: MyNumbers</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>num</td>
<td>int</td>
</tr>
</tbody>
</table>
<p>This table may contain duplicates (i.e., there is no primary key in the SQL table). Each row contains an integer.</p>
<p><strong>Problem Description</strong></p>
<p>A <strong>single number</strong> is a number that appears only once in the <code>MyNumbers</code> table.</p>
<p>The task is to find the largest single number. If there is no single number, return <code>null</code>.</p>
<hr>
<p><strong>Example 1:</strong></p>
<p><strong>Input:</strong> <code>MyNumbers</code> table:</p>
<table>
<thead>
<tr>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
</tr>
<tr>
<td>8</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>1</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>5</td>
</tr>
<tr>
<td>6</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong><br>
The single numbers are <strong>1</strong>, <strong>4</strong>, <strong>5</strong>, and <strong>6</strong>. Since <strong>6</strong> is the largest single number, we return it.</p>
<p><strong>Example 2:</strong></p>
<p><strong>Input:</strong> <code>MyNumbers</code> table:</p>
<table>
<thead>
<tr>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
</tr>
<tr>
<td>8</td>
</tr>
<tr>
<td>7</td>
</tr>
<tr>
<td>7</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong><br>
There are no single numbers in the input table, so we return <code>null</code>.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/biggest-single-number?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT MAX(num) AS num
FROM
    (
        SELECT num
        FROM MyNumbers
        GROUP BY 1
        HAVING COUNT(1) = 1
    ) AS t;

SELECT
    IF(COUNT(num) = 1, num, null) AS num
FROM MyNumbers
GROUP BY num
ORDER BY 1 DESC
LIMIT 1;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h2 id="advanced-select--joins">Advanced Select &amp; Joins<a hidden class="anchor" aria-hidden="true" href="#advanced-select--joins">#</a></h2>
<h3 id="the-number-of-employees-which-report-to-each-employee">The Number of Employees Which Report to Each Employee<a hidden class="anchor" aria-hidden="true" href="#the-number-of-employees-which-report-to-each-employee">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Employees</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>employee_id</td>
<td>int</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
</tr>
<tr>
<td>reports_to</td>
<td>int</td>
</tr>
<tr>
<td>age</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><code>employee_id</code> is the unique identifier for each employee in the table.</li>
<li>This table stores information about employees and the ID of the manager they report to. Some employees may not report to anyone (<code>reports_to</code> is null).</li>
<li>A manager is defined as an employee who has at least one other employee reporting to them.</li>
</ul>
<p><strong>Problem Description</strong></p>
<p>You are required to write a solution that reports the following information for each manager:</p>
<ul>
<li>The manager&rsquo;s <code>employee_id</code> and <code>name</code>.</li>
<li>The number of employees directly reporting to the manager.</li>
<li>The average age of these employees, rounded to the nearest integer.</li>
</ul>
<p>The results should be ordered by <code>employee_id</code>.</p>
<hr>
<p><strong>Example 1:</strong></p>
<p><strong>Input:</strong></p>
<p>Employees table:</p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>name</th>
<th>reports_to</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>9</td>
<td>Hercy</td>
<td>null</td>
<td>43</td>
</tr>
<tr>
<td>6</td>
<td>Alice</td>
<td>9</td>
<td>41</td>
</tr>
<tr>
<td>4</td>
<td>Bob</td>
<td>9</td>
<td>36</td>
</tr>
<tr>
<td>2</td>
<td>Winston</td>
<td>null</td>
<td>37</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>name</th>
<th>reports_count</th>
<th>average_age</th>
</tr>
</thead>
<tbody>
<tr>
<td>9</td>
<td>Hercy</td>
<td>2</td>
<td>39</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>Hercy manages 2 employees (Alice and Bob).</li>
<li>The average age of Alice and Bob is (41 + 36) / 2 = 38.5, which rounds to 39.</li>
</ul>
<p><strong>Example 2:</strong></p>
<p><strong>Input:</strong></p>
<p>Employees table:</p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>name</th>
<th>reports_to</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Michael</td>
<td>null</td>
<td>45</td>
</tr>
<tr>
<td>2</td>
<td>Alice</td>
<td>1</td>
<td>38</td>
</tr>
<tr>
<td>3</td>
<td>Bob</td>
<td>1</td>
<td>42</td>
</tr>
<tr>
<td>4</td>
<td>Charlie</td>
<td>2</td>
<td>34</td>
</tr>
<tr>
<td>5</td>
<td>David</td>
<td>2</td>
<td>40</td>
</tr>
<tr>
<td>6</td>
<td>Eve</td>
<td>3</td>
<td>37</td>
</tr>
<tr>
<td>7</td>
<td>Frank</td>
<td>null</td>
<td>50</td>
</tr>
<tr>
<td>8</td>
<td>Grace</td>
<td>null</td>
<td>48</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>name</th>
<th>reports_count</th>
<th>average_age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Michael</td>
<td>2</td>
<td>40</td>
</tr>
<tr>
<td>2</td>
<td>Alice</td>
<td>2</td>
<td>37</td>
</tr>
<tr>
<td>3</td>
<td>Bob</td>
<td>1</td>
<td>37</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Explanation:</strong></p>
<ul>
<li>Michael manages Alice and Bob. The average age of Alice and Bob is (38 + 42) / 2 = 40.</li>
<li>Alice manages Charlie and David, with an average age of (34 + 40) / 2 = 37.</li>
<li>Bob manages Eve, with an average age of 37.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/the-number-of-employees-which-report-to-each-employee?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT 
    e1.employee_id,
    e1.name, 
    COUNT(e1.employee_id) AS reports_count,
    ROUND(AVG(e2.age)) AS average_age
FROM Employees e1
INNER JOIN Employees e2
ON e1.employee_id = e2.reports_to
GROUP BY e1.employee_id
ORDER BY e1.employee_id;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="primary-department-for-each-employee">Primary Department for Each Employee<a hidden class="anchor" aria-hidden="true" href="#primary-department-for-each-employee">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Employee</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>employee_id</td>
<td>int</td>
</tr>
<tr>
<td>department_id</td>
<td>int</td>
</tr>
<tr>
<td>primary_flag</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li>The combination of <code>(employee_id, department_id)</code> is the primary key for this table, meaning each employee can belong to multiple departments, but each <code>(employee_id, department_id)</code> pair is unique.</li>
<li><code>employee_id</code>: The ID of the employee.</li>
<li><code>department_id</code>: The ID of the department to which the employee belongs.</li>
<li><code>primary_flag</code>: A flag indicating whether the department is the primary department for the employee. It can be one of the following:
<ul>
<li><code>'Y'</code>: The department is the primary department.</li>
<li><code>'N'</code>: The department is not the primary department.</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Problem Description</strong></p>
<p>Employees may belong to multiple departments, and when they do, they must designate one department as their primary. If an employee belongs to only one department, the <code>primary_flag</code> for that department will be <code>'N'</code>.</p>
<p>You are tasked with reporting the primary department for each employee. If an employee has only one department, report that department as their primary.</p>
<hr>
<p><strong>Input:</strong></p>
<p>Employee table:</p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>department_id</th>
<th>primary_flag</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>N</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>Y</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>N</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>N</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>N</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>Y</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td>N</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>department_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>For employee 1, their only department is department 1, so it is reported as their primary department.</li>
<li>Employee 2 belongs to two departments (1 and 2). The <code>primary_flag</code> for department 1 is <code>'Y'</code>, so department 1 is their primary department.</li>
<li>Employee 3 only belongs to department 3, so it is reported as their primary department.</li>
<li>Employee 4 belongs to three departments (2, 3, and 4). The <code>primary_flag</code> for department 3 is <code>'Y'</code>, so department 3 is reported as their primary department.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/primary-department-for-each-employee?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">sql</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT employee_id, department_id
FROM Employee
WHERE primary_flag = 'Y'
UNION
SELECT employee_id, department_id
FROM Employee
GROUP BY employee_id
HAVING COUNT(1) = 1;
</code></pre>
    </div>
</div>


</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  <blockquote>
<p>The <code>UNION</code> operator is used to combine the results of two or more <code>SELECT</code> queries into a single result set. By default, <code>UNION</code> removes duplicate rows, ensuring that the final result contains only distinct records. In contrast, <code>UNION ALL</code> includes all rows, even if they are duplicates. It&rsquo;s important to note that each <code>SELECT</code> statement involved in a <code>UNION</code> operation must contain the same number of columns, and the corresponding columns must have compatable data types.</p>
</blockquote>
</details></p>

<hr>
<h3 id="triangle-judgement">Triangle Judgement<a hidden class="anchor" aria-hidden="true" href="#triangle-judgement">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Triangle</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td>int</td>
</tr>
<tr>
<td>y</td>
<td>int</td>
</tr>
<tr>
<td>z</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Primary Key:</strong> (x, y, z)<br>
Each row in this table represents the lengths of three line segments.</li>
</ul>
<hr>
<p><strong>Task:</strong><br>
Determine whether the three line segments <code>(x, y, z)</code> from each row can form a triangle.<br>
Return the result table in any order, including a column that specifies if the segments form a triangle.</p>
<p><strong>Triangle Formation Rule:</strong><br>
Three segments can form a triangle if and only if the following conditions are met:</p>
<ol>
<li>$x + y &gt; z$</li>
<li>$x + z &gt; y$</li>
<li>$y + z &gt; x$</li>
</ol>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong></p>
<p>**Triangle table:  **</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
<th>z</th>
</tr>
</thead>
<tbody>
<tr>
<td>13</td>
<td>15</td>
<td>30</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>15</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
<th>z</th>
<th>triangle</th>
</tr>
</thead>
<tbody>
<tr>
<td>13</td>
<td>15</td>
<td>30</td>
<td>No</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>15</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<hr>

</details></p>


<a href="https://leetcode.com/problems/triangle-judgement?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT
    *,
    IF(x + y > z AND x + z > y AND y + z > x, 'Yes', 'No') AS triangle
FROM
Triangle;

SELECT 
    *, 
    CASE 
        WHEN (x + y > z) AND (x + z > y) AND (y + z > x) THEN 'Yes'
        ELSE 'No'
    END AS triangle
FROM 
Triangle;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="consecutive-numbers">Consecutive Numbers<a hidden class="anchor" aria-hidden="true" href="#consecutive-numbers">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Logs</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>num</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>id</code> is the primary key for this table.</li>
<li>The <code>id</code> column is an auto-increment column that starts from 1.</li>
</ul>
<hr>
<p><strong>Problem Statement:</strong></p>
<p>Find all numbers (<code>num</code>) that appear at least three times consecutively in the table.</p>
<p>Return the result table in any order.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong></p>
<p>Logs table:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
</tr>
<tr>
<td>7</td>
<td>2</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>ConsecutiveNums</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<p>The number <code>1</code> is the only value that appears at least three times consecutively in the table.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/consecutive-numbers?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT DISTINCT l1.num AS ConsecutiveNums
FROM Logs l1
JOIN Logs l2 ON l1.id = l2.id - 1
JOIN Logs l3 ON l2.id = l3.id - 1
WHERE l1.num = l2.num AND l2.num = l3.num;

SELECT DISTINCT l2.num AS ConsecutiveNums
FROM Logs AS l1
JOIN Logs AS l2 ON l1.id = l2.id - 1 AND l1.num = l2.num
JOIN Logs AS l3 ON l2.id = l3.id - 1 AND l2.num = l3.num;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="product-price-at-a-given-date">Product Price at a Given Date<a hidden class="anchor" aria-hidden="true" href="#product-price-at-a-given-date">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Products</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>product_id</td>
<td>int</td>
</tr>
<tr>
<td>new_price</td>
<td>int</td>
</tr>
<tr>
<td>change_date</td>
<td>date</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>(product_id, change_date)</strong> is the primary key (a combination of columns with unique values) of this table.</li>
<li>Each row indicates that the price of a product was changed to a new price on a specific date.</li>
</ul>
<hr>
<p><strong>Problem Statement</strong></p>
<p>Write a query to find the prices of all products on <strong>2019-08-16</strong>. Assume the price of all products before any change is 10.</p>
<p>Return the result in any order.</p>
<hr>
<p><strong>Example:</strong></p>
<p><strong>Input:</strong></p>
<p><strong>Products table:</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>new_price</th>
<th>change_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>20</td>
<td>2019-08-14</td>
</tr>
<tr>
<td>2</td>
<td>50</td>
<td>2019-08-14</td>
</tr>
<tr>
<td>1</td>
<td>30</td>
<td>2019-08-15</td>
</tr>
<tr>
<td>1</td>
<td>35</td>
<td>2019-08-16</td>
</tr>
<tr>
<td>2</td>
<td>65</td>
<td>2019-08-17</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>2019-08-18</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>50</td>
</tr>
<tr>
<td>1</td>
<td>35</td>
</tr>
<tr>
<td>3</td>
<td>10</td>
</tr>
</tbody>
</table>
<hr>

</details></p>


<a href="https://leetcode.com/problems/product-price-at-a-given-date?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >WITH
    T AS (SELECT DISTINCT product_id FROM Products),
    P AS (
        SELECT product_id, new_price AS price
        FROM Products
        WHERE
            (product_id, change_date) IN (
                SELECT product_id, MAX(change_date) AS change_date
                FROM Products
                WHERE change_date <= '2019-08-16'
                GROUP BY 1
            )
    )

SELECT product_id, IFNULL(price, 10) AS price
FROM T
LEFT JOIN P USING (product_id);

WITH
    P AS (
        SELECT p1.product_id, new_price, change_date
        FROM
            (
                SELECT DISTINCT product_id
                FROM Products
            ) AS p1
            LEFT JOIN Products AS p2
                ON p1.product_id = p2.product_id AND p2.change_date <= '2019-08-16'
    ),
    T AS (
        SELECT
            *,
            RANK() OVER (
                PARTITION BY product_id
                ORDER BY change_date DESC
            ) AS rk
        FROM P
    )
SELECT product_id, IFNULL(new_price, 10) AS price
FROM T
WHERE rk = 1;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>


<p><details >
  <summary markdown="span">SHOW NOTES</summary>
  
</details></p>

<hr>
<h3 id="last-person-to-fit-in-the-bus">Last Person to Fit in the Bus<a hidden class="anchor" aria-hidden="true" href="#last-person-to-fit-in-the-bus">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Queue</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>person_id</td>
<td>int</td>
</tr>
<tr>
<td>person_name</td>
<td>varchar</td>
</tr>
<tr>
<td>weight</td>
<td>int</td>
</tr>
<tr>
<td>turn</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>The <code>person_id</code> column contains unique values.</li>
<li>This table holds information about people waiting to board a bus.</li>
<li>The <code>person_id</code> and <code>turn</code> columns contain values from 1 to <code>n</code>, where <code>n</code> is the number of rows in the table.</li>
<li>The <code>turn</code> column determines the order in which people will board the bus. A <code>turn</code> value of 1 indicates the first person to board, and <code>turn</code> = <code>n</code> indicates the last person to board.</li>
<li>The <code>weight</code> column represents the person’s weight in kilograms.</li>
</ul>
<p>The bus has a weight limit of 1000 kilograms, so some people may not be able to board if the total weight exceeds this limit. The goal is to identify the name of the last person who can board the bus without exceeding the weight limit.</p>
<ul>
<li>Only one person can board the bus at any given time, based on their turn.</li>
</ul>
<hr>
<p><strong>Input:</strong></p>
<p>Queue table:</p>
<table>
<thead>
<tr>
<th>person_id</th>
<th>person_name</th>
<th>weight</th>
<th>turn</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>Alice</td>
<td>250</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>Bob</td>
<td>175</td>
<td>5</td>
</tr>
<tr>
<td>3</td>
<td>Alex</td>
<td>350</td>
<td>2</td>
</tr>
<tr>
<td>6</td>
<td>John Cena</td>
<td>400</td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>Winston</td>
<td>500</td>
<td>6</td>
</tr>
<tr>
<td>2</td>
<td>Marie</td>
<td>200</td>
<td>4</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>person_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>John Cena</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<p>The following table shows the order in which people board the bus, ordered by the <code>turn</code> column for simplicity:</p>
<table>
<thead>
<tr>
<th>Turn</th>
<th>person_id</th>
<th>person_name</th>
<th>weight</th>
<th>Total Weight</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>5</td>
<td>Alice</td>
<td>250</td>
<td>250</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>Alex</td>
<td>350</td>
<td>600</td>
</tr>
<tr>
<td>3</td>
<td>6</td>
<td>John Cena</td>
<td>400</td>
<td>1000</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>Marie</td>
<td>200</td>
<td>1200</td>
</tr>
<tr>
<td>5</td>
<td>4</td>
<td>Bob</td>
<td>175</td>
<td>___</td>
</tr>
<tr>
<td>6</td>
<td>1</td>
<td>Winston</td>
<td>500</td>
<td>___</td>
</tr>
</tbody>
</table>
<p>John Cena is the last person who can board the bus without exceeding the weight limit of 1000 kilograms.</p>
<hr>

</details></p>


<a href="https://leetcode.com/problems/last-person-to-fit-in-the-bus?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >WITH
    T AS (
        SELECT
            person_name,
            SUM(weight) OVER (ORDER BY turn) AS acumulated_weight
        FROM Queue
    )
SELECT person_name
FROM T
WHERE acumulated_weight <= 1000
ORDER BY acumulated_weight DESC
LIMIT 1;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="count-salary-categories">Count Salary Categories<a hidden class="anchor" aria-hidden="true" href="#count-salary-categories">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Accounts</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>account_id</td>
<td>int</td>
</tr>
<tr>
<td>income</td>
<td>int</td>
</tr>
</tbody>
</table>
<ul>
<li>The <code>account_id</code> column is the primary key, meaning it contains unique values for each row.</li>
<li>Each row represents the monthly income of a specific bank account.</li>
</ul>
<hr>
<p><strong>Task:</strong></p>
<p>Write a solution to calculate the number of bank accounts in each salary category. The salary categories are defined as:</p>
<ul>
<li><strong>&ldquo;Low Salary&rdquo;</strong>: Salaries strictly less than $20,000.</li>
<li><strong>&ldquo;Average Salary&rdquo;</strong>: Salaries in the inclusive range [$20,000, $50,000].</li>
<li><strong>&ldquo;High Salary&rdquo;</strong>: Salaries strictly greater than $50,000.</li>
</ul>
<p>The result table should contain all three categories. If no accounts fall into a category, return 0 for that category.</p>
<p>The result can be returned in any order.</p>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Accounts table:</strong></p>
<table>
<thead>
<tr>
<th>account_id</th>
<th>income</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>108939</td>
</tr>
<tr>
<td>2</td>
<td>12747</td>
</tr>
<tr>
<td>8</td>
<td>87709</td>
</tr>
<tr>
<td>6</td>
<td>91796</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>category</th>
<th>accounts_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Low Salary</td>
<td>1</td>
</tr>
<tr>
<td>Average Salary</td>
<td>0</td>
</tr>
<tr>
<td>High Salary</td>
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Low Salary</strong>: Account 2 has an income of $12,747, which is below $20,000.</li>
<li><strong>Average Salary</strong>: There are no accounts with an income between $20,000 and $50,000.</li>
<li><strong>High Salary</strong>: Accounts 3, 6, and 8 have incomes above $50,000.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/count-salary-categories?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >WITH
    S AS (
        SELECT 'Low Salary' AS category
        UNION
        SELECT 'Average Salary'
        UNION
        SELECT 'High Salary'
    ),
    T AS (
        SELECT
            CASE
                WHEN income < 20000 THEN 'Low Salary'
                WHEN income > 50000 THEN 'High Salary'
                ELSE 'Average Salary'
            END AS category,
            COUNT(1) AS accounts_count
        FROM Accounts
        GROUP BY category
    )
SELECT category, IFNULL(accounts_count, 0) AS accounts_count
FROM S
LEFT JOIN T USING (category);
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h2 id="subqueries">Subqueries<a hidden class="anchor" aria-hidden="true" href="#subqueries">#</a></h2>
<h3 id="exchange-seats">Exchange Seats<a hidden class="anchor" aria-hidden="true" href="#exchange-seats">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Seat</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>student</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<ul>
<li><code>id</code> is the primary key for this table.</li>
<li>Each row represents a student&rsquo;s name and their seat ID. The <code>id</code> starts from 1 and increases consecutively.</li>
</ul>
<hr>
<p><strong>Problem Description:</strong></p>
<p>Write a query to swap the seat IDs of every two consecutive students in the <code>Seat</code> table. If the number of students is odd, the last student&rsquo;s seat ID should remain unchanged.</p>
<p>The result should be ordered by the <code>id</code> column in ascending order.</p>
<hr>
<p><strong>Input:</strong></p>
<p>Seat table:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Abbot</td>
</tr>
<tr>
<td>2</td>
<td>Doris</td>
</tr>
<tr>
<td>3</td>
<td>Emerson</td>
</tr>
<tr>
<td>4</td>
<td>Green</td>
</tr>
<tr>
<td>5</td>
<td>Jeames</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Doris</td>
</tr>
<tr>
<td>2</td>
<td>Abbot</td>
</tr>
<tr>
<td>3</td>
<td>Green</td>
</tr>
<tr>
<td>4</td>
<td>Emerson</td>
</tr>
<tr>
<td>5</td>
<td>Jeames</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>The students <code>Abbot</code> and <code>Doris</code> swap places, as well as <code>Emerson</code> and <code>Green</code>.</li>
<li>Since there are an odd number of students, <code>Jeames</code>&rsquo;s seat remains unchanged.</li>
</ul>
<hr>

</details></p>


<a href="https://leetcode.com/problems/exchange-seats?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >SELECT 
    CASE
        WHEN id % 2 = 1 AND id < (SELECT MAX(id) FROM Seat) THEN id + 1
        WHEN id % 2 = 0 THEN id - 1
        ELSE id
    END AS id,
    student
FROM Seat
ORDER BY id;
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>
<h3 id="movie-rating">Movie Rating<a hidden class="anchor" aria-hidden="true" href="#movie-rating">#</a></h3>


<p><details >
  <summary markdown="span">SHOW PROBLEM</summary>
  <p><strong>Table: Movies</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>movie_id</td>
<td>int</td>
</tr>
<tr>
<td>title</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<p>movie_id is the primary key (column with unique values) for this table.
title is the name of the movie.</p>
<p><strong>Table: Users</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<p>user_id is the primary key (column with unique values) for this table.
The column &rsquo;name&rsquo; has unique values.</p>
<p><strong>Table: MovieRating</strong></p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>movie_id</td>
<td>int</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
</tr>
<tr>
<td>rating</td>
<td>int</td>
</tr>
<tr>
<td>created_at</td>
<td>date</td>
</tr>
</tbody>
</table>
<p>(movie_id, user_id) is the primary key (column with unique values) for this table.
This table contains the rating of a movie by a user in their review.
created_at is the user&rsquo;s review date.</p>
<p><strong>Problem:</strong></p>
<ol>
<li>Find the name of the user who has rated the greatest number of movies. In case of a tie, return the lexicographically smaller user name.</li>
<li>Find the movie name with the highest average rating in February 2020. In case of a tie, return the lexicographically smaller movie name.</li>
</ol>
<p><strong>Result format:</strong></p>
<p>The result should contain two columns:</p>
<ol>
<li><code>results</code> – containing the user name with the greatest number of movie ratings.</li>
<li><code>results</code> – containing the movie name with the highest average rating in February 2020.</li>
</ol>
<hr>
<p><strong>Input:</strong></p>
<p><strong>Movies table:</strong></p>
<table>
<thead>
<tr>
<th>movie_id</th>
<th>title</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Avengers</td>
</tr>
<tr>
<td>2</td>
<td>Frozen 2</td>
</tr>
<tr>
<td>3</td>
<td>Joker</td>
</tr>
</tbody>
</table>
<p><strong>Users table:</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Daniel</td>
</tr>
<tr>
<td>2</td>
<td>Monica</td>
</tr>
<tr>
<td>3</td>
<td>Maria</td>
</tr>
<tr>
<td>4</td>
<td>James</td>
</tr>
</tbody>
</table>
<p><strong>MovieRating table:</strong></p>
<table>
<thead>
<tr>
<th>movie_id</th>
<th>user_id</th>
<th>rating</th>
<th>created_at</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>3</td>
<td>2020-01-12</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>4</td>
<td>2020-02-11</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>2</td>
<td>2020-02-12</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>1</td>
<td>2020-01-01</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>5</td>
<td>2020-02-17</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2020-02-01</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2</td>
<td>2020-03-01</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>3</td>
<td>2020-02-22</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>4</td>
<td>2020-02-25</td>
</tr>
</tbody>
</table>
<p><strong>Output:</strong></p>
<table>
<thead>
<tr>
<th>results</th>
</tr>
</thead>
<tbody>
<tr>
<td>Daniel</td>
</tr>
<tr>
<td>Frozen 2</td>
</tr>
</tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>Daniel and Monica have rated 3 movies (&ldquo;Avengers&rdquo;, &ldquo;Frozen 2&rdquo; and &ldquo;Joker&rdquo;), but Daniel is lexicographically smaller.</li>
<li>&ldquo;Frozen 2&rdquo; and &ldquo;Joker&rdquo; both have an average rating of 3.5 in February, but &ldquo;Frozen 2&rdquo; is lexicographically smaller.</li>
</ul>

</details></p>


<a href="https://leetcode.com/problems/movie-rating?envType=study-plan-v2&amp;envId=top-sql-50" target="_blank">
Go to Leetcode 🔗
</a>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details>
        <summary>SHOW CODE</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">MySQL</button>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-sql" data-lang="sql" >(
    SELECT name AS results
    FROM
        Users
        JOIN MovieRating USING (user_id)
    GROUP BY user_id
    ORDER BY COUNT(1) DESC, name
    LIMIT 1
)
UNION ALL
(
    SELECT title
    FROM
        MovieRating
        JOIN Movies USING (movie_id)
    WHERE DATE_FORMAT(created_at, '%Y-%m') = '2020-02'
    GROUP BY movie_id
    ORDER BY AVG(rating) DESC, title
    LIMIT 1
);
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<hr>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://signalyu.github.io/tags/engineering--technology/">Engineering &amp; Technology</a></li>
      <li><a href="https://signalyu.github.io/tags/computer-science/">Computer Science</a></li>
      <li><a href="https://signalyu.github.io/tags/database/">Database</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://signalyu.github.io/posts/4-engineering-and-technology/computer-science/framework-and-tools/framework/backend/unit-testing/1-junit-and-mockito-notes/">
    <span class="title">« PREV</span>
    
    <br>
    <span>Junit &amp; Mockito Notes</span>
  </a>
  <a class="next" href="https://signalyu.github.io/posts/3-humanities/languages/listening/english/1-learning-english-with-podcasts/">
    <span class="title">NEXT »</span>
    
    <br>
    <span>Learning English With Podcasts</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://signalyu.github.io/">Signal&#39;s Blog</a></span> · 
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

</body>
</html>
