<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Spring MVC 执行流程 | 信一的博客</title>
<meta name="keywords" content="工程与技术, Tech, Spring MVC">
<meta name="description" content="Spring MVC 执行流程图 Spring MVC 执行流程图 graph TB subgraph dispatchServlet[前端控制器（DispatchServlet）] direction TB doDispatch ~~~ getHandler ~~~ getHandlerAdapter ~~~ processDispatchResult end subgraph handlerMapping[处理器映射器] end subgraph handlerAdapter[处理器适配器] handle end subgraph handler[处理器（Handler）] 执行业务逻辑 end subgraph viewResolver[视图解析器] resolveViewName end subgraph view[视图（View）] render end user(((用户))) --&gt;|① 请求| dispatchServlet dispatchServlet --&gt;|② 匹配 Handler| handlerMapping handlerMapping --&gt;|③ 返回 HandlerExecutionChain| dispatchServlet dispatchServlet --&gt;|④ 获取 HandlerAdapter| handlerAdapter handlerAdapter --&gt;|⑤ 返回 HandlerAdapter| dispatchServlet dispatchServlet -.- preHandler[⑥ 执行 preHandler] -.-&gt;|⑦ 执行 handle| handlerAdapter handlerAdapter --&gt;|⑧ 执行 handleInternal| handler --&gt;|⑨ 返回 ModelAndView| handlerAdapter handlerAdapter -.">
<meta name="author" content="Signal Yu">
<link rel="canonical" href="https://signalyu.github.io/posts/4-engineering-and-technology/tech/spring-mvc/1-spring-mvc-execution-flow/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.9ddf6c021b47a5a861a7c6af241af938775e0fc65a762930d3a2426fc59e9a5c.css" integrity="sha256-nd9sAhtHpahhp8avJBr5OHdeD8Zadikw06JCb8Wemlw=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://signalyu.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://signalyu.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://signalyu.github.io/favicon-32x32">
<link rel="apple-touch-icon" href="https://signalyu.github.io/apple-touch-icon">
<link rel="mask-icon" href="https://signalyu.github.io/favicon.io">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://signalyu.github.io/posts/4-engineering-and-technology/tech/spring-mvc/1-spring-mvc-execution-flow/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
  

<meta property="og:title" content="Spring MVC 执行流程" />
<meta property="og:description" content="Spring MVC 执行流程图 Spring MVC 执行流程图 graph TB subgraph dispatchServlet[前端控制器（DispatchServlet）] direction TB doDispatch ~~~ getHandler ~~~ getHandlerAdapter ~~~ processDispatchResult end subgraph handlerMapping[处理器映射器] end subgraph handlerAdapter[处理器适配器] handle end subgraph handler[处理器（Handler）] 执行业务逻辑 end subgraph viewResolver[视图解析器] resolveViewName end subgraph view[视图（View）] render end user(((用户))) --&gt;|① 请求| dispatchServlet dispatchServlet --&gt;|② 匹配 Handler| handlerMapping handlerMapping --&gt;|③ 返回 HandlerExecutionChain| dispatchServlet dispatchServlet --&gt;|④ 获取 HandlerAdapter| handlerAdapter handlerAdapter --&gt;|⑤ 返回 HandlerAdapter| dispatchServlet dispatchServlet -.- preHandler[⑥ 执行 preHandler] -.-&gt;|⑦ 执行 handle| handlerAdapter handlerAdapter --&gt;|⑧ 执行 handleInternal| handler --&gt;|⑨ 返回 ModelAndView| handlerAdapter handlerAdapter -." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://signalyu.github.io/posts/4-engineering-and-technology/tech/spring-mvc/1-spring-mvc-execution-flow/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-14T14:21:49+08:00" />
<meta property="article:modified_time" content="2024-05-14T14:21:49+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring MVC 执行流程"/>
<meta name="twitter:description" content="Spring MVC 执行流程图 Spring MVC 执行流程图 graph TB subgraph dispatchServlet[前端控制器（DispatchServlet）] direction TB doDispatch ~~~ getHandler ~~~ getHandlerAdapter ~~~ processDispatchResult end subgraph handlerMapping[处理器映射器] end subgraph handlerAdapter[处理器适配器] handle end subgraph handler[处理器（Handler）] 执行业务逻辑 end subgraph viewResolver[视图解析器] resolveViewName end subgraph view[视图（View）] render end user(((用户))) --&gt;|① 请求| dispatchServlet dispatchServlet --&gt;|② 匹配 Handler| handlerMapping handlerMapping --&gt;|③ 返回 HandlerExecutionChain| dispatchServlet dispatchServlet --&gt;|④ 获取 HandlerAdapter| handlerAdapter handlerAdapter --&gt;|⑤ 返回 HandlerAdapter| dispatchServlet dispatchServlet -.- preHandler[⑥ 执行 preHandler] -.-&gt;|⑦ 执行 handle| handlerAdapter handlerAdapter --&gt;|⑧ 执行 handleInternal| handler --&gt;|⑨ 返回 ModelAndView| handlerAdapter handlerAdapter -."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://signalyu.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Spring MVC 执行流程",
      "item": "https://signalyu.github.io/posts/4-engineering-and-technology/tech/spring-mvc/1-spring-mvc-execution-flow/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Spring MVC 执行流程",
  "name": "Spring MVC 执行流程",
  "description": "Spring MVC 执行流程图 Spring MVC 执行流程图 graph TB subgraph dispatchServlet[前端控制器（DispatchServlet）] direction TB doDispatch ~~~ getHandler ~~~ getHandlerAdapter ~~~ processDispatchResult end subgraph handlerMapping[处理器映射器] end subgraph handlerAdapter[处理器适配器] handle end subgraph handler[处理器（Handler）] 执行业务逻辑 end subgraph viewResolver[视图解析器] resolveViewName end subgraph view[视图（View）] render end user(((用户))) --\u003e|① 请求| dispatchServlet dispatchServlet --\u003e|② 匹配 Handler| handlerMapping handlerMapping --\u003e|③ 返回 HandlerExecutionChain| dispatchServlet dispatchServlet --\u003e|④ 获取 HandlerAdapter| handlerAdapter handlerAdapter --\u003e|⑤ 返回 HandlerAdapter| dispatchServlet dispatchServlet -.- preHandler[⑥ 执行 preHandler] -.-\u003e|⑦ 执行 handle| handlerAdapter handlerAdapter --\u003e|⑧ 执行 handleInternal| handler --\u003e|⑨ 返回 ModelAndView| handlerAdapter handlerAdapter -.",
  "keywords": [
    "工程与技术", "Tech", "Spring MVC"
  ],
  "articleBody": "Spring MVC 执行流程图 Spring MVC 执行流程图 graph TB subgraph dispatchServlet[前端控制器（DispatchServlet）] direction TB doDispatch ~~~ getHandler ~~~ getHandlerAdapter ~~~ processDispatchResult end subgraph handlerMapping[处理器映射器] end subgraph handlerAdapter[处理器适配器] handle end subgraph handler[处理器（Handler）] 执行业务逻辑 end subgraph viewResolver[视图解析器] resolveViewName end subgraph view[视图（View）] render end user(((用户))) --\u003e|① 请求| dispatchServlet dispatchServlet --\u003e|② 匹配 Handler| handlerMapping handlerMapping --\u003e|③ 返回 HandlerExecutionChain| dispatchServlet dispatchServlet --\u003e|④ 获取 HandlerAdapter| handlerAdapter handlerAdapter --\u003e|⑤ 返回 HandlerAdapter| dispatchServlet dispatchServlet -.- preHandler[⑥ 执行 preHandler] -.-\u003e|⑦ 执行 handle| handlerAdapter handlerAdapter --\u003e|⑧ 执行 handleInternal| handler --\u003e|⑨ 返回 ModelAndView| handlerAdapter handlerAdapter -.-|⑩ 返回 ModelAndView| postHandler[⑪ 执行 postHandler] -.-\u003e dispatchServlet dispatchServlet --\u003e|⑫ 解析视图| viewResolver --\u003e|⑬ 返回 view|dispatchServlet dispatchServlet --\u003e|⑭ 调用 render| view --\u003e|⑮ 渲染视图| dispatchServlet dispatchServlet -.- afterCompletion[⑯ 执行 afterCompletion] --\u003e|⑰ 响应| user DispatcherServlet（前端控制器） 点击查看 DispatcherServlet.class 核心代码 DispatcherServlet.class public class DispatcherServlet extends FrameworkServlet { protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {} protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {} private void processDispatchResult(HttpServletRequest request, HttpServletResponse response, @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv, @Nullable Exception exception) throws Exception {} protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception {} protected View resolveViewName(String viewName, @Nullable Map model, Locale locale, HttpServletRequest request) throws Exception {} } doDispatch 点击查看 doDispatch 方法核心代码 java protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception { /* * 根据请求获取处理器（处理器执行链对象） * 该处理器属于请求级别，一次请求对应一个对象 * 该对象描述了本次请求执行的具体处理器、应该执行的拦截器及其执行顺序 */ HandlerExecutionChain mappedHandler = this.getHandler(processedRequest); /* * 根据处理器获取处理器适配器 * Web 服务器在启动时创建多个 HandlerAdapter 并使用 List 集合保存 * 此时还没有进行数据绑定，即表单提交的数据在此时还没有转换为 pojo 对象 */ HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); // 执行请求对应的所有拦截器中的 preHandle 方法 if (!mappedHandler.applyPreHandle(processedRequest, response)) { return; } /* * 通过处理器适配器调用 handle 方法，并返回 ModelAndView 对象 * 在调用 handle 之前会进行数据绑定，将表单提交的数据绑定到处理器方法上 * 在数据绑定的过程中会使用到 HttpMessageConverter 消息转换器 */ mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); // 执行请求对应的所有拦截器中的 postHandle 方法 mappedHandler.applyPostHandle(processedRequest, response, mv); // 处理分发结果 this.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException); } HandlerExecutionChain（处理器执行链对象） HandlerExecutionChain mappedHandler = this.getHandler(processedRequest); 点击查看 HandlerExecutionChain 核心代码 HandlerExecutionChain.class public class HandlerExecutionChain { private final Object handler; private final List interceptorList; private int interceptorIndex; public HandlerExecutionChain(Object handler, List interceptorList) { this.interceptorList = new ArrayList(); this.interceptorIndex = -1; // 检查传入的 handler 是否是 HandlerExecutionChain 的实例 if (handler instanceof HandlerExecutionChain originalChain) { // 如果是，则从原始链中获取处理器并复制其拦截器列表 this.handler = originalChain.getHandler(); this.interceptorList.addAll(originalChain.interceptorList); } else { // 如果不是，则直接使用传入的 handler this.handler = handler; } // 将传入的拦截器列表添加到现有的拦截器列表中 this.interceptorList.addAll(interceptorList); } } Object handler 底层对应的是一个 HandlerMethod 对象，该对象在 Web 服务器启动初始化 Spring IoC 容器时创建，它的两个主要参数为 beanName 和 Method。 HandlerMethod 对象 this.getHandler 代码分析 HandlerExecutionChain mappedHandler = this.getHandler(processedRequest); 点击查看 this.getHandler 方法代码 getHandler @Nullable protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception { if (this.handlerMappings != null) { Iterator var2 = this.handlerMappings.iterator(); /* * 遍历获取符合请求的 HandlerMapping 对象，以此获取正确的 HandlerExecutionChain * 如果处理方法中使用的是 @RequestMapping 注解，则对应的 mapping 为 RequestMappingHandlerMapping */ while(var2.hasNext()) { HandlerMapping mapping = (HandlerMapping)var2.next(); HandlerExecutionChain handler = mapping.getHandler(request); if (handler != null) { return handler; } } } return null; } mapping.getHandler 代码分析 HandlerExecutionChain handler = mapping.getHandler(request); mapping 的变量类型为接口 HandlerMapping（处理器映射器），该接口有很多实现类，常用的是 RequestMappingHandlerMapping，它是 RequestMapping 注解专用的处理器映射器。 所有 HandlerMapping 都是在 Web 服务器启动时创建并存放在 List 集合中。 处理器映射器创建过程 创建 HandlerMapping 时，底层会执行 new HandlerMethod()，具体过程如下图： --- title: 处理器映射器创建过程与 mapping.getHandler --- graph subgraph handlerMapping[HandlerMapping 接口] HM_getHandler[getHandler] end subgraph abstractHandlerMapping[AbstractHandlerMapping 抽象类] AHM_getHandler[getHandler] end subgraph abstractHandlerMethodMapping[AbstractHandlerMethodMapping 抽象类] AHMM_registerHandlerMethod[registerHandlerMethod] --\u003e|② 调用| AHMM_register[register] --\u003e|③ 调用| AHMM_createHandlerMethod[createHandlerMethod] end subgraph requestMappingInfoHandlerMapping[RequestMappingInfoHandlerMapping 抽象类] end subgraph requestMappingHandlerMapping[RequestMappingHandlerMapping 类] RMHM_registerHandlerMethod[registerHandlerMethod] end handlerMapping -.-\u003e|实现| abstractHandlerMapping --\u003e|继承| abstractHandlerMethodMapping --\u003e|继承| requestMappingInfoHandlerMapping --\u003e|继承| requestMappingHandlerMapping RMHM_registerHandlerMethod --\u003e|① 调用| AHMM_registerHandlerMethod AHMM_createHandlerMethod --\u003e|④调用| handlerMethodConstructor[\"new HandlerMethod(...)\"] mapping.getHandler --\u003e|调用| AHM_getHandler 点击查看上图涉及的代码 getHandler registerHandlerMethod register createHandlerMethod // AbstractHandlerMapping 抽象类中的 getHandler 方法 public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception { Object handler = this.getHandlerInternal(request); // ... if (handler instanceof String) { String handlerName = (String)handler; handler = this.obtainApplicationContext().getBean(handlerName); } HandlerExecutionChain executionChain = this.getHandlerExecutionChain(handler, request); // ... return executionChain; } protected HandlerMethod createHandlerMethod(Object handler, Method method) { if (handler instanceof String beanName) { return new HandlerMethod(beanName, this.obtainApplicationContext().getAutowireCapableBeanFactory(), this.obtainApplicationContext(), method); } else { return new HandlerMethod(handler, method); } } public void register(T mapping, Object handler, Method method) { // ... HandlerMethod handlerMethod = AbstractHandlerMethodMapping.this.createHandlerMethod(handler, method); // ... } protected HandlerMethod createHandlerMethod(Object handler, Method method) { if (handler instanceof String beanName) { return new HandlerMethod(beanName, this.obtainApplicationContext().getAutowireCapableBeanFactory(), this.obtainApplicationContext(), method); } else { return new HandlerMethod(handler, method); } } getHandlerAdapter HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); 程序员写的每一个 Controller 都有与之对应的处理器适配器，常用的处理器适配器是 RequestMappingHandlerAdapter。 HandlerAdapter 是一个接口。在 Web 服务器启动阶段，所有该接口的实现类都会被创建并存放在 List 集合中。 点击查看 getHandlerAdapter 代码 getHandlerAdapter protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException { if (this.handlerAdapters != null) { Iterator var2 = this.handlerAdapters.iterator(); while(var2.hasNext()) { HandlerAdapter adapter = (HandlerAdapter)var2.next(); if (adapter.supports(handler)) { // 返回支持处理器的适配器 return adapter; } } } // 未找到支持处理器的适配器，抛出 Servlet 异常 throw new ServletException(\"No adapter for handler [\" + handler + \"]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler\"); } applyPreHandle if (!mappedHandler.applyPreHandle(processedRequest, response)) { return; } 点击查看 applyPreHandle 代码 applyPreHandle boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception { // 顺序调用 interceptorList 中的 HandlerInterceptor 对象的 preHandle 方法 for(int i = 0; i \u003c this.interceptorList.size(); this.interceptorIndex = i++) { HandlerInterceptor interceptor = (HandlerInterceptor)this.interceptorList.get(i); if (!interceptor.preHandle(request, response, this.handler)) { this.triggerAfterCompletion(request, response, (Exception)null); return false; } } return true; } ha.handle mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); 在处理器适配器（HandlerAdapter）中执行的任务主要包括：\n将前端提交的 form 数据通过 HttpMessageConverter 转换为 POJO 对象 将数据绑定到 HandlerMethod 对象上 调用 HandlerMethod 并返回 ModelView 点击查看 ha.handle 相关代码 handle 方法 handleInternal 方法 invokeHandlerMethod 方法 @Nullable public final ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { return this.handleInternal(request, response, (HandlerMethod)handler); } // RequestMappingHandlerAdapter.class protected ModelAndView handleInternal(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod) throws Exception { // ... ModelAndView mav = this.invokeHandlerMethod(request, response, handlerMethod); // ... return mav; } // RequestMappingHandlerAdapter.class @Nullable protected ModelAndView invokeHandlerMethod(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod) throws Exception { // 获取一个数据绑定工厂 WebDataBinderFactory binderFactory = this.getDataBinderFactory(handlerMethod); // 获取一个可调用的处理器方法 ServletInvocableHandlerMethod invocableMethod = this.createInvocableHandlerMethod(handlerMethod); // 给可调用的方法绑定数据 invocableMethod.setDataBinderFactory(binderFactory); // 给可调用的方法设置参数 invocableMethod.setParameterNameDiscoverer(this.parameterNameDiscoverer); // 执行可调用方法 invocableMethod.invokeAndHandle(webRequest, mavContainer, new Object[0]); } applyPostHandle mappedHandler.applyPostHandle(processedRequest, response, mv); 点击查看 applyPostHandle 相关代码 applyPostHandle 方法 void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv) throws Exception { // 逆序（--i）取出拦截器对象并执行每个对象的 postHandle 方法 for(int i = this.interceptorList.size() - 1; i \u003e= 0; --i) { HandlerInterceptor interceptor = (HandlerInterceptor)this.interceptorList.get(i); interceptor.postHandle(request, response, this.handler, mv); } } processDispatchResult this.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException); 点击查看 processDispatchResult 相关代码 processDispatchResult 方法 render 方法 resolveViewName 方法 triggerAfterCompletion 方法 private void processDispatchResult(HttpServletRequest request, HttpServletResponse response, @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv, @Nullable Exception exception) throws Exception { // ... this.render(mv, request, response); // ... if (mappedHandler != null) { mappedHandler.triggerAfterCompletion(request, response, (Exception)null); } } protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception { // ... // 通过视图解析器进行解析，返回视图对象 this.resolveViewName(viewName, mv.getModelInternal(), locale, request); // ... // 调用视图的渲染方法，完成响应 view.render(mv.getModelInternal(), request, response); } @Nullable protected View resolveViewName(String viewName, @Nullable Map model, Locale locale, HttpServletRequest request) throws Exception { if (this.viewResolvers != null) { Iterator var5 = this.viewResolvers.iterator(); while(var5.hasNext()) { // 视图解析器 ViewResolver viewResolver = (ViewResolver)var5.next(); // 通过视图解析器返回视图对象 View view = viewResolver.resolveViewName(viewName, locale); if (view != null) { return view; } } } return null; } // HandlerExecutionChain.class void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, @Nullable Exception ex) { // // 逆序调用拦截器对象的 afterCompletion 方法 for(int i = this.interceptorIndex; i \u003e= 0; --i) { HandlerInterceptor interceptor = (HandlerInterceptor)this.interceptorList.get(i); try { interceptor.afterCompletion(request, response, this.handler, ex); } catch (Throwable var7) { logger.error(\"HandlerInterceptor.afterCompletion threw exception\", var7); } } } 面试题 简述 Spring MVC 的工作流程 用户发送请求至前端控制器（DispatcherServlet） DispatcherServlet 收到请求调用处理器映射器（HandlerMapping） 处理器映射器返回处理器执行链（HandlerExecutionChain） 前端控制器调用处理器适配器（HandlerAdapter） 处理器适配器找到具体的处理器（Controller） 处理器执行完业务逻辑后返回 ModelAndView 处理器适配器将 Controller 的执行结果返回给前端控制器 前端控制器将 ModelAndView 传给视图解析器（ViewResolver） 视图解析器解析后返回具体的 View 前端控制器根据 View 进行视图渲染 前端控制器响应用户 ",
  "wordCount" : "1125",
  "inLanguage": "en",
  "datePublished": "2024-05-14T14:21:49+08:00",
  "dateModified": "2024-05-14T14:21:49+08:00",
  "author":{
    "@type": "Person",
    "name": "Signal Yu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://signalyu.github.io/posts/4-engineering-and-technology/tech/spring-mvc/1-spring-mvc-execution-flow/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "信一的博客",
    "logo": {
      "@type": "ImageObject",
      "url": "https://signalyu.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://signalyu.github.io/" accesskey="h" title="信一的博客 (Alt + H)">
                <img src="https://signalyu.github.io/apple-touch-icon.png" alt="" aria-label="logo"
                    height="40">信一的博客</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://signalyu.github.io/archives/" title="档案">
                    <span>档案</span>
                </a>
            </li>
            <li>
                <a href="https://signalyu.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://signalyu.github.io/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://signalyu.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://signalyu.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Spring MVC 执行流程
    </h1>
    <div class="post-meta"><span title='2024-05-14 14:21:49 +0800 HKT'>2024年5月14日</span>&nbsp;·&nbsp;Signal Yu

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
            
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#spring-mvc-%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b%e5%9b%be" aria-label="Spring MVC 执行流程图">Spring MVC 执行流程图</a></li>
                <li>
                    <a href="#dispatcherservlet%e5%89%8d%e7%ab%af%e6%8e%a7%e5%88%b6%e5%99%a8" aria-label="DispatcherServlet（前端控制器）">DispatcherServlet（前端控制器）</a><ul>
                        
                <li>
                    <a href="#dodispatch" aria-label="doDispatch">doDispatch</a><ul>
                        
                <li>
                    <a href="#handlerexecutionchain%e5%a4%84%e7%90%86%e5%99%a8%e6%89%a7%e8%a1%8c%e9%93%be%e5%af%b9%e8%b1%a1" aria-label="HandlerExecutionChain（处理器执行链对象）">HandlerExecutionChain（处理器执行链对象）</a></li>
                <li>
                    <a href="#thisgethandler-%e4%bb%a3%e7%a0%81%e5%88%86%e6%9e%90" aria-label="this.getHandler 代码分析">this.getHandler 代码分析</a></li>
                <li>
                    <a href="#mappinggethandler-%e4%bb%a3%e7%a0%81%e5%88%86%e6%9e%90" aria-label="mapping.getHandler 代码分析">mapping.getHandler 代码分析</a><ul>
                        
                <li>
                    <a href="#%e5%a4%84%e7%90%86%e5%99%a8%e6%98%a0%e5%b0%84%e5%99%a8%e5%88%9b%e5%bb%ba%e8%bf%87%e7%a8%8b" aria-label="处理器映射器创建过程">处理器映射器创建过程</a></li></ul>
                </li>
                <li>
                    <a href="#gethandleradapter" aria-label="getHandlerAdapter">getHandlerAdapter</a></li>
                <li>
                    <a href="#applyprehandle" aria-label="applyPreHandle">applyPreHandle</a></li>
                <li>
                    <a href="#hahandle" aria-label="ha.handle">ha.handle</a></li>
                <li>
                    <a href="#applyposthandle" aria-label="applyPostHandle">applyPostHandle</a></li>
                <li>
                    <a href="#processdispatchresult" aria-label="processDispatchResult">processDispatchResult</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e9%9d%a2%e8%af%95%e9%a2%98" aria-label="面试题">面试题</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e8%bf%b0-spring-mvc-%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b" aria-label="简述 Spring MVC 的工作流程">简述 Spring MVC 的工作流程</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="spring-mvc-执行流程图">Spring MVC 执行流程图<a hidden class="anchor" aria-hidden="true" href="#spring-mvc-执行流程图">#</a></h1>
<figure class="align-center ">
    <img loading="lazy" src="/img/tech/spring-mvc/spring-mvc-1.png#center" width="100%" height="100%"/> <figcaption>
            Spring MVC 执行流程图
        </figcaption>
</figure>

<pre class="mermaid">graph TB
    subgraph dispatchServlet[前端控制器（DispatchServlet）]
        direction TB
        doDispatch ~~~ getHandler ~~~ getHandlerAdapter ~~~ processDispatchResult 

    end

    subgraph handlerMapping[处理器映射器]
        
    end

    subgraph handlerAdapter[处理器适配器]
        handle
    end

    subgraph handler[处理器（Handler）]
        执行业务逻辑
    end

    subgraph viewResolver[视图解析器]
        resolveViewName
    end

    subgraph view[视图（View）]
        render

    end
   
    user(((用户))) -->|① 请求| dispatchServlet
    
    dispatchServlet -->|② 匹配 Handler| handlerMapping
    
    handlerMapping -->|③ 返回 HandlerExecutionChain| dispatchServlet

    dispatchServlet -->|④ 获取 HandlerAdapter| handlerAdapter

    handlerAdapter -->|⑤ 返回 HandlerAdapter| dispatchServlet 

    dispatchServlet -.- preHandler[⑥ 执行 preHandler] -.->|⑦ 执行 handle| handlerAdapter

    handlerAdapter -->|⑧ 执行 handleInternal| handler -->|⑨ 返回 ModelAndView| handlerAdapter

    handlerAdapter -.-|⑩ 返回 ModelAndView| postHandler[⑪ 执行 postHandler] -.-> dispatchServlet

    dispatchServlet -->|⑫ 解析视图| viewResolver -->|⑬ 返回 view|dispatchServlet

    dispatchServlet -->|⑭ 调用 render| view -->|⑮ 渲染视图| dispatchServlet

    dispatchServlet -.- afterCompletion[⑯ 执行 afterCompletion] -->|⑰ 响应| user
</pre>
<h1 id="dispatcherservlet前端控制器">DispatcherServlet（前端控制器）<a hidden class="anchor" aria-hidden="true" href="#dispatcherservlet前端控制器">#</a></h1>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 DispatcherServlet.class 核心代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">DispatcherServlet.class</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >public class DispatcherServlet extends FrameworkServlet {
    protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {}

    protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {}

    private void processDispatchResult(HttpServletRequest request, HttpServletResponse response, 
                                       @Nullable HandlerExecutionChain mappedHandler, 
                                       @Nullable ModelAndView mv, @Nullable Exception exception) throws Exception {}

    protected void render(ModelAndView mv, HttpServletRequest request, 
                          HttpServletResponse response) throws Exception {}

    protected View resolveViewName(String viewName, @Nullable Map<String, 
                                   Object> model, Locale locale, 
                                   HttpServletRequest request) throws Exception {}
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h2 id="dodispatch">doDispatch<a hidden class="anchor" aria-hidden="true" href="#dodispatch">#</a></h2>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 doDispatch 方法核心代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">java</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
    /*
        * 根据请求获取处理器（处理器执行链对象）
        * 该处理器属于请求级别，一次请求对应一个对象
        * 该对象描述了本次请求执行的具体处理器、应该执行的拦截器及其执行顺序
    */
    HandlerExecutionChain mappedHandler = this.getHandler(processedRequest);

    /*
        * 根据处理器获取处理器适配器
        * Web 服务器在启动时创建多个 HandlerAdapter 并使用 List 集合保存
        * 此时还没有进行数据绑定，即表单提交的数据在此时还没有转换为 pojo 对象
        */
    HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());

    // 执行请求对应的所有拦截器中的 preHandle 方法
    if (!mappedHandler.applyPreHandle(processedRequest, response)) {
        return;
    }

    /*
        * 通过处理器适配器调用 handle 方法，并返回 ModelAndView 对象
        * 在调用 handle 之前会进行数据绑定，将表单提交的数据绑定到处理器方法上
        * 在数据绑定的过程中会使用到 HttpMessageConverter 消息转换器
        */
    mv = ha.handle(processedRequest, response, mappedHandler.getHandler());

        // 执行请求对应的所有拦截器中的 postHandle 方法
    mappedHandler.applyPostHandle(processedRequest, response, mv);

    // 处理分发结果
    this.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="handlerexecutionchain处理器执行链对象">HandlerExecutionChain（处理器执行链对象）<a hidden class="anchor" aria-hidden="true" href="#handlerexecutionchain处理器执行链对象">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >HandlerExecutionChain mappedHandler = this.getHandler(processedRequest);
</code></pre>
    </div>
</div>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 HandlerExecutionChain 核心代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">HandlerExecutionChain.class</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >public class HandlerExecutionChain {
    private final Object handler;
    private final List<HandlerInterceptor> interceptorList;
    private int interceptorIndex;

    public HandlerExecutionChain(Object handler, List<HandlerInterceptor> interceptorList) {
        this.interceptorList = new ArrayList();
        this.interceptorIndex = -1;
        // 检查传入的 handler 是否是 HandlerExecutionChain 的实例
        if (handler instanceof HandlerExecutionChain originalChain) {
            // 如果是，则从原始链中获取处理器并复制其拦截器列表
            this.handler = originalChain.getHandler();
            this.interceptorList.addAll(originalChain.interceptorList);
        } else {
            // 如果不是，则直接使用传入的 handler
            this.handler = handler;
        }
        // 将传入的拦截器列表添加到现有的拦截器列表中
        this.interceptorList.addAll(interceptorList);
    }
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<link rel="stylesheet" href="/css/notice.css">


<div class="notice info">
    Object handler 底层对应的是一个 HandlerMethod 对象，该对象在 Web 服务器启动初始化 Spring IoC 容器时创建，它的两个主要参数为 beanName 和 Method。
</div>
<figure class="align-center ">
    <img loading="lazy" src="/img/tech/spring-mvc/spring-mvc-2.png#center" width="100%" height="100%"/> <figcaption>
            HandlerMethod 对象
        </figcaption>
</figure>

<h3 id="thisgethandler-代码分析">this.getHandler 代码分析<a hidden class="anchor" aria-hidden="true" href="#thisgethandler-代码分析">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >HandlerExecutionChain mappedHandler = this.getHandler(processedRequest);
</code></pre>
    </div>
</div>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 this.getHandler 方法代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">getHandler</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >@Nullable
protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {
    if (this.handlerMappings != null) {
        Iterator var2 = this.handlerMappings.iterator();
        /*
         * 遍历获取符合请求的 HandlerMapping 对象，以此获取正确的 HandlerExecutionChain 
         * 如果处理方法中使用的是 @RequestMapping 注解，则对应的 mapping 为 RequestMappingHandlerMapping
        */
        while(var2.hasNext()) {
            HandlerMapping mapping = (HandlerMapping)var2.next();
            HandlerExecutionChain handler = mapping.getHandler(request);
            if (handler != null) {
                return handler;
            }
        }
    }

    return null;
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="mappinggethandler-代码分析">mapping.getHandler 代码分析<a hidden class="anchor" aria-hidden="true" href="#mappinggethandler-代码分析">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >HandlerExecutionChain handler = mapping.getHandler(request);
</code></pre>
    </div>
</div>
<ul>
<li>mapping 的变量类型为接口 HandlerMapping（处理器映射器），该接口有很多实现类，常用的是
RequestMappingHandlerMapping，它是 RequestMapping 注解专用的处理器映射器。</li>
<li>所有 HandlerMapping 都是在 <strong>Web 服务器启动时创建</strong>并存放在 List 集合中。</li>
</ul>
<h4 id="处理器映射器创建过程">处理器映射器创建过程<a hidden class="anchor" aria-hidden="true" href="#处理器映射器创建过程">#</a></h4>
<link rel="stylesheet" href="/css/notice.css">


<div class="notice info">
    创建 HandlerMapping 时，底层会执行 new HandlerMethod()，具体过程如下图：
</div>
<pre class="mermaid">---
title: 处理器映射器创建过程与 mapping.getHandler
---
graph
    subgraph handlerMapping[HandlerMapping 接口]
        HM_getHandler[getHandler]
    end

    subgraph abstractHandlerMapping[AbstractHandlerMapping 抽象类]
        AHM_getHandler[getHandler]
    end

    subgraph abstractHandlerMethodMapping[AbstractHandlerMethodMapping 抽象类]
        AHMM_registerHandlerMethod[registerHandlerMethod] -->|② 调用| AHMM_register[register] -->|③ 调用| AHMM_createHandlerMethod[createHandlerMethod]
    end

    subgraph requestMappingInfoHandlerMapping[RequestMappingInfoHandlerMapping 抽象类]
        
    end

    subgraph requestMappingHandlerMapping[RequestMappingHandlerMapping 类]
        RMHM_registerHandlerMethod[registerHandlerMethod]
    end
    

    handlerMapping -.->|实现| abstractHandlerMapping -->|继承| abstractHandlerMethodMapping -->|继承| requestMappingInfoHandlerMapping -->|继承| requestMappingHandlerMapping

    RMHM_registerHandlerMethod -->|① 调用| AHMM_registerHandlerMethod

    AHMM_createHandlerMethod -->|④调用| handlerMethodConstructor["new HandlerMethod(...)"]

    mapping.getHandler -->|调用| AHM_getHandler
</pre>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看上图涉及的代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">getHandler</button>



<button class="tab_btn ">registerHandlerMethod</button>



<button class="tab_btn ">register</button>



<button class="tab_btn ">createHandlerMethod</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >// AbstractHandlerMapping 抽象类中的 getHandler 方法

public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {
    Object handler = this.getHandlerInternal(request);
    // ...

    if (handler instanceof String) {
        String handlerName = (String)handler;
        handler = this.obtainApplicationContext().getBean(handlerName);
    }
    
    HandlerExecutionChain executionChain = this.getHandlerExecutionChain(handler, request);
    // ...

    return executionChain;
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >protected HandlerMethod createHandlerMethod(Object handler, Method method) {
    if (handler instanceof String beanName) {
        return new HandlerMethod(beanName, this.obtainApplicationContext().getAutowireCapableBeanFactory(), this.obtainApplicationContext(), method);
    } else {
        return new HandlerMethod(handler, method);
    }
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >public void register(T mapping, Object handler, Method method) {
    // ...
    HandlerMethod handlerMethod = AbstractHandlerMethodMapping.this.createHandlerMethod(handler, method);
    // ...
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >protected HandlerMethod createHandlerMethod(Object handler, Method method) {
    if (handler instanceof String beanName) {
        return new HandlerMethod(beanName, this.obtainApplicationContext().getAutowireCapableBeanFactory(), this.obtainApplicationContext(), method);
    } else {
        return new HandlerMethod(handler, method);
    }
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="gethandleradapter">getHandlerAdapter<a hidden class="anchor" aria-hidden="true" href="#gethandleradapter">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());
</code></pre>
    </div>
</div>
<ul>
<li>程序员写的每一个 Controller 都有与之对应的处理器适配器，常用的处理器适配器是 RequestMappingHandlerAdapter。</li>
<li>HandlerAdapter 是一个接口。在 Web 服务器启动阶段，所有该接口的实现类都会被创建并存放在 List 集合中。</li>
</ul>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 getHandlerAdapter 代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">getHandlerAdapter</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException {
    if (this.handlerAdapters != null) {
        Iterator var2 = this.handlerAdapters.iterator();

        while(var2.hasNext()) {
            HandlerAdapter adapter = (HandlerAdapter)var2.next();
            if (adapter.supports(handler)) {
                // 返回支持处理器的适配器
                return adapter;
            }
        }
    }
    // 未找到支持处理器的适配器，抛出 Servlet 异常
    throw new ServletException("No adapter for handler [" + handler + "]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler");
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="applyprehandle">applyPreHandle<a hidden class="anchor" aria-hidden="true" href="#applyprehandle">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >if (!mappedHandler.applyPreHandle(processedRequest, response)) {
    return;
}
</code></pre>
    </div>
</div>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 applyPreHandle 代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">applyPreHandle</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {
    // 顺序调用 interceptorList 中的 HandlerInterceptor 对象的 preHandle 方法
    for(int i = 0; i < this.interceptorList.size(); this.interceptorIndex = i++) {
        HandlerInterceptor interceptor = (HandlerInterceptor)this.interceptorList.get(i);
        if (!interceptor.preHandle(request, response, this.handler)) {
            this.triggerAfterCompletion(request, response, (Exception)null);
            return false;
        }
    }

    return true;
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="hahandle">ha.handle<a hidden class="anchor" aria-hidden="true" href="#hahandle">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >mv = ha.handle(processedRequest, response, mappedHandler.getHandler());
</code></pre>
    </div>
</div>
<p>在处理器适配器（HandlerAdapter）中执行的任务主要包括：</p>
<ul>
<li>将前端提交的 form 数据通过 HttpMessageConverter 转换为 POJO 对象</li>
<li>将数据绑定到 HandlerMethod 对象上</li>
<li>调用 HandlerMethod 并返回 ModelView</li>
</ul>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 ha.handle 相关代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">handle 方法</button>



<button class="tab_btn ">handleInternal 方法</button>



<button class="tab_btn ">invokeHandlerMethod 方法</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >@Nullable
public final ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
    return this.handleInternal(request, response, (HandlerMethod)handler);
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >// RequestMappingHandlerAdapter.class
protected ModelAndView handleInternal(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {
    // ...
    ModelAndView mav = this.invokeHandlerMethod(request, response, handlerMethod);
    // ...
    return mav;
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >// RequestMappingHandlerAdapter.class
@Nullable
protected ModelAndView invokeHandlerMethod(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {
    // 获取一个数据绑定工厂
    WebDataBinderFactory binderFactory = this.getDataBinderFactory(handlerMethod);

    // 获取一个可调用的处理器方法
    ServletInvocableHandlerMethod invocableMethod = this.createInvocableHandlerMethod(handlerMethod);

    // 给可调用的方法绑定数据
    invocableMethod.setDataBinderFactory(binderFactory);

    // 给可调用的方法设置参数
    invocableMethod.setParameterNameDiscoverer(this.parameterNameDiscoverer);

    // 执行可调用方法
    invocableMethod.invokeAndHandle(webRequest, mavContainer, new Object[0]);
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="applyposthandle">applyPostHandle<a hidden class="anchor" aria-hidden="true" href="#applyposthandle">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >mappedHandler.applyPostHandle(processedRequest, response, mv);
</code></pre>
    </div>
</div>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 applyPostHandle 相关代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">applyPostHandle 方法</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv) throws Exception {
    // 逆序（--i）取出拦截器对象并执行每个对象的 postHandle 方法
    for(int i = this.interceptorList.size() - 1; i >= 0; --i) {
        HandlerInterceptor interceptor = (HandlerInterceptor)this.interceptorList.get(i);
        interceptor.postHandle(request, response, this.handler, mv);
    }
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h3 id="processdispatchresult">processDispatchResult<a hidden class="anchor" aria-hidden="true" href="#processdispatchresult">#</a></h3>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >this.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);
</code></pre>
    </div>
</div>
<head>
    <style>
         
        .collapsibleContainer {
            margin: 20px 0;
        }

        details summary {
            cursor: pointer;
        }

         
        details summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>

<div class="collapsibleContainer">
    <details open>
        <summary>点击查看 processDispatchResult 相关代码</summary>
        <div>
            
<link rel="stylesheet" href="/css/tabbed_code.css">


<div class="code_block_container">
    
<div class="tabs">
    



<button class="tab_btn active">processDispatchResult 方法</button>



<button class="tab_btn ">render 方法</button>



<button class="tab_btn ">resolveViewName 方法</button>



<button class="tab_btn ">triggerAfterCompletion 方法</button>

</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block active">
        <pre><code class="language-java" data-lang="java" >private void processDispatchResult(HttpServletRequest request, HttpServletResponse response, @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv, @Nullable Exception exception) throws Exception {
    // ...
    this.render(mv, request, response);
    // ...
    if (mappedHandler != null) {
        mappedHandler.triggerAfterCompletion(request, response, (Exception)null);
    }
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception {
    // ...
    // 通过视图解析器进行解析，返回视图对象
    this.resolveViewName(viewName, mv.getModelInternal(), locale, request);
    // ...
    // 调用视图的渲染方法，完成响应
    view.render(mv.getModelInternal(), request, response);
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >@Nullable
protected View resolveViewName(String viewName, @Nullable Map&lt;String, Object> model, Locale locale, HttpServletRequest request) throws Exception {
    if (this.viewResolvers != null) {
        Iterator var5 = this.viewResolvers.iterator();

        while(var5.hasNext()) {
            // 视图解析器
            ViewResolver viewResolver = (ViewResolver)var5.next();
            // 通过视图解析器返回视图对象
            View view = viewResolver.resolveViewName(viewName, locale);
            if (view != null) {
                return view;
            }
        }
    }

    return null;
}
</code></pre>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css"
    integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/java.min.js"></script>
<script>hljs.highlightAll();</script>





<div class="code_blocks">
    <div class="code_block ">
        <pre><code class="language-java" data-lang="java" >// HandlerExecutionChain.class
void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, @Nullable Exception ex) {
    // // 逆序调用拦截器对象的 afterCompletion 方法
    for(int i = this.interceptorIndex; i >= 0; --i) {
        HandlerInterceptor interceptor = (HandlerInterceptor)this.interceptorList.get(i);

        try {
            interceptor.afterCompletion(request, response, this.handler, ex);
        } catch (Throwable var7) {
            logger.error("HandlerInterceptor.afterCompletion threw exception", var7);
        }
    }
}
</code></pre>
    </div>
</div>

</div>

<script src="/js/tabbed_code.js"></script>

        </div>
    </details>
</div>
<h1 id="面试题">面试题<a hidden class="anchor" aria-hidden="true" href="#面试题">#</a></h1>
<h2 id="简述-spring-mvc-的工作流程">简述 Spring MVC 的工作流程<a hidden class="anchor" aria-hidden="true" href="#简述-spring-mvc-的工作流程">#</a></h2>
<ol>
<li>用户发送请求至前端控制器（DispatcherServlet）</li>
<li>DispatcherServlet 收到请求调用处理器映射器（HandlerMapping）</li>
<li>处理器映射器返回处理器执行链（HandlerExecutionChain）</li>
<li>前端控制器调用处理器适配器（HandlerAdapter）</li>
<li>处理器适配器找到具体的处理器（Controller）</li>
<li>处理器执行完业务逻辑后返回 ModelAndView</li>
<li>处理器适配器将 Controller 的执行结果返回给前端控制器</li>
<li>前端控制器将 ModelAndView 传给视图解析器（ViewResolver）</li>
<li>视图解析器解析后返回具体的 View</li>
<li>前端控制器根据 View 进行视图渲染</li>
<li>前端控制器响应用户</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://signalyu.github.io/tags/%E5%B7%A5%E7%A8%8B%E4%B8%8E%E6%8A%80%E6%9C%AF/">工程与技术</a></li>
      <li><a href="https://signalyu.github.io/tags/tech/">Tech</a></li>
      <li><a href="https://signalyu.github.io/tags/spring-mvc/">Spring MVC</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://signalyu.github.io/posts/4-engineering-and-technology/tech/design-patterns/1-factory-pattern/">
    <span class="title">« 上一页</span>
    
    <br>
    <span>设计模式——工厂模式</span>
  </a>
  <a class="next" href="https://signalyu.github.io/posts/4-engineering-and-technology/tech/spring/2-spring-aop/">
    <span class="title">下一页 »</span>
    
    <br>
    <span>Spring：理解 AOP</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://signalyu.github.io/">信一的博客</a></span> · 
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            "flowchart": { "htmlLabels": true },
            theme: 'dark',
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        });
    </script>
    
</body>
</html>
